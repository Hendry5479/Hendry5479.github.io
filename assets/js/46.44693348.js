(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{390:function(t,a,e){"use strict";e.r(a);var s=e(45),n=Object(s.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"ä»€ä¹ˆæ˜¯ä¼˜å…ˆçº§"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ä»€ä¹ˆæ˜¯ä¼˜å…ˆçº§"}},[t._v("#")]),t._v(" ä»€ä¹ˆæ˜¯ä¼˜å…ˆçº§")]),t._v(" "),e("p",[t._v("åœ¨"),e("a",{attrs:{href:"https://react.iamkasong.com/preparation/idea.html#%E7%90%86%E8%A7%A3-%E5%93%8D%E5%BA%94%E8%87%AA%E7%84%B6",target:"_blank",rel:"noopener noreferrer"}},[t._v("Reactç†å¿µä¸€èŠ‚"),e("OutboundLink")],1),t._v("æˆ‘ä»¬èŠåˆ°"),e("code",[t._v("React")]),t._v("å°†äººæœºäº¤äº’ç ”ç©¶çš„ç»“æœæ•´åˆåˆ°çœŸå®çš„"),e("code",[t._v("UI")]),t._v("ä¸­ã€‚å…·ä½“åˆ°"),e("code",[t._v("React")]),t._v("è¿è¡Œä¸Šè¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ")]),t._v(" "),e("p",[e("code",[t._v("çŠ¶æ€æ›´æ–°")]),t._v("ç”±"),e("code",[t._v("ç”¨æˆ·äº¤äº’")]),t._v("äº§ç”Ÿï¼Œç”¨æˆ·å¿ƒé‡Œå¯¹"),e("code",[t._v("äº¤äº’")]),t._v("æ‰§è¡Œé¡ºåºæœ‰ä¸ªé¢„æœŸã€‚"),e("code",[t._v("React")]),t._v("æ ¹æ®"),e("code",[t._v("äººæœºäº¤äº’ç ”ç©¶çš„ç»“æœ")]),t._v("ä¸­ç”¨æˆ·å¯¹"),e("code",[t._v("äº¤äº’")]),t._v("çš„é¢„æœŸé¡ºåºä¸º"),e("code",[t._v("äº¤äº’")]),t._v("äº§ç”Ÿçš„"),e("code",[t._v("çŠ¶æ€æ›´æ–°")]),t._v("èµ‹äºˆä¸åŒä¼˜å…ˆçº§ã€‚")]),t._v(" "),e("p",[t._v("å…·ä½“å¦‚ä¸‹ï¼š")]),t._v(" "),e("ul",[e("li",[t._v("ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼šåŒæ­¥æ‰§è¡Œã€‚")]),t._v(" "),e("li",[t._v("å—æ§çš„ç”¨æˆ·è¾“å…¥ï¼šæ¯”å¦‚è¾“å…¥æ¡†å†…è¾“å…¥æ–‡å­—ï¼ŒåŒæ­¥æ‰§è¡Œã€‚")]),t._v(" "),e("li",[t._v("äº¤äº’äº‹ä»¶ï¼šæ¯”å¦‚åŠ¨ç”»ï¼Œé«˜ä¼˜å…ˆçº§æ‰§è¡Œã€‚")]),t._v(" "),e("li",[t._v("å…¶ä»–ï¼šæ¯”å¦‚æ•°æ®è¯·æ±‚ï¼Œä½ä¼˜å…ˆçº§æ‰§è¡Œã€‚")])]),t._v(" "),e("h2",{attrs:{id:"å¦‚ä½•è°ƒåº¦ä¼˜å…ˆçº§"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#å¦‚ä½•è°ƒåº¦ä¼˜å…ˆçº§"}},[t._v("#")]),t._v(" "),e("a",{attrs:{href:"https://react.iamkasong.com/state/priority.html#%E5%A6%82%E4%BD%95%E8%B0%83%E5%BA%A6%E4%BC%98%E5%85%88%E7%BA%A7",target:"_blank",rel:"noopener noreferrer"}},[t._v("#"),e("OutboundLink")],1),t._v("å¦‚ä½•è°ƒåº¦ä¼˜å…ˆçº§")]),t._v(" "),e("p",[t._v("æˆ‘ä»¬åœ¨"),e("a",{attrs:{href:"https://react.iamkasong.com/preparation/newConstructure.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("æ–°çš„Reactç»“æ„ä¸€èŠ‚"),e("OutboundLink")],1),t._v("è®²åˆ°ï¼Œ"),e("code",[t._v("React")]),t._v("é€šè¿‡"),e("code",[t._v("Scheduler")]),t._v("è°ƒåº¦ä»»åŠ¡ã€‚")]),t._v(" "),e("p",[t._v("å…·ä½“åˆ°ä»£ç ï¼Œæ¯å½“éœ€è¦è°ƒåº¦ä»»åŠ¡æ—¶ï¼Œ"),e("code",[t._v("React")]),t._v("ä¼šè°ƒç”¨"),e("code",[t._v("Scheduler")]),t._v("æä¾›çš„æ–¹æ³•"),e("code",[t._v("runWithPriority")]),t._v("ã€‚")]),t._v(" "),e("p",[t._v("è¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ª"),e("code",[t._v("ä¼˜å…ˆçº§")]),t._v("å¸¸é‡ä¸ä¸€ä¸ª"),e("code",[t._v("å›è°ƒå‡½æ•°")]),t._v("ä½œä¸ºå‚æ•°ã€‚"),e("code",[t._v("å›è°ƒå‡½æ•°")]),t._v("ä¼šä»¥"),e("code",[t._v("ä¼˜å…ˆçº§")]),t._v("é«˜ä½ä¸ºé¡ºåºæ’åˆ—åœ¨ä¸€ä¸ª"),e("code",[t._v("å®šæ—¶å™¨")]),t._v("ä¸­å¹¶åœ¨åˆé€‚çš„æ—¶é—´è§¦å‘ã€‚")]),t._v(" "),e("p",[t._v("å¯¹äºæ›´æ–°æ¥è®²ï¼Œä¼ é€’çš„"),e("code",[t._v("å›è°ƒå‡½æ•°")]),t._v("ä¸€èˆ¬ä¸º"),e("a",{attrs:{href:"https://react.iamkasong.com/state/prepare.html#render%E9%98%B6%E6%AE%B5%E7%9A%84%E5%BC%80%E5%A7%8B",target:"_blank",rel:"noopener noreferrer"}},[t._v("çŠ¶æ€æ›´æ–°æµç¨‹æ¦‚è§ˆä¸€èŠ‚"),e("OutboundLink")],1),t._v("è®²åˆ°çš„"),e("code",[t._v("renderé˜¶æ®µçš„å…¥å£å‡½æ•°")]),t._v("ã€‚")]),t._v(" "),e("blockquote",[e("p",[t._v("ä½ å¯ä»¥åœ¨"),e("a",{attrs:{href:"https://github.com/facebook/react/blob/970fa122d8188bafa600e9b5214833487fbf1092/packages/scheduler/src/Scheduler.js#L217",target:"_blank",rel:"noopener noreferrer"}},[t._v("==unstable_runWithPriority== è¿™é‡Œ (opens new window)"),e("OutboundLink")],1),t._v("çœ‹åˆ°"),e("code",[t._v("runWithPriority")]),t._v("æ–¹æ³•çš„å®šä¹‰ã€‚åœ¨"),e("a",{attrs:{href:"https://github.com/facebook/react/blob/970fa122d8188bafa600e9b5214833487fbf1092/packages/scheduler/src/SchedulerPriorities.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("è¿™é‡Œ (opens new window)"),e("OutboundLink")],1),t._v("çœ‹åˆ°"),e("code",[t._v("Scheduler")]),t._v("å¯¹ä¼˜å…ˆçº§å¸¸é‡çš„å®šä¹‰ã€‚")])]),t._v(" "),e("h2",{attrs:{id:"ä¾‹å­"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ä¾‹å­"}},[t._v("#")]),t._v(" "),e("a",{attrs:{href:"https://react.iamkasong.com/state/priority.html#%E4%BE%8B%E5%AD%90",target:"_blank",rel:"noopener noreferrer"}},[t._v("#"),e("OutboundLink")],1),t._v("ä¾‹å­")]),t._v(" "),e("p",[t._v("ä¼˜å…ˆçº§æœ€ç»ˆä¼šåæ˜ åˆ°"),e("code",[t._v("update.lane")]),t._v("å˜é‡ä¸Šã€‚å½“å‰æˆ‘ä»¬åªéœ€è¦çŸ¥é“è¿™ä¸ªå˜é‡èƒ½å¤ŸåŒºåˆ†"),e("code",[t._v("Update")]),t._v("çš„ä¼˜å…ˆçº§ã€‚")]),t._v(" "),e("p",[t._v("æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­ç»“åˆä¸Šä¸€èŠ‚ä»‹ç»çš„"),e("code",[t._v("Update")]),t._v("ç›¸å…³å­—æ®µè®²è§£ä¼˜å…ˆçº§å¦‚ä½•å†³å®šæ›´æ–°çš„é¡ºåºã€‚")]),t._v(" "),e("blockquote",[e("p",[t._v("è¯¥ä¾‹å­æ¥è‡ª"),e("a",{attrs:{href:"https://twitter.com/acdlite/status/978412930973687808",target:"_blank",rel:"noopener noreferrer"}},[t._v("React Core Team Andrewå‘ç½‘å‹è®²è§£Updateå·¥ä½œæµç¨‹çš„æ¨æ–‡(opens new window)"),e("OutboundLink")],1)])]),t._v(" "),e("p",[e("img",{attrs:{src:"https://react.iamkasong.com/img/update-process.png",alt:"ä¼˜å…ˆçº§å¦‚ä½•å†³å®šæ›´æ–°çš„é¡ºåº"}})]),t._v(" "),e("p",[t._v("åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæœ‰ä¸¤ä¸ª"),e("code",[t._v("Update")]),t._v("ã€‚æˆ‘ä»¬å°†â€œå…³é—­é»‘å¤œæ¨¡å¼â€äº§ç”Ÿçš„"),e("code",[t._v("Update")]),t._v("ç§°ä¸º"),e("code",[t._v("u1")]),t._v("ï¼Œè¾“å…¥å­—æ¯â€œIâ€äº§ç”Ÿçš„"),e("code",[t._v("Update")]),t._v("ç§°ä¸º"),e("code",[t._v("u2")]),t._v("ã€‚")]),t._v(" "),e("p",[t._v("å…¶ä¸­"),e("code",[t._v("u1")]),t._v("å…ˆè§¦å‘å¹¶è¿›å…¥"),e("code",[t._v("renderé˜¶æ®µ")]),t._v("ã€‚å…¶ä¼˜å…ˆçº§è¾ƒä½ï¼Œæ‰§è¡Œæ—¶é—´è¾ƒé•¿ã€‚æ­¤æ—¶ï¼š")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("fiber"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("updateQueue "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  baseState"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    blackTheme"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    text"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'H'")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  firstBaseUpdate"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  lastBaseUpdate"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n  shared"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    pending"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" u1\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  effects"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("åœ¨"),e("code",[t._v("u1")]),t._v("å®Œæˆ"),e("code",[t._v("renderé˜¶æ®µ")]),t._v("å‰ç”¨æˆ·é€šè¿‡é”®ç›˜è¾“å…¥å­—æ¯â€œIâ€ï¼Œäº§ç”Ÿäº†"),e("code",[t._v("u2")]),t._v("ã€‚"),e("code",[t._v("u2")]),t._v("å±äº"),e("strong",[t._v("å—æ§çš„ç”¨æˆ·è¾“å…¥")]),t._v("ï¼Œä¼˜å…ˆçº§é«˜äº"),e("code",[t._v("u1")]),t._v("ï¼Œäºæ˜¯ä¸­æ–­"),e("code",[t._v("u1")]),t._v("äº§ç”Ÿçš„"),e("code",[t._v("renderé˜¶æ®µ")]),t._v("ã€‚")]),t._v(" "),e("p",[t._v("æ­¤æ—¶ï¼š")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("fiber"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("updateQueue"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shared"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pending "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" u2 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" u1\n                                     "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),t._v("        "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n                                     "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("________"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å³")]),t._v("\nu2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("next "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" u1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nu1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("next "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" u2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("å…¶ä¸­"),e("code",[t._v("u2")]),t._v("ä¼˜å…ˆçº§é«˜äº"),e("code",[t._v("u1")]),t._v("ã€‚")]),t._v(" "),e("p",[t._v("æ¥ä¸‹æ¥è¿›å…¥"),e("code",[t._v("u2")]),t._v("äº§ç”Ÿçš„"),e("code",[t._v("renderé˜¶æ®µ")]),t._v("ã€‚")]),t._v(" "),e("p",[t._v("åœ¨"),e("code",[t._v("processUpdateQueue")]),t._v("æ–¹æ³•ä¸­ï¼Œ"),e("code",[t._v("shared.pending")]),t._v("ç¯çŠ¶é“¾è¡¨ä¼šè¢«å‰ªå¼€å¹¶æ‹¼æ¥åœ¨"),e("code",[t._v("baseUpdate")]),t._v("åé¢ã€‚")]),t._v(" "),e("p",[t._v("éœ€è¦æ˜ç¡®ä¸€ç‚¹ï¼Œ"),e("code",[t._v("shared.pending")]),t._v("æŒ‡å‘æœ€åä¸€ä¸ª"),e("code",[t._v("pending")]),t._v("çš„"),e("code",[t._v("update")]),t._v("ï¼Œæ‰€ä»¥å®é™…æ‰§è¡Œæ—¶"),e("code",[t._v("update")]),t._v("çš„é¡ºåºä¸ºï¼š")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("u1 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" u2\n")])])]),e("p",[t._v("æ¥ä¸‹æ¥éå†"),e("code",[t._v("baseUpdate")]),t._v("ï¼Œå¤„ç†ä¼˜å…ˆçº§åˆé€‚çš„"),e("code",[t._v("Update")]),t._v("ï¼ˆè¿™ä¸€æ¬¡å¤„ç†çš„æ˜¯æ›´é«˜ä¼˜çš„"),e("code",[t._v("u2")]),t._v("ï¼‰ã€‚")]),t._v(" "),e("p",[t._v("ç”±äº"),e("code",[t._v("u2")]),t._v("ä¸æ˜¯"),e("code",[t._v("baseUpdate")]),t._v("ä¸­çš„ç¬¬ä¸€ä¸ª"),e("code",[t._v("update")]),t._v("ï¼Œåœ¨å…¶ä¹‹å‰çš„"),e("code",[t._v("u1")]),t._v("ç”±äºä¼˜å…ˆçº§ä¸å¤Ÿè¢«è·³è¿‡ã€‚")]),t._v(" "),e("p",[e("code",[t._v("update")]),t._v("ä¹‹é—´å¯èƒ½æœ‰ä¾èµ–å…³ç³»ï¼Œæ‰€ä»¥è¢«è·³è¿‡çš„"),e("code",[t._v("update")]),t._v("åŠå…¶åé¢æ‰€æœ‰"),e("code",[t._v("update")]),t._v("ä¼šæˆä¸ºä¸‹æ¬¡æ›´æ–°çš„"),e("code",[t._v("baseUpdate")]),t._v("ã€‚ï¼ˆå³"),e("code",[t._v("u1 -- u2")]),t._v("ï¼‰ã€‚")]),t._v(" "),e("p",[t._v("æœ€ç»ˆ"),e("code",[t._v("u2")]),t._v("å®Œæˆ"),e("code",[t._v("render - commité˜¶æ®µ")]),t._v("ã€‚")]),t._v(" "),e("p",[t._v("æ­¤æ—¶ï¼š")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("fiber"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("updateQueue "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  baseState"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    blackTheme"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    text"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HI'")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  firstBaseUpdate"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" u1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  lastBaseUpdate"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" u2\n  shared"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    pending"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  effects"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("åœ¨"),e("code",[t._v("commit")]),t._v("é˜¶æ®µç»“å°¾ä¼šå†è°ƒåº¦ä¸€æ¬¡æ›´æ–°ã€‚åœ¨è¯¥æ¬¡æ›´æ–°ä¸­ä¼šåŸºäº"),e("code",[t._v("baseState")]),t._v("ä¸­"),e("code",[t._v("firstBaseUpdate")]),t._v("ä¿å­˜çš„"),e("code",[t._v("u1")]),t._v("ï¼Œå¼€å¯ä¸€æ¬¡æ–°çš„"),e("code",[t._v("renderé˜¶æ®µ")]),t._v("ã€‚")]),t._v(" "),e("p",[t._v("æœ€ç»ˆä¸¤æ¬¡"),e("code",[t._v("Update")]),t._v("éƒ½å®Œæˆåçš„ç»“æœå¦‚ä¸‹ï¼š")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("fiber"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("updateQueue "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  baseState"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    blackTheme"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    text"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HI'")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  firstBaseUpdate"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  lastBaseUpdate"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n  shared"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    pending"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  effects"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("æˆ‘ä»¬å¯ä»¥çœ‹è§ï¼Œ"),e("code",[t._v("u2")]),t._v("å¯¹åº”çš„æ›´æ–°æ‰§è¡Œäº†ä¸¤æ¬¡ï¼Œç›¸åº”çš„"),e("code",[t._v("renderé˜¶æ®µ")]),t._v("çš„ç”Ÿå‘½å‘¨æœŸå‹¾å­"),e("code",[t._v("componentWillXXX")]),t._v("ä¹Ÿä¼šè§¦å‘ä¸¤æ¬¡ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¿™äº›å‹¾å­ä¼šè¢«æ ‡è®°ä¸º"),e("code",[t._v("unsafe_")]),t._v("ã€‚")]),t._v(" "),e("h2",{attrs:{id:"å¦‚ä½•ä¿è¯çŠ¶æ€æ­£ç¡®"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#å¦‚ä½•ä¿è¯çŠ¶æ€æ­£ç¡®"}},[t._v("#")]),t._v(" "),e("a",{attrs:{href:"https://react.iamkasong.com/state/priority.html#%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E7%8A%B6%E6%80%81%E6%AD%A3%E7%A1%AE",target:"_blank",rel:"noopener noreferrer"}},[t._v("#"),e("OutboundLink")],1),t._v("å¦‚ä½•ä¿è¯çŠ¶æ€æ­£ç¡®")]),t._v(" "),e("p",[t._v("ç°åœ¨æˆ‘ä»¬åŸºæœ¬æŒæ¡äº†"),e("code",[t._v("updateQueue")]),t._v("çš„å·¥ä½œæµç¨‹ã€‚è¿˜æœ‰ä¸¤ä¸ªç–‘é—®ï¼š")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("renderé˜¶æ®µ")]),t._v("å¯èƒ½è¢«ä¸­æ–­ã€‚å¦‚ä½•ä¿è¯"),e("code",[t._v("updateQueue")]),t._v("ä¸­ä¿å­˜çš„"),e("code",[t._v("Update")]),t._v("ä¸ä¸¢å¤±ï¼Ÿ")]),t._v(" "),e("li",[t._v("æœ‰æ—¶å€™å½“å‰"),e("code",[t._v("çŠ¶æ€")]),t._v("éœ€è¦ä¾èµ–å‰ä¸€ä¸ª"),e("code",[t._v("çŠ¶æ€")]),t._v("ã€‚å¦‚ä½•åœ¨æ”¯æŒè·³è¿‡"),e("code",[t._v("ä½ä¼˜å…ˆçº§çŠ¶æ€")]),t._v("çš„åŒæ—¶ä¿è¯"),e("strong",[t._v("çŠ¶æ€ä¾èµ–çš„è¿ç»­æ€§")]),t._v("ï¼Ÿ")])]),t._v(" "),e("p",[t._v("æˆ‘ä»¬åˆ†åˆ«è®²è§£ä¸‹ã€‚")]),t._v(" "),e("h3",{attrs:{id:"å¦‚ä½•ä¿è¯updateä¸ä¸¢å¤±"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#å¦‚ä½•ä¿è¯updateä¸ä¸¢å¤±"}},[t._v("#")]),t._v(" "),e("a",{attrs:{href:"https://react.iamkasong.com/state/priority.html#%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81update%E4%B8%8D%E4%B8%A2%E5%A4%B1",target:"_blank",rel:"noopener noreferrer"}},[t._v("#"),e("OutboundLink")],1),t._v("å¦‚ä½•ä¿è¯"),e("code",[t._v("Update")]),t._v("ä¸ä¸¢å¤±")]),t._v(" "),e("p",[t._v("åœ¨"),e("a",{attrs:{href:"https://react.iamkasong.com/state/update.html#%E4%BE%8B%E5%AD%90",target:"_blank",rel:"noopener noreferrer"}},[t._v("ä¸Šä¸€èŠ‚ä¾‹å­"),e("OutboundLink")],1),t._v("ä¸­æˆ‘ä»¬è®²åˆ°ï¼Œåœ¨"),e("code",[t._v("renderé˜¶æ®µ")]),t._v("ï¼Œ"),e("code",[t._v("shared.pending")]),t._v("çš„ç¯è¢«å‰ªå¼€å¹¶è¿æ¥åœ¨"),e("code",[t._v("updateQueue.lastBaseUpdate")]),t._v("åé¢ã€‚")]),t._v(" "),e("p",[t._v("å®é™…ä¸Š"),e("code",[t._v("shared.pending")]),t._v("ä¼šè¢«åŒæ—¶è¿æ¥åœ¨"),e("code",[t._v("workInProgress updateQueue.lastBaseUpdate")]),t._v("ä¸"),e("code",[t._v("current updateQueue.lastBaseUpdate")]),t._v("åé¢ã€‚")]),t._v(" "),e("blockquote",[e("p",[t._v("å…·ä½“ä»£ç è§"),e("a",{attrs:{href:"https://github.com/facebook/react/blob/970fa122d8188bafa600e9b5214833487fbf1092/packages/react-reconciler/src/ReactUpdateQueue.new.js#L424",target:"_blank",rel:"noopener noreferrer"}},[t._v("è¿™é‡Œ(opens new window)"),e("OutboundLink")],1)])]),t._v(" "),e("p",[t._v("å½“"),e("code",[t._v("renderé˜¶æ®µ")]),t._v("è¢«ä¸­æ–­åé‡æ–°å¼€å§‹æ—¶ï¼Œä¼šåŸºäº"),e("code",[t._v("current updateQueue")]),t._v("å…‹éš†å‡º"),e("code",[t._v("workInProgress updateQueue")]),t._v("ã€‚ç”±äº"),e("code",[t._v("current updateQueue.lastBaseUpdate")]),t._v("å·²ç»ä¿å­˜äº†ä¸Šä¸€æ¬¡çš„"),e("code",[t._v("Update")]),t._v("ï¼Œæ‰€ä»¥ä¸ä¼šä¸¢å¤±ã€‚")]),t._v(" "),e("p",[t._v("å½“"),e("code",[t._v("commité˜¶æ®µ")]),t._v("å®Œæˆæ¸²æŸ“ï¼Œç”±äº"),e("code",[t._v("workInProgress updateQueue.lastBaseUpdate")]),t._v("ä¸­ä¿å­˜äº†ä¸Šä¸€æ¬¡çš„"),e("code",[t._v("Update")]),t._v("ï¼Œæ‰€ä»¥ "),e("code",[t._v("workInProgress Fiberæ ‘")]),t._v("å˜æˆ"),e("code",[t._v("current Fiberæ ‘")]),t._v("åä¹Ÿä¸ä¼šé€ æˆ"),e("code",[t._v("Update")]),t._v("ä¸¢å¤±ã€‚")]),t._v(" "),e("h3",{attrs:{id:"å¦‚ä½•ä¿è¯çŠ¶æ€ä¾èµ–çš„è¿ç»­æ€§"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#å¦‚ä½•ä¿è¯çŠ¶æ€ä¾èµ–çš„è¿ç»­æ€§"}},[t._v("#")]),t._v(" "),e("a",{attrs:{href:"https://react.iamkasong.com/state/priority.html#%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E7%8A%B6%E6%80%81%E4%BE%9D%E8%B5%96%E7%9A%84%E8%BF%9E%E7%BB%AD%E6%80%A7",target:"_blank",rel:"noopener noreferrer"}},[t._v("#"),e("OutboundLink")],1),t._v("å¦‚ä½•ä¿è¯çŠ¶æ€ä¾èµ–çš„è¿ç»­æ€§")]),t._v(" "),e("p",[t._v("å½“æŸä¸ª"),e("code",[t._v("Update")]),t._v("ç”±äºä¼˜å…ˆçº§ä½è€Œè¢«è·³è¿‡æ—¶ï¼Œä¿å­˜åœ¨"),e("code",[t._v("baseUpdate")]),t._v("ä¸­çš„ä¸ä»…æ˜¯è¯¥"),e("code",[t._v("Update")]),t._v("ï¼Œè¿˜åŒ…æ‹¬é“¾è¡¨ä¸­è¯¥"),e("code",[t._v("Update")]),t._v("ä¹‹åçš„æ‰€æœ‰"),e("code",[t._v("Update")]),t._v("ã€‚")]),t._v(" "),e("p",[t._v("è€ƒè™‘å¦‚ä¸‹ä¾‹å­ï¼š")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("baseState"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v("\nshared"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pending"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("A1")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("B2")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("C1")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("D2")]),t._v("\n")])])]),e("p",[t._v("å…¶ä¸­"),e("code",[t._v("å­—æ¯")]),t._v("ä»£è¡¨è¯¥"),e("code",[t._v("Update")]),t._v("è¦åœ¨é¡µé¢æ’å…¥çš„å­—æ¯ï¼Œ"),e("code",[t._v("æ•°å­—")]),t._v("ä»£è¡¨"),e("code",[t._v("ä¼˜å…ˆçº§")]),t._v("ï¼Œå€¼è¶Šä½"),e("code",[t._v("ä¼˜å…ˆçº§")]),t._v("è¶Šé«˜ã€‚")]),t._v(" "),e("p",[t._v("ç¬¬ä¸€æ¬¡"),e("code",[t._v("render")]),t._v("ï¼Œ"),e("code",[t._v("ä¼˜å…ˆçº§")]),t._v("ä¸º1ã€‚")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("baseState"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v("\nbaseUpdate"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\nrenderé˜¶æ®µä½¿ç”¨çš„Update"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("A1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("C1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nmemoizedState"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'AC'")]),t._v("\n")])])]),e("p",[t._v("å…¶ä¸­"),e("code",[t._v("B2")]),t._v("ç”±äºä¼˜å…ˆçº§ä¸º2ï¼Œä½äºå½“å‰ä¼˜å…ˆçº§ï¼Œæ‰€ä»¥ä»–åŠå…¶åé¢çš„æ‰€æœ‰"),e("code",[t._v("Update")]),t._v("ä¼šè¢«ä¿å­˜åœ¨"),e("code",[t._v("baseUpdate")]),t._v("ä¸­ä½œä¸ºä¸‹æ¬¡æ›´æ–°çš„"),e("code",[t._v("Update")]),t._v("ï¼ˆå³"),e("code",[t._v("B2 C1 D2")]),t._v("ï¼‰ã€‚")]),t._v(" "),e("p",[t._v("è¿™ä¹ˆåšæ˜¯ä¸ºäº†ä¿æŒ"),e("code",[t._v("çŠ¶æ€")]),t._v("çš„å‰åä¾èµ–é¡ºåºã€‚")]),t._v(" "),e("p",[t._v("ç¬¬äºŒæ¬¡"),e("code",[t._v("render")]),t._v("ï¼Œ"),e("code",[t._v("ä¼˜å…ˆçº§")]),t._v("ä¸º2ã€‚")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("baseState"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'A'")]),t._v("\nbaseUpdate"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("B2")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("C1")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("D2")]),t._v("\nrenderé˜¶æ®µä½¿ç”¨çš„Update"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("B2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("C1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("D2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nmemoizedState"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ABCD'")]),t._v("\n")])])]),e("p",[t._v("æ³¨æ„è¿™é‡Œ"),e("code",[t._v("baseState")]),t._v("å¹¶ä¸æ˜¯ä¸Šä¸€æ¬¡æ›´æ–°çš„"),e("code",[t._v("memoizedState")]),t._v("ã€‚è¿™æ˜¯ç”±äº"),e("code",[t._v("B2")]),t._v("è¢«è·³è¿‡äº†ã€‚")]),t._v(" "),e("p",[t._v("å³å½“æœ‰"),e("code",[t._v("Update")]),t._v("è¢«è·³è¿‡æ—¶ï¼Œ"),e("code",[t._v("ä¸‹æ¬¡æ›´æ–°çš„baseState !== ä¸Šæ¬¡æ›´æ–°çš„memoizedState")]),t._v("ã€‚")]),t._v(" "),e("blockquote",[e("p",[t._v("è·³è¿‡"),e("code",[t._v("B2")]),t._v("çš„é€»è¾‘è§"),e("a",{attrs:{href:"https://github.com/facebook/react/blob/970fa122d8188bafa600e9b5214833487fbf1092/packages/react-reconciler/src/ReactUpdateQueue.new.js#L479",target:"_blank",rel:"noopener noreferrer"}},[t._v("è¿™é‡Œ(opens new window)"),e("OutboundLink")],1)])]),t._v(" "),e("p",[t._v("é€šè¿‡ä»¥ä¸Šä¾‹å­æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ"),e("code",[t._v("React")]),t._v("ä¿è¯æœ€ç»ˆçš„çŠ¶æ€ä¸€å®šå’Œç”¨æˆ·è§¦å‘çš„"),e("code",[t._v("äº¤äº’")]),t._v("ä¸€è‡´ï¼Œä½†æ˜¯ä¸­é—´è¿‡ç¨‹"),e("code",[t._v("çŠ¶æ€")]),t._v("å¯èƒ½ç”±äºè®¾å¤‡ä¸åŒè€Œä¸åŒã€‚")]),t._v(" "),e("p",[t._v("ç»è¿‡äº”ç« çš„å­¦ä¹ ï¼Œæˆ‘ä»¬ç»ˆäºå›åˆ°äº†"),e("code",[t._v("React")]),t._v("åº”ç”¨çš„èµ·ç‚¹ã€‚")]),t._v(" "),e("p",[t._v("è¿™ä¸€èŠ‚æˆ‘ä»¬å®Œæ•´çš„èµ°é€š"),e("code",[t._v("ReactDOM.render")]),t._v("å®Œæˆé¡µé¢æ¸²æŸ“çš„æ•´ä¸ªæµç¨‹ã€‚")]),t._v(" "),e("h2",{attrs:{id:"åˆ›å»ºfiber"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#åˆ›å»ºfiber"}},[t._v("#")]),t._v(" "),e("a",{attrs:{href:"https://react.iamkasong.com/state/reactdom.html#%E5%88%9B%E5%BB%BAfiber",target:"_blank",rel:"noopener noreferrer"}},[t._v("#"),e("OutboundLink")],1),t._v("åˆ›å»ºfiber")]),t._v(" "),e("p",[t._v("ä»"),e("a",{attrs:{href:"https://react.iamkasong.com/process/doubleBuffer.html#mount%E6%97%B6",target:"_blank",rel:"noopener noreferrer"}},[t._v("åŒç¼“å­˜æœºåˆ¶ä¸€èŠ‚"),e("OutboundLink")],1),t._v("æˆ‘ä»¬çŸ¥é“ï¼Œé¦–æ¬¡æ‰§è¡Œ"),e("code",[t._v("ReactDOM.render")]),t._v("ä¼šåˆ›å»º"),e("code",[t._v("fiberRootNode")]),t._v("å’Œ"),e("code",[t._v("rootFiber")]),t._v("ã€‚å…¶ä¸­"),e("code",[t._v("fiberRootNode")]),t._v("æ˜¯æ•´ä¸ªåº”ç”¨çš„æ ¹èŠ‚ç‚¹ï¼Œ"),e("code",[t._v("rootFiber")]),t._v("æ˜¯è¦æ¸²æŸ“ç»„ä»¶æ‰€åœ¨ç»„ä»¶æ ‘çš„"),e("code",[t._v("æ ¹èŠ‚ç‚¹")]),t._v("ã€‚")]),t._v(" "),e("p",[t._v("è¿™ä¸€æ­¥å‘ç”Ÿåœ¨è°ƒç”¨"),e("code",[t._v("ReactDOM.render")]),t._v("åè¿›å…¥çš„"),e("code",[t._v("legacyRenderSubtreeIntoContainer")]),t._v("æ–¹æ³•ä¸­ã€‚")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// containeræŒ‡ReactDOM.renderçš„ç¬¬äºŒä¸ªå‚æ•°ï¼ˆå³åº”ç”¨æŒ‚è½½çš„DOMèŠ‚ç‚¹ï¼‰")]),t._v("\nroot "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" container"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_reactRootContainer "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("legacyCreateRootFromDOMContainer")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  container"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  forceHydrate"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nfiberRoot "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" root"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_internalRoot"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("blockquote",[e("p",[t._v("ä½ å¯ä»¥ä»"),e("a",{attrs:{href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-dom/src/client/ReactDOMLegacy.js#L193",target:"_blank",rel:"noopener noreferrer"}},[t._v("è¿™é‡Œ (opens new window)"),e("OutboundLink")],1),t._v("çœ‹åˆ°è¿™ä¸€æ­¥çš„ä»£ç ")])]),t._v(" "),e("p",[e("code",[t._v("legacyCreateRootFromDOMContainer")]),t._v("æ–¹æ³•å†…éƒ¨ä¼šè°ƒç”¨"),e("code",[t._v("createFiberRoot")]),t._v("æ–¹æ³•å®Œæˆ"),e("code",[t._v("fiberRootNode")]),t._v("å’Œ"),e("code",[t._v("rootFiber")]),t._v("çš„åˆ›å»ºä»¥åŠå…³è”ã€‚å¹¶åˆå§‹åŒ–"),e("code",[t._v("updateQueue")]),t._v("ã€‚")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createFiberRoot")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("containerInfo"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" any"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  tag"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" RootTag"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  hydrate"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" boolean"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  hydrationCallbacks"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" SuspenseHydrationCallbacks"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")])]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" FiberRoot "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆ›å»ºfiberRootNode")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" root"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" FiberRoot "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FiberRootNode")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("containerInfo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tag"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" hydrate"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" any"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  \n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆ›å»ºrootFiber")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" uninitializedFiber "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createHostRootFiber")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tag"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¿æ¥rootFiberä¸fiberRootNode")]),t._v("\n  root"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("current "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" uninitializedFiber"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  uninitializedFiber"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stateNode "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" root"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆå§‹åŒ–updateQueue")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("initializeUpdateQueue")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uninitializedFiber"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" root"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("æ ¹æ®ä»¥ä¸Šä»£ç ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨"),e("a",{attrs:{href:"https://react.iamkasong.com/process/doubleBuffer.html#mount%E6%97%B6",target:"_blank",rel:"noopener noreferrer"}},[t._v("åŒç¼“å­˜æœºåˆ¶ä¸€èŠ‚"),e("OutboundLink")],1),t._v("åŸºç¡€ä¸Šè¡¥å……ä¸Š"),e("code",[t._v("rootFiber")]),t._v("åˆ°"),e("code",[t._v("fiberRootNode")]),t._v("çš„å¼•ç”¨ã€‚")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://react.iamkasong.com/img/fiberroot.png",alt:"fiberRoot"}})]),t._v(" "),e("blockquote",[e("p",[t._v("ä½ å¯ä»¥ä»"),e("a",{attrs:{href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberRoot.new.js#L97",target:"_blank",rel:"noopener noreferrer"}},[t._v("è¿™é‡Œ (opens new window)"),e("OutboundLink")],1),t._v("çœ‹åˆ°è¿™ä¸€æ­¥çš„ä»£ç ")])]),t._v(" "),e("h2",{attrs:{id:"åˆ›å»ºupdate"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#åˆ›å»ºupdate"}},[t._v("#")]),t._v(" "),e("a",{attrs:{href:"https://react.iamkasong.com/state/reactdom.html#%E5%88%9B%E5%BB%BAupdate",target:"_blank",rel:"noopener noreferrer"}},[t._v("#"),e("OutboundLink")],1),t._v("åˆ›å»ºupdate")]),t._v(" "),e("p",[t._v("æˆ‘ä»¬å·²ç»åšå¥½äº†ç»„ä»¶çš„åˆå§‹åŒ–å·¥ä½œï¼Œæ¥ä¸‹æ¥å°±ç­‰å¾…åˆ›å»º"),e("code",[t._v("Update")]),t._v("æ¥å¼€å¯ä¸€æ¬¡æ›´æ–°ã€‚")]),t._v(" "),e("p",[t._v("è¿™ä¸€æ­¥å‘ç”Ÿåœ¨"),e("code",[t._v("updateContainer")]),t._v("æ–¹æ³•ä¸­ã€‚")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateContainer")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("element"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ReactNodeList"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  container"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" OpaqueRoot"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  parentComponent"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("React$Component"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("any"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" any"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  callback"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("Function"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")])]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Lane "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...çœç•¥ä¸é€»è¾‘ä¸ç›¸å…³ä»£ç ")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆ›å»ºupdate")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" update "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createUpdate")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventTime"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lane"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" suspenseConfig"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  \n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// update.payloadä¸ºéœ€è¦æŒ‚è½½åœ¨æ ¹èŠ‚ç‚¹çš„ç»„ä»¶")]),t._v("\n  update"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("payload "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("element"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// callbackä¸ºReactDOM.renderçš„ç¬¬ä¸‰ä¸ªå‚æ•° â€”â€” å›è°ƒå‡½æ•°")]),t._v("\n  callback "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" callback "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" callback"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("callback "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    update"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("callback "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" callback"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å°†ç”Ÿæˆçš„updateåŠ å…¥updateQueue")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("enqueueUpdate")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("current"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" update"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è°ƒåº¦æ›´æ–°")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("scheduleUpdateOnFiber")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("current"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lane"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" eventTime"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...çœç•¥ä¸é€»è¾‘ä¸ç›¸å…³ä»£ç ")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("blockquote",[e("p",[t._v("ä½ å¯ä»¥ä»"),e("a",{attrs:{href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberReconciler.new.js#L255",target:"_blank",rel:"noopener noreferrer"}},[t._v("è¿™é‡Œ (opens new window)"),e("OutboundLink")],1),t._v("çœ‹åˆ°"),e("code",[t._v("updateContainer")]),t._v("çš„ä»£ç ")])]),t._v(" "),e("p",[t._v("å€¼å¾—æ³¨æ„çš„æ˜¯å…¶ä¸­"),e("code",[t._v("update.payload = {element};")])]),t._v(" "),e("p",[t._v("è¿™å°±æ˜¯æˆ‘ä»¬åœ¨"),e("a",{attrs:{href:"https://react.iamkasong.com/state/update.html#update%E7%9A%84%E7%BB%93%E6%9E%84",target:"_blank",rel:"noopener noreferrer"}},[t._v("Updateä¸€èŠ‚"),e("OutboundLink")],1),t._v("ä»‹ç»çš„ï¼Œå¯¹äº"),e("code",[t._v("HostRoot")]),t._v("ï¼Œ"),e("code",[t._v("payload")]),t._v("ä¸º"),e("code",[t._v("ReactDOM.render")]),t._v("çš„ç¬¬ä¸€ä¸ªä¼ å‚ã€‚")]),t._v(" "),e("h2",{attrs:{id:"æµç¨‹æ¦‚è§ˆ"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#æµç¨‹æ¦‚è§ˆ"}},[t._v("#")]),t._v(" "),e("a",{attrs:{href:"https://react.iamkasong.com/state/reactdom.html#%E6%B5%81%E7%A8%8B%E6%A6%82%E8%A7%88",target:"_blank",rel:"noopener noreferrer"}},[t._v("#"),e("OutboundLink")],1),t._v("æµç¨‹æ¦‚è§ˆ")]),t._v(" "),e("p",[t._v("è‡³æ­¤ï¼Œ"),e("code",[t._v("ReactDOM.render")]),t._v("çš„æµç¨‹å°±å’Œæˆ‘ä»¬å·²çŸ¥çš„æµç¨‹è¿æ¥ä¸Šäº†ã€‚")]),t._v(" "),e("p",[t._v("æ•´ä¸ªæµç¨‹å¦‚ä¸‹ï¼š")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("åˆ›å»ºfiberRootNodeã€rootFiberã€updateQueueï¼ˆ"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("legacyCreateRootFromDOMContainer"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("ï¼‰\n\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("v")]),t._v("\n\nåˆ›å»ºUpdateå¯¹è±¡ï¼ˆ"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("updateContainer"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("ï¼‰\n\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("v")]),t._v("\n\nä»fiberåˆ°rootï¼ˆ"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("markUpdateLaneFromFiberToRoot"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("ï¼‰\n\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("v")]),t._v("\n\nè°ƒåº¦æ›´æ–°ï¼ˆ"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("ensureRootIsScheduled"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("ï¼‰\n\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("v")]),t._v("\n\nrenderé˜¶æ®µï¼ˆ"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("performSyncWorkOnRoot"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v(" æˆ– "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("performConcurrentWorkOnRoot"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("ï¼‰\n\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("v")]),t._v("\n\ncommité˜¶æ®µï¼ˆ"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("commitRoot"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("ï¼‰\n")])])]),e("h2",{attrs:{id:"reactçš„å…¶ä»–å…¥å£å‡½æ•°"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#reactçš„å…¶ä»–å…¥å£å‡½æ•°"}},[t._v("#")]),t._v(" "),e("a",{attrs:{href:"https://react.iamkasong.com/state/reactdom.html#react%E7%9A%84%E5%85%B6%E4%BB%96%E5%85%A5%E5%8F%A3%E5%87%BD%E6%95%B0",target:"_blank",rel:"noopener noreferrer"}},[t._v("#"),e("OutboundLink")],1),t._v("Reactçš„å…¶ä»–å…¥å£å‡½æ•°")]),t._v(" "),e("p",[t._v("å½“å‰"),e("code",[t._v("React")]),t._v("å…±æœ‰ä¸‰ç§æ¨¡å¼ï¼š")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("legacy")]),t._v("ï¼Œè¿™æ˜¯å½“å‰"),e("code",[t._v("React")]),t._v("ä½¿ç”¨çš„æ–¹å¼ã€‚å½“å‰æ²¡æœ‰è®¡åˆ’åˆ é™¤æœ¬æ¨¡å¼ï¼Œä½†æ˜¯è¿™ä¸ªæ¨¡å¼å¯èƒ½ä¸æ”¯æŒä¸€äº›æ–°åŠŸèƒ½ã€‚")]),t._v(" "),e("li",[e("code",[t._v("blocking")]),t._v("ï¼Œå¼€å¯éƒ¨åˆ†"),e("code",[t._v("concurrent")]),t._v("æ¨¡å¼ç‰¹æ€§çš„ä¸­é—´æ¨¡å¼ã€‚ç›®å‰æ­£åœ¨å®éªŒä¸­ã€‚ä½œä¸ºè¿ç§»åˆ°"),e("code",[t._v("concurrent")]),t._v("æ¨¡å¼çš„ç¬¬ä¸€ä¸ªæ­¥éª¤ã€‚")]),t._v(" "),e("li",[e("code",[t._v("concurrent")]),t._v("ï¼Œé¢å‘æœªæ¥çš„å¼€å‘æ¨¡å¼ã€‚æˆ‘ä»¬ä¹‹å‰è®²çš„"),e("code",[t._v("ä»»åŠ¡ä¸­æ–­/ä»»åŠ¡ä¼˜å…ˆçº§")]),t._v("éƒ½æ˜¯é’ˆå¯¹"),e("code",[t._v("concurrent")]),t._v("æ¨¡å¼ã€‚")])]),t._v(" "),e("p",[t._v("ä½ å¯ä»¥ä»ä¸‹è¡¨çœ‹å‡ºå„ç§æ¨¡å¼å¯¹ç‰¹æ€§çš„æ”¯æŒï¼š")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th",[t._v("legacy æ¨¡å¼")]),t._v(" "),e("th",[t._v("blocking æ¨¡å¼")]),t._v(" "),e("th",[t._v("concurrent æ¨¡å¼")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[e("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/refs-and-the-dom.html#legacy-api-string-refs",target:"_blank",rel:"noopener noreferrer"}},[t._v("String Refs(opens new window)"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("âœ…")]),t._v(" "),e("td",[t._v("ğŸš«**")]),t._v(" "),e("td",[t._v("ğŸš«**")])]),t._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/legacy-context.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Legacy Context(opens new window)"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("âœ…")]),t._v(" "),e("td",[t._v("ğŸš«**")]),t._v(" "),e("td",[t._v("ğŸš«**")])]),t._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/strict-mode.html#warning-about-deprecated-finddomnode-usage",target:"_blank",rel:"noopener noreferrer"}},[t._v("findDOMNode(opens new window)"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("âœ…")]),t._v(" "),e("td",[t._v("ğŸš«**")]),t._v(" "),e("td",[t._v("ğŸš«**")])]),t._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/concurrent-mode-suspense.html#what-is-suspense-exactly",target:"_blank",rel:"noopener noreferrer"}},[t._v("Suspense(opens new window)"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("âœ…")]),t._v(" "),e("td",[t._v("âœ…")]),t._v(" "),e("td",[t._v("âœ…")])]),t._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/concurrent-mode-patterns.html#suspenselist",target:"_blank",rel:"noopener noreferrer"}},[t._v("SuspenseList(opens new window)"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("ğŸš«")]),t._v(" "),e("td",[t._v("âœ…")]),t._v(" "),e("td",[t._v("âœ…")])]),t._v(" "),e("tr",[e("td",[t._v("Suspense SSR + Hydration")]),t._v(" "),e("td",[t._v("ğŸš«")]),t._v(" "),e("td",[t._v("âœ…")]),t._v(" "),e("td",[t._v("âœ…")])]),t._v(" "),e("tr",[e("td",[t._v("Progressive Hydration")]),t._v(" "),e("td",[t._v("ğŸš«")]),t._v(" "),e("td",[t._v("âœ…")]),t._v(" "),e("td",[t._v("âœ…")])]),t._v(" "),e("tr",[e("td",[t._v("Selective Hydration")]),t._v(" "),e("td",[t._v("ğŸš«")]),t._v(" "),e("td",[t._v("ğŸš«")]),t._v(" "),e("td",[t._v("âœ…")])]),t._v(" "),e("tr",[e("td",[t._v("Cooperative Multitasking")]),t._v(" "),e("td",[t._v("ğŸš«")]),t._v(" "),e("td",[t._v("ğŸš«")]),t._v(" "),e("td",[t._v("âœ…")])]),t._v(" "),e("tr",[e("td",[t._v("Automatic batching of multiple setStates")]),t._v(" "),e("td",[t._v("ğŸš«*")]),t._v(" "),e("td",[t._v("âœ…")]),t._v(" "),e("td",[t._v("âœ…")])]),t._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/concurrent-mode-patterns.html#splitting-high-and-low-priority-state",target:"_blank",rel:"noopener noreferrer"}},[t._v("Priority-based Rendering(opens new window)"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("ğŸš«")]),t._v(" "),e("td",[t._v("ğŸš«")]),t._v(" "),e("td",[t._v("âœ…")])]),t._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/concurrent-mode-intro.html#interruptible-rendering",target:"_blank",rel:"noopener noreferrer"}},[t._v("Interruptible Prerendering(opens new window)"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("ğŸš«")]),t._v(" "),e("td",[t._v("ğŸš«")]),t._v(" "),e("td",[t._v("âœ…")])]),t._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/concurrent-mode-patterns.html#transitions",target:"_blank",rel:"noopener noreferrer"}},[t._v("useTransition(opens new window)"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("ğŸš«")]),t._v(" "),e("td",[t._v("ğŸš«")]),t._v(" "),e("td",[t._v("âœ…")])]),t._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/concurrent-mode-patterns.html#deferring-a-value",target:"_blank",rel:"noopener noreferrer"}},[t._v("useDeferredValue(opens new window)"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("ğŸš«")]),t._v(" "),e("td",[t._v("ğŸš«")]),t._v(" "),e("td",[t._v("âœ…")])]),t._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/concurrent-mode-patterns.html#suspense-reveal-train",target:"_blank",rel:"noopener noreferrer"}},[t._v('Suspense Reveal "Train"(opens new window)'),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("ğŸš«")]),t._v(" "),e("td",[t._v("ğŸš«")]),t._v(" "),e("td",[t._v("âœ…")])])])]),t._v(" "),e("p",[t._v("*ï¼š"),e("code",[t._v("legacy")]),t._v("æ¨¡å¼åœ¨åˆæˆäº‹ä»¶ä¸­æœ‰è‡ªåŠ¨æ‰¹å¤„ç†çš„åŠŸèƒ½ï¼Œä½†ä»…é™äºä¸€ä¸ªæµè§ˆå™¨ä»»åŠ¡ã€‚é"),e("code",[t._v("React")]),t._v("äº‹ä»¶æƒ³ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½å¿…é¡»ä½¿ç”¨ "),e("code",[t._v("unstable_batchedUpdates")]),t._v("ã€‚åœ¨"),e("code",[t._v("blocking")]),t._v("æ¨¡å¼å’Œ"),e("code",[t._v("concurrent")]),t._v("æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰çš„"),e("code",[t._v("setState")]),t._v("åœ¨é»˜è®¤æƒ…å†µä¸‹éƒ½æ˜¯æ‰¹å¤„ç†çš„ã€‚")]),t._v(" "),e("p",[t._v("**ï¼šä¼šåœ¨å¼€å‘ä¸­å‘å‡ºè­¦å‘Šã€‚")]),t._v(" "),e("p",[t._v("æ¨¡å¼çš„å˜åŒ–å½±å“æ•´ä¸ªåº”ç”¨çš„å·¥ä½œæ–¹å¼ï¼Œæ‰€ä»¥æ— æ³•åªé’ˆå¯¹æŸä¸ªç»„ä»¶å¼€å¯ä¸åŒæ¨¡å¼ã€‚")]),t._v(" "),e("p",[t._v("åŸºäºæ­¤åŸå› ï¼Œå¯ä»¥é€šè¿‡ä¸åŒçš„"),e("code",[t._v("å…¥å£å‡½æ•°")]),t._v("å¼€å¯ä¸åŒæ¨¡å¼ï¼š")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("legacy")]),t._v(" -- "),e("code",[t._v("ReactDOM.render(<App />, rootNode)")])]),t._v(" "),e("li",[e("code",[t._v("blocking")]),t._v(" -- "),e("code",[t._v("ReactDOM.createBlockingRoot(rootNode).render(<App />)")])]),t._v(" "),e("li",[e("code",[t._v("concurrent")]),t._v(" -- "),e("code",[t._v("ReactDOM.createRoot(rootNode).render(<App />)")])])]),t._v(" "),e("blockquote",[e("p",[t._v("ä½ å¯ä»¥åœ¨"),e("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/concurrent-mode-adoption.html#why-so-many-modes",target:"_blank",rel:"noopener noreferrer"}},[t._v("è¿™é‡Œ (opens new window)"),e("OutboundLink")],1),t._v("çœ‹åˆ°"),e("code",[t._v("React")]),t._v("å›¢é˜Ÿè§£é‡Šä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆå¤šæ¨¡å¼")])]),t._v(" "),e("p",[t._v("è™½ç„¶ä¸åŒæ¨¡å¼çš„"),e("code",[t._v("å…¥å£å‡½æ•°")]),t._v("ä¸åŒï¼Œä½†æ˜¯ä»–ä»¬ä»…å¯¹"),e("code",[t._v("fiber.mode")]),t._v("å˜é‡äº§ç”Ÿå½±å“ï¼Œå¯¹æˆ‘ä»¬åœ¨"),e("a",{attrs:{href:"https://react.iamkasong.com/state/reactdom.html#%E6%B5%81%E7%A8%8B%E6%A6%82%E8%A7%88",target:"_blank",rel:"noopener noreferrer"}},[t._v("æµç¨‹æ¦‚è§ˆ"),e("OutboundLink")],1),t._v("ä¸­æè¿°çš„æµç¨‹å¹¶æ— å½±å“ã€‚")]),t._v(" "),e("p",[t._v("å½“æˆ‘ä»¬æœ‰äº†å‰é¢çŸ¥è¯†çš„é“ºå«ï¼Œå°±å¾ˆå®¹æ˜“ç†è§£"),e("code",[t._v("this.setState")]),t._v("çš„å·¥ä½œæµç¨‹ã€‚")]),t._v(" "),e("h2",{attrs:{id:"æµç¨‹æ¦‚è§ˆ-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#æµç¨‹æ¦‚è§ˆ-2"}},[t._v("#")]),t._v(" "),e("a",{attrs:{href:"https://react.iamkasong.com/state/setstate.html#%E6%B5%81%E7%A8%8B%E6%A6%82%E8%A7%88",target:"_blank",rel:"noopener noreferrer"}},[t._v("#"),e("OutboundLink")],1),t._v("æµç¨‹æ¦‚è§ˆ")]),t._v(" "),e("p",[t._v("å¯ä»¥çœ‹åˆ°ï¼Œ"),e("code",[t._v("this.setState")]),t._v("å†…ä¼šè°ƒç”¨"),e("code",[t._v("this.updater.enqueueSetState")]),t._v("æ–¹æ³•ã€‚")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Component")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("setState")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("partialState"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" partialState "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'object'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" partialState "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'function'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" partialState "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Error")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"setState(...): takes an object of state variables to update or a function which returns an object of state variables."')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("updater"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("enqueueSetState")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" partialState"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'setState'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("blockquote",[e("p",[t._v("ä½ å¯ä»¥åœ¨"),e("a",{attrs:{href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react/src/ReactBaseClasses.js#L57",target:"_blank",rel:"noopener noreferrer"}},[t._v("è¿™é‡Œ (opens new window)"),e("OutboundLink")],1),t._v("çœ‹åˆ°è¿™æ®µä»£ç ")])]),t._v(" "),e("p",[t._v("åœ¨"),e("code",[t._v("enqueueSetState")]),t._v("æ–¹æ³•ä¸­å°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„ä»"),e("code",[t._v("åˆ›å»ºupdate")]),t._v("åˆ°"),e("code",[t._v("è°ƒåº¦update")]),t._v("çš„æµç¨‹äº†ã€‚")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("enqueueSetState")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("inst"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" payload"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// é€šè¿‡ç»„ä»¶å®ä¾‹è·å–å¯¹åº”fiber")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fiber "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("getInstance")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("inst"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" eventTime "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestEventTime")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" suspenseConfig "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestCurrentSuspenseConfig")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è·å–ä¼˜å…ˆçº§")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" lane "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestUpdateLane")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fiber"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" suspenseConfig"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆ›å»ºupdate")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" update "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createUpdate")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventTime"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lane"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" suspenseConfig"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  update"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("payload "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" payload"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// èµ‹å€¼å›è°ƒå‡½æ•°")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("callback "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" callback "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    update"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("callback "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" callback"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å°†updateæ’å…¥updateQueue")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("enqueueUpdate")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fiber"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" update"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è°ƒåº¦update")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("scheduleUpdateOnFiber")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fiber"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lane"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" eventTime"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("blockquote",[e("p",[t._v("ä½ å¯ä»¥åœ¨"),e("a",{attrs:{href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberClassComponent.old.js#L196",target:"_blank",rel:"noopener noreferrer"}},[t._v("è¿™é‡Œ (opens new window)"),e("OutboundLink")],1),t._v("çœ‹åˆ°"),e("code",[t._v("enqueueSetState")]),t._v("ä»£ç ")])]),t._v(" "),e("p",[t._v("è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯å¯¹äº"),e("code",[t._v("ClassComponent")]),t._v("ï¼Œ"),e("code",[t._v("update.payload")]),t._v("ä¸º"),e("code",[t._v("this.setState")]),t._v("çš„ç¬¬ä¸€ä¸ªä¼ å‚ï¼ˆå³è¦æ”¹å˜çš„"),e("code",[t._v("state")]),t._v("ï¼‰ã€‚")]),t._v(" "),e("h2",{attrs:{id:"this-forceupdate"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#this-forceupdate"}},[t._v("#")]),t._v(" "),e("a",{attrs:{href:"https://react.iamkasong.com/state/setstate.html#this-forceupdate",target:"_blank",rel:"noopener noreferrer"}},[t._v("#"),e("OutboundLink")],1),t._v("this.forceUpdate")]),t._v(" "),e("p",[t._v("åœ¨"),e("code",[t._v("this.updater")]),t._v("ä¸Šï¼Œé™¤äº†"),e("code",[t._v("enqueueSetState")]),t._v("å¤–ï¼Œè¿˜å­˜åœ¨"),e("code",[t._v("enqueueForceUpdate")]),t._v("ï¼Œå½“æˆ‘ä»¬è°ƒç”¨"),e("code",[t._v("this.forceUpdate")]),t._v("æ—¶ä¼šè°ƒç”¨ä»–ã€‚")]),t._v(" "),e("p",[t._v("å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†èµ‹å€¼"),e("code",[t._v("update.tag = ForceUpdate;")]),t._v("ä»¥åŠæ²¡æœ‰"),e("code",[t._v("payload")]),t._v("å¤–ï¼Œå…¶ä»–é€»è¾‘ä¸"),e("code",[t._v("this.setState")]),t._v("ä¸€è‡´ã€‚")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("enqueueForceUpdate")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("inst"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fiber "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("getInstance")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("inst"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" eventTime "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestEventTime")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" suspenseConfig "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestCurrentSuspenseConfig")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" lane "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestUpdateLane")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fiber"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" suspenseConfig"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" update "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createUpdate")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventTime"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lane"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" suspenseConfig"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// èµ‹å€¼tagä¸ºForceUpdate")]),t._v("\n    update"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tag "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ForceUpdate"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("callback "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" callback "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      update"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("callback "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" callback"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("enqueueUpdate")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fiber"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" update"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("scheduleUpdateOnFiber")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fiber"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lane"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" eventTime"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("blockquote",[e("p",[t._v("ä½ å¯ä»¥åœ¨"),e("a",{attrs:{href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberClassComponent.old.js#L260",target:"_blank",rel:"noopener noreferrer"}},[t._v("è¿™é‡Œ (opens new window)"),e("OutboundLink")],1),t._v("çœ‹åˆ°"),e("code",[t._v("enqueueForceUpdate")]),t._v("ä»£ç ")])]),t._v(" "),e("p",[t._v("é‚£ä¹ˆèµ‹å€¼"),e("code",[t._v("update.tag = ForceUpdate;")]),t._v("æœ‰ä½•ä½œç”¨å‘¢ï¼Ÿ")]),t._v(" "),e("p",[t._v("åœ¨åˆ¤æ–­"),e("code",[t._v("ClassComponent")]),t._v("æ˜¯å¦éœ€è¦æ›´æ–°æ—¶æœ‰ä¸¤ä¸ªæ¡ä»¶éœ€è¦æ»¡è¶³ï¼š")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" shouldUpdate "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("checkHasForceUpdateAfterProcessing")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("checkShouldComponentUpdate")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    workInProgress"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    ctor"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    oldProps"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    newProps"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    oldState"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    newState"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    nextContext"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("blockquote",[e("p",[t._v("ä½ å¯ä»¥åœ¨"),e("a",{attrs:{href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberClassComponent.old.js#L1137",target:"_blank",rel:"noopener noreferrer"}},[t._v("è¿™é‡Œ (opens new window)"),e("OutboundLink")],1),t._v("çœ‹åˆ°è¿™æ®µä»£ç ")])]),t._v(" "),e("ul",[e("li",[t._v("checkHasForceUpdateAfterProcessingï¼šå†…éƒ¨ä¼šåˆ¤æ–­æœ¬æ¬¡æ›´æ–°çš„"),e("code",[t._v("Update")]),t._v("æ˜¯å¦ä¸º"),e("code",[t._v("ForceUpdate")]),t._v("ã€‚å³å¦‚æœæœ¬æ¬¡æ›´æ–°çš„"),e("code",[t._v("Update")]),t._v("ä¸­å­˜åœ¨"),e("code",[t._v("tag")]),t._v("ä¸º"),e("code",[t._v("ForceUpdate")]),t._v("ï¼Œåˆ™è¿”å›"),e("code",[t._v("true")]),t._v("ã€‚")]),t._v(" "),e("li",[t._v("checkShouldComponentUpdateï¼šå†…éƒ¨ä¼šè°ƒç”¨"),e("code",[t._v("shouldComponentUpdate")]),t._v("æ–¹æ³•ã€‚ä»¥åŠå½“è¯¥"),e("code",[t._v("ClassComponent")]),t._v("ä¸º"),e("code",[t._v("PureComponent")]),t._v("æ—¶ä¼šæµ…æ¯”è¾ƒ"),e("code",[t._v("state")]),t._v("ä¸"),e("code",[t._v("props")]),t._v("ã€‚")])]),t._v(" "),e("blockquote",[e("p",[t._v("ä½ å¯ä»¥åœ¨"),e("a",{attrs:{href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberClassComponent.old.js#L294",target:"_blank",rel:"noopener noreferrer"}},[t._v("è¿™é‡Œ (opens new window)"),e("OutboundLink")],1),t._v("çœ‹åˆ°"),e("code",[t._v("checkShouldComponentUpdate")]),t._v("ä»£ç ")])]),t._v(" "),e("p",[t._v("æ‰€ä»¥ï¼Œå½“æŸæ¬¡æ›´æ–°å«æœ‰"),e("code",[t._v("tag")]),t._v("ä¸º"),e("code",[t._v("ForceUpdate")]),t._v("çš„"),e("code",[t._v("Update")]),t._v("ï¼Œé‚£ä¹ˆå½“å‰"),e("code",[t._v("ClassComponent")]),t._v("ä¸ä¼šå—å…¶ä»–"),e("code",[t._v("æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µ")]),t._v("ï¼ˆ"),e("code",[t._v("shouldComponentUpdate")]),t._v("|"),e("code",[t._v("PureComponent")]),t._v("ï¼‰å½±å“ï¼Œä¸€å®šä¼šæ›´æ–°ã€‚")]),t._v(" "),e("h2",{attrs:{id:"æ€»ç»“"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“"}},[t._v("#")]),t._v(" "),e("a",{attrs:{href:"https://react.iamkasong.com/state/setstate.html#%E6%80%BB%E7%BB%93",target:"_blank",rel:"noopener noreferrer"}},[t._v("#"),e("OutboundLink")],1),t._v("æ€»ç»“")]),t._v(" "),e("p",[t._v("è‡³æ­¤ï¼Œæˆ‘ä»¬å­¦ä¹ å®Œäº†"),e("code",[t._v("HostRoot | ClassComponent")]),t._v("æ‰€ä½¿ç”¨çš„"),e("code",[t._v("Update")]),t._v("çš„æ›´æ–°æµç¨‹ã€‚")]),t._v(" "),e("p",[t._v("åœ¨ä¸‹ä¸€ç« æˆ‘ä»¬ä¼šå­¦ä¹ å¦ä¸€ç§æ•°æ®ç»“æ„çš„"),e("code",[t._v("Update")]),t._v(" â€”â€” ç”¨äº"),e("code",[t._v("Hooks")]),t._v("çš„"),e("code",[t._v("Update")]),t._v("ã€‚")])])}),[],!1,null,null,null);a.default=n.exports}}]);