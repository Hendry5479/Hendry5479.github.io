<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>英俊的大亨亨</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="heng.png">
    <meta name="description" content="记录下有趣岁月的点点滴滴">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.b51e4ccd.js" as="script"><link rel="preload" href="/assets/js/2.7229199a.js" as="script"><link rel="preload" href="/assets/js/47.eb0ac18a.js" as="script"><link rel="prefetch" href="/assets/js/10.00f8a9d8.js"><link rel="prefetch" href="/assets/js/100.78dfd44a.js"><link rel="prefetch" href="/assets/js/101.cdae98a0.js"><link rel="prefetch" href="/assets/js/102.6a3dd9e0.js"><link rel="prefetch" href="/assets/js/103.cfed07a2.js"><link rel="prefetch" href="/assets/js/104.a16a4843.js"><link rel="prefetch" href="/assets/js/105.9cd1add0.js"><link rel="prefetch" href="/assets/js/106.546c1ad8.js"><link rel="prefetch" href="/assets/js/107.04b38bf9.js"><link rel="prefetch" href="/assets/js/108.31a22b61.js"><link rel="prefetch" href="/assets/js/109.1f2a1840.js"><link rel="prefetch" href="/assets/js/11.e2689dc6.js"><link rel="prefetch" href="/assets/js/110.9dc2f13b.js"><link rel="prefetch" href="/assets/js/111.35cf70f8.js"><link rel="prefetch" href="/assets/js/112.39a6579b.js"><link rel="prefetch" href="/assets/js/113.cbfc279d.js"><link rel="prefetch" href="/assets/js/114.878470a2.js"><link rel="prefetch" href="/assets/js/115.86dc4d8e.js"><link rel="prefetch" href="/assets/js/116.d2e05b2c.js"><link rel="prefetch" href="/assets/js/117.7525671d.js"><link rel="prefetch" href="/assets/js/118.a5c04c6d.js"><link rel="prefetch" href="/assets/js/119.613a81e1.js"><link rel="prefetch" href="/assets/js/12.0b7aaea4.js"><link rel="prefetch" href="/assets/js/120.ec6d3159.js"><link rel="prefetch" href="/assets/js/121.6705f783.js"><link rel="prefetch" href="/assets/js/122.7b3fe034.js"><link rel="prefetch" href="/assets/js/123.9336f454.js"><link rel="prefetch" href="/assets/js/124.dca9fc87.js"><link rel="prefetch" href="/assets/js/125.338aa4d8.js"><link rel="prefetch" href="/assets/js/126.a731a9eb.js"><link rel="prefetch" href="/assets/js/127.da74dd90.js"><link rel="prefetch" href="/assets/js/128.3d5e86f2.js"><link rel="prefetch" href="/assets/js/129.ee43b65c.js"><link rel="prefetch" href="/assets/js/13.31064a46.js"><link rel="prefetch" href="/assets/js/130.8a273d75.js"><link rel="prefetch" href="/assets/js/131.a89df4ac.js"><link rel="prefetch" href="/assets/js/132.0daac28c.js"><link rel="prefetch" href="/assets/js/133.b1f23c92.js"><link rel="prefetch" href="/assets/js/134.78621a9c.js"><link rel="prefetch" href="/assets/js/135.f0884a8b.js"><link rel="prefetch" href="/assets/js/136.45114430.js"><link rel="prefetch" href="/assets/js/137.eb295fce.js"><link rel="prefetch" href="/assets/js/138.cc7dc8d3.js"><link rel="prefetch" href="/assets/js/139.c9b1aad6.js"><link rel="prefetch" href="/assets/js/14.0be4ee49.js"><link rel="prefetch" href="/assets/js/15.685fab30.js"><link rel="prefetch" href="/assets/js/16.97f8b16a.js"><link rel="prefetch" href="/assets/js/17.9c7bebeb.js"><link rel="prefetch" href="/assets/js/18.965d9e47.js"><link rel="prefetch" href="/assets/js/19.3d59a8e1.js"><link rel="prefetch" href="/assets/js/20.1573d510.js"><link rel="prefetch" href="/assets/js/21.f46234dd.js"><link rel="prefetch" href="/assets/js/22.6c16fd38.js"><link rel="prefetch" href="/assets/js/23.50a2a38a.js"><link rel="prefetch" href="/assets/js/24.8aff8273.js"><link rel="prefetch" href="/assets/js/25.35a7c496.js"><link rel="prefetch" href="/assets/js/26.af233874.js"><link rel="prefetch" href="/assets/js/27.a3a96a5a.js"><link rel="prefetch" href="/assets/js/28.a1d49602.js"><link rel="prefetch" href="/assets/js/29.174b7d7d.js"><link rel="prefetch" href="/assets/js/3.6038f64c.js"><link rel="prefetch" href="/assets/js/30.a4115d32.js"><link rel="prefetch" href="/assets/js/31.1522875a.js"><link rel="prefetch" href="/assets/js/32.35da527d.js"><link rel="prefetch" href="/assets/js/33.814d63e8.js"><link rel="prefetch" href="/assets/js/34.615b49c1.js"><link rel="prefetch" href="/assets/js/35.856ab789.js"><link rel="prefetch" href="/assets/js/36.2987bc62.js"><link rel="prefetch" href="/assets/js/37.084d12aa.js"><link rel="prefetch" href="/assets/js/38.088f3091.js"><link rel="prefetch" href="/assets/js/39.4ea066d5.js"><link rel="prefetch" href="/assets/js/4.c610d016.js"><link rel="prefetch" href="/assets/js/40.97850ba9.js"><link rel="prefetch" href="/assets/js/41.8b8ae086.js"><link rel="prefetch" href="/assets/js/42.8ae2cac3.js"><link rel="prefetch" href="/assets/js/43.f8a28187.js"><link rel="prefetch" href="/assets/js/44.5160f68a.js"><link rel="prefetch" href="/assets/js/45.6d4b7130.js"><link rel="prefetch" href="/assets/js/46.44693348.js"><link rel="prefetch" href="/assets/js/48.ce1c6335.js"><link rel="prefetch" href="/assets/js/49.7ec1b16a.js"><link rel="prefetch" href="/assets/js/5.216dfe20.js"><link rel="prefetch" href="/assets/js/50.1f503aa4.js"><link rel="prefetch" href="/assets/js/51.47971163.js"><link rel="prefetch" href="/assets/js/52.e5f681d7.js"><link rel="prefetch" href="/assets/js/53.df89fbb7.js"><link rel="prefetch" href="/assets/js/54.a140a8dd.js"><link rel="prefetch" href="/assets/js/55.5809711e.js"><link rel="prefetch" href="/assets/js/56.3a62759d.js"><link rel="prefetch" href="/assets/js/57.c9bd4339.js"><link rel="prefetch" href="/assets/js/58.acb475d1.js"><link rel="prefetch" href="/assets/js/59.61cf3322.js"><link rel="prefetch" href="/assets/js/6.73a8f323.js"><link rel="prefetch" href="/assets/js/60.aa39146e.js"><link rel="prefetch" href="/assets/js/61.f62972b8.js"><link rel="prefetch" href="/assets/js/62.79fc1ddc.js"><link rel="prefetch" href="/assets/js/63.808c750c.js"><link rel="prefetch" href="/assets/js/64.4e99e2e1.js"><link rel="prefetch" href="/assets/js/65.f112caec.js"><link rel="prefetch" href="/assets/js/66.422cc6c9.js"><link rel="prefetch" href="/assets/js/67.f504a803.js"><link rel="prefetch" href="/assets/js/68.f8e84a65.js"><link rel="prefetch" href="/assets/js/69.af07ae00.js"><link rel="prefetch" href="/assets/js/7.a6e60d89.js"><link rel="prefetch" href="/assets/js/70.9b212396.js"><link rel="prefetch" href="/assets/js/71.049b7d3e.js"><link rel="prefetch" href="/assets/js/72.b508f834.js"><link rel="prefetch" href="/assets/js/73.52a25a21.js"><link rel="prefetch" href="/assets/js/74.68de4c01.js"><link rel="prefetch" href="/assets/js/75.c0d8e99a.js"><link rel="prefetch" href="/assets/js/76.672b246e.js"><link rel="prefetch" href="/assets/js/77.36d886e3.js"><link rel="prefetch" href="/assets/js/78.079ebfd8.js"><link rel="prefetch" href="/assets/js/79.d3d3e8ea.js"><link rel="prefetch" href="/assets/js/8.a72c567f.js"><link rel="prefetch" href="/assets/js/80.c690c3d9.js"><link rel="prefetch" href="/assets/js/81.c012b7d5.js"><link rel="prefetch" href="/assets/js/82.47ffa460.js"><link rel="prefetch" href="/assets/js/83.2ba84114.js"><link rel="prefetch" href="/assets/js/84.dc0bf5a8.js"><link rel="prefetch" href="/assets/js/85.d968ae8b.js"><link rel="prefetch" href="/assets/js/86.91000a3b.js"><link rel="prefetch" href="/assets/js/87.6e885c71.js"><link rel="prefetch" href="/assets/js/88.99dd2b79.js"><link rel="prefetch" href="/assets/js/89.601c57ea.js"><link rel="prefetch" href="/assets/js/9.c59ba06b.js"><link rel="prefetch" href="/assets/js/90.89ee0da5.js"><link rel="prefetch" href="/assets/js/91.854de449.js"><link rel="prefetch" href="/assets/js/92.7a25d006.js"><link rel="prefetch" href="/assets/js/93.17f89281.js"><link rel="prefetch" href="/assets/js/94.0f6749b9.js"><link rel="prefetch" href="/assets/js/95.41ef6f4a.js"><link rel="prefetch" href="/assets/js/96.12427920.js"><link rel="prefetch" href="/assets/js/97.53036963.js"><link rel="prefetch" href="/assets/js/98.43d8f870.js"><link rel="prefetch" href="/assets/js/99.4ab32fce.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/heng.png" alt="英俊的大亨亨" class="logo"> <span class="site-name can-hide">英俊的大亨亨</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">js</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">js</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/js/js-基础.html" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/js/js-数组.html" class="nav-link">
  数组
</a></li><li class="dropdown-item"><!----> <a href="/js/js-异步.html" class="nav-link">
  异步
</a></li><li class="dropdown-item"><!----> <a href="/js/js-es6.html" class="nav-link">
  es6
</a></li><li class="dropdown-item"><!----> <a href="/js/js-v8引擎.html" class="nav-link">
  v8
</a></li><li class="dropdown-item"><!----> <a href="/手写代码/1.js基础.html" class="nav-link">
  手写
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/react/process.html" class="nav-link">
  
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/html.html" class="nav-link">
  html
</a></li><li class="dropdown-item"><!----> <a href="/css.html" class="nav-link">
  css
</a></li><li class="dropdown-item"><!----> <a href="/node.html" class="nav-link">
  node
</a></li><li class="dropdown-item"><!----> <a href="/webpack.html" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/webpack.html" class="nav-link">
  小程序
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="leetcode" class="dropdown-title"><span class="title">leetcode</span> <span class="arrow down"></span></button> <button type="button" aria-label="leetcode" class="mobile-dropdown-title"><span class="title">leetcode</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/代码随想录/1.数组.html" class="nav-link">
  1.数组
</a></li><li class="dropdown-item"><!----> <a href="/代码随想录/10.动态规划/1.基础.html" class="nav-link">
  10.动态规划
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">react源码</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">react源码</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react源码/理念.html" class="nav-link">
  1.理念
</a></li><li class="dropdown-item"><!----> <a href="/react源码/3.render.html" class="nav-link">
  3.render
</a></li><li class="dropdown-item"><!----> <a href="/react源码/4.commit.html" class="nav-link">
  4.commit
</a></li><li class="dropdown-item"><!----> <a href="/react源码/5.状态更新.html" class="nav-link">
  5.状态更新
</a></li><li class="dropdown-item"><!----> <a href="/react源码/6.diff.html" class="nav-link">
  6.diff
</a></li><li class="dropdown-item"><!----> <a href="/react/7.实现hooks.html" class="nav-link">
  7.实现hooks
</a></li><li class="dropdown-item"><!----> <a href="/react/8.concurrentMode.html" class="nav-link">
  8.concurrentMode
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">webpack</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">webpack</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/webpack/1.配置.html" class="nav-link">
  1.配置
</a></li><li class="dropdown-item"><!----> <a href="/webpack/2.loader.html" class="nav-link">
  2.loader
</a></li><li class="dropdown-item"><!----> <a href="/webpack/3.plugin.html" class="nav-link">
  3.plugin
</a></li><li class="dropdown-item"><!----> <a href="/webpack/4.模块化原理.html" class="nav-link">
  4.模块化原理
</a></li><li class="dropdown-item"><!----> <a href="/webpack/5.babel.html" class="nav-link">
  5.babel
</a></li><li class="dropdown-item"><!----> <a href="/webpack/6.HMR.html" class="nav-link">
  6.HMR
</a></li><li class="dropdown-item"><!----> <a href="/webpack/7.环境分离.html" class="nav-link">
  7.环境分离
</a></li><li class="dropdown-item"><!----> <a href="/webpack/8.tree_shaking.html" class="nav-link">
  8.tree_shaking
</a></li><li class="dropdown-item"><!----> <a href="/webpack/9,源码.html" class="nav-link">
  9.源码
</a></li><li class="dropdown-item"><!----> <a href="/webpack/11.自定义loader.html" class="nav-link">
  11.自定义loader
</a></li><li class="dropdown-item"><!----> <a href="/webpack/12.自定义plugin.html" class="nav-link">
  12.自定义plugin
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">前端设计模式</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">前端设计模式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/设计模式/创建型.html" class="nav-link">
  创建型
</a></li><li class="dropdown-item"><!----> <a href="/设计模式/结构型.html" class="nav-link">
  结构型
</a></li><li class="dropdown-item"><!----> <a href="/设计模式/行为型.html" class="nav-link">
  行为型
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">angular</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">angular</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react/react%E6%BA%90%E7%A0%81/.html" class="nav-link">
  angular性能调优
</a></li><li class="dropdown-item"><!----> <a href="/设计模式/结构型.html" class="nav-link">
  angular源码理解
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">健身</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">健身</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react/react%E6%BA%90%E7%A0%81/.html" class="nav-link">
  angular性能调优
</a></li><li class="dropdown-item"><!----> <a href="/设计模式/结构型.html" class="nav-link">
  angular源码理解
</a></li></ul></div></div><div class="nav-item"><a href="/me.html" class="nav-link">
  关于我
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">js</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">js</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/js/js-基础.html" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/js/js-数组.html" class="nav-link">
  数组
</a></li><li class="dropdown-item"><!----> <a href="/js/js-异步.html" class="nav-link">
  异步
</a></li><li class="dropdown-item"><!----> <a href="/js/js-es6.html" class="nav-link">
  es6
</a></li><li class="dropdown-item"><!----> <a href="/js/js-v8引擎.html" class="nav-link">
  v8
</a></li><li class="dropdown-item"><!----> <a href="/手写代码/1.js基础.html" class="nav-link">
  手写
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/react/process.html" class="nav-link">
  
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/html.html" class="nav-link">
  html
</a></li><li class="dropdown-item"><!----> <a href="/css.html" class="nav-link">
  css
</a></li><li class="dropdown-item"><!----> <a href="/node.html" class="nav-link">
  node
</a></li><li class="dropdown-item"><!----> <a href="/webpack.html" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/webpack.html" class="nav-link">
  小程序
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="leetcode" class="dropdown-title"><span class="title">leetcode</span> <span class="arrow down"></span></button> <button type="button" aria-label="leetcode" class="mobile-dropdown-title"><span class="title">leetcode</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/代码随想录/1.数组.html" class="nav-link">
  1.数组
</a></li><li class="dropdown-item"><!----> <a href="/代码随想录/10.动态规划/1.基础.html" class="nav-link">
  10.动态规划
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">react源码</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">react源码</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react源码/理念.html" class="nav-link">
  1.理念
</a></li><li class="dropdown-item"><!----> <a href="/react源码/3.render.html" class="nav-link">
  3.render
</a></li><li class="dropdown-item"><!----> <a href="/react源码/4.commit.html" class="nav-link">
  4.commit
</a></li><li class="dropdown-item"><!----> <a href="/react源码/5.状态更新.html" class="nav-link">
  5.状态更新
</a></li><li class="dropdown-item"><!----> <a href="/react源码/6.diff.html" class="nav-link">
  6.diff
</a></li><li class="dropdown-item"><!----> <a href="/react/7.实现hooks.html" class="nav-link">
  7.实现hooks
</a></li><li class="dropdown-item"><!----> <a href="/react/8.concurrentMode.html" class="nav-link">
  8.concurrentMode
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">webpack</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">webpack</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/webpack/1.配置.html" class="nav-link">
  1.配置
</a></li><li class="dropdown-item"><!----> <a href="/webpack/2.loader.html" class="nav-link">
  2.loader
</a></li><li class="dropdown-item"><!----> <a href="/webpack/3.plugin.html" class="nav-link">
  3.plugin
</a></li><li class="dropdown-item"><!----> <a href="/webpack/4.模块化原理.html" class="nav-link">
  4.模块化原理
</a></li><li class="dropdown-item"><!----> <a href="/webpack/5.babel.html" class="nav-link">
  5.babel
</a></li><li class="dropdown-item"><!----> <a href="/webpack/6.HMR.html" class="nav-link">
  6.HMR
</a></li><li class="dropdown-item"><!----> <a href="/webpack/7.环境分离.html" class="nav-link">
  7.环境分离
</a></li><li class="dropdown-item"><!----> <a href="/webpack/8.tree_shaking.html" class="nav-link">
  8.tree_shaking
</a></li><li class="dropdown-item"><!----> <a href="/webpack/9,源码.html" class="nav-link">
  9.源码
</a></li><li class="dropdown-item"><!----> <a href="/webpack/11.自定义loader.html" class="nav-link">
  11.自定义loader
</a></li><li class="dropdown-item"><!----> <a href="/webpack/12.自定义plugin.html" class="nav-link">
  12.自定义plugin
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">前端设计模式</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">前端设计模式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/设计模式/创建型.html" class="nav-link">
  创建型
</a></li><li class="dropdown-item"><!----> <a href="/设计模式/结构型.html" class="nav-link">
  结构型
</a></li><li class="dropdown-item"><!----> <a href="/设计模式/行为型.html" class="nav-link">
  行为型
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">angular</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">angular</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react/react%E6%BA%90%E7%A0%81/.html" class="nav-link">
  angular性能调优
</a></li><li class="dropdown-item"><!----> <a href="/设计模式/结构型.html" class="nav-link">
  angular源码理解
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">健身</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">健身</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react/react%E6%BA%90%E7%A0%81/.html" class="nav-link">
  angular性能调优
</a></li><li class="dropdown-item"><!----> <a href="/设计模式/结构型.html" class="nav-link">
  angular源码理解
</a></li></ul></div></div><div class="nav-item"><a href="/me.html" class="nav-link">
  关于我
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>react源码</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/react/react源码/1.理念篇.html" class="sidebar-link">理念篇</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/react源码/1.理念篇.html#_1-react16架构" class="sidebar-link">1. React16架构</a></li><li class="sidebar-sub-header"><a href="/react/react源码/1.理念篇.html#_2-fiber结构" class="sidebar-link">2. Fiber结构</a></li><li class="sidebar-sub-header"><a href="/react/react源码/1.理念篇.html#_3-双缓存fiber树" class="sidebar-link">3. 双缓存Fiber树</a></li></ul></li><li><a href="/react/react源码/3.render.html" class="sidebar-link">Reconcile（render阶段）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/react源码/3.render.html#递-阶段" class="sidebar-link">“递”阶段</a></li><li class="sidebar-sub-header"><a href="/react/react源码/3.render.html#归-阶段" class="sidebar-link">“归”阶段</a></li><li class="sidebar-sub-header"><a href="/react/react源码/3.render.html#update时" class="sidebar-link">update时</a></li><li class="sidebar-sub-header"><a href="/react/react源码/3.render.html#mount时" class="sidebar-link">mount时</a></li><li class="sidebar-sub-header"><a href="/react/react源码/3.render.html#reconcilechildren" class="sidebar-link">reconcileChildren</a></li><li class="sidebar-sub-header"><a href="/react/react源码/3.render.html#effecttag" class="sidebar-link">effectTag</a></li><li class="sidebar-sub-header"><a href="/react/react源码/3.render.html#流程概览" class="sidebar-link">流程概览</a></li><li class="sidebar-sub-header"><a href="/react/react源码/3.render.html#处理hostcomponent" class="sidebar-link">处理HostComponent</a></li><li class="sidebar-sub-header"><a href="/react/react源码/3.render.html#update时-2" class="sidebar-link">update时</a></li><li class="sidebar-sub-header"><a href="/react/react源码/3.render.html#mount时-2" class="sidebar-link">mount时</a></li><li class="sidebar-sub-header"><a href="/react/react源码/3.render.html#effectlist" class="sidebar-link">effectList</a></li><li class="sidebar-sub-header"><a href="/react/react源码/3.render.html#流程结尾" class="sidebar-link">流程结尾</a></li></ul></li><li><a href="/react/react源码/4.commit.html" class="sidebar-link">/react/react源码/4.commit.html</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/react源码/4.commit.html#before-mutation之前" class="sidebar-link">before mutation之前</a></li><li class="sidebar-sub-header"><a href="/react/react源码/4.commit.html#layout之后" class="sidebar-link">layout之后</a></li><li class="sidebar-sub-header"><a href="/react/react源码/4.commit.html#beforemutation" class="sidebar-link">beforeMutation</a></li><li class="sidebar-sub-header"><a href="/react/react源码/4.commit.html#commitbeforemutationeffects" class="sidebar-link">commitBeforeMutationEffects</a></li><li class="sidebar-sub-header"><a href="/react/react源码/4.commit.html#调用getsnapshotbeforeupdate" class="sidebar-link">调用getSnapshotBeforeUpdate</a></li><li class="sidebar-sub-header"><a href="/react/react源码/4.commit.html#调度useeffect" class="sidebar-link">调度useEffect</a></li><li class="sidebar-sub-header"><a href="/react/react源码/4.commit.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/react/react源码/4.commit.html#概览" class="sidebar-link">概览</a></li><li class="sidebar-sub-header"><a href="/react/react源码/4.commit.html#commitmutationeffects" class="sidebar-link">commitMutationEffects</a></li><li class="sidebar-sub-header"><a href="/react/react源码/4.commit.html#placement-effect" class="sidebar-link">Placement effect</a></li><li class="sidebar-sub-header"><a href="/react/react源码/4.commit.html#update-effect" class="sidebar-link">Update effect</a></li><li class="sidebar-sub-header"><a href="/react/react源码/4.commit.html#deletion-effect" class="sidebar-link">Deletion effect</a></li><li class="sidebar-sub-header"><a href="/react/react源码/4.commit.html#总结-2" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/react/react源码/4.commit.html#概览-2" class="sidebar-link">概览</a></li><li class="sidebar-sub-header"><a href="/react/react源码/4.commit.html#commitlayouteffects" class="sidebar-link">commitLayoutEffects</a></li><li class="sidebar-sub-header"><a href="/react/react源码/4.commit.html#commitlayouteffectonfiber" class="sidebar-link">commitLayoutEffectOnFiber</a></li><li class="sidebar-sub-header"><a href="/react/react源码/4.commit.html#commitattachref" class="sidebar-link">commitAttachRef</a></li><li class="sidebar-sub-header"><a href="/react/react源码/4.commit.html#current-fiber树切换" class="sidebar-link">current Fiber树切换</a></li><li class="sidebar-sub-header"><a href="/react/react源码/4.commit.html#总结-3" class="sidebar-link">总结</a></li></ul></li><li><a href="/react/react源码/5.diff算法.html" class="sidebar-link">/react/react源码/5.diff算法.html</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/react源码/5.diff算法.html#diff的瓶颈以及react如何应对" class="sidebar-link">Diff的瓶颈以及React如何应对</a></li><li class="sidebar-sub-header"><a href="/react/react源码/5.diff算法.html#diff是如何实现的" class="sidebar-link">Diff是如何实现的</a></li><li class="sidebar-sub-header"><a href="/react/react源码/5.diff算法.html#练习题" class="sidebar-link">[#](https://react.iamkasong.com/diff/one.html#练习题)练习题</a></li><li class="sidebar-sub-header"><a href="/react/react源码/5.diff算法.html#概览" class="sidebar-link">[#](https://react.iamkasong.com/diff/multi.html#概览)概览</a></li><li class="sidebar-sub-header"><a href="/react/react源码/5.diff算法.html#diff的思路" class="sidebar-link">[#](https://react.iamkasong.com/diff/multi.html#diff的思路)Diff的思路</a></li><li class="sidebar-sub-header"><a href="/react/react源码/5.diff算法.html#第一轮遍历" class="sidebar-link">[#](https://react.iamkasong.com/diff/multi.html#第一轮遍历)第一轮遍历</a></li><li class="sidebar-sub-header"><a href="/react/react源码/5.diff算法.html#第二轮遍历" class="sidebar-link">[#](https://react.iamkasong.com/diff/multi.html#第二轮遍历)第二轮遍历</a></li><li class="sidebar-sub-header"><a href="/react/react源码/5.diff算法.html#处理移动的节点" class="sidebar-link">[#](https://react.iamkasong.com/diff/multi.html#处理移动的节点)处理移动的节点</a></li><li class="sidebar-sub-header"><a href="/react/react源码/5.diff算法.html#标记节点是否移动" class="sidebar-link">[#](https://react.iamkasong.com/diff/multi.html#标记节点是否移动)标记节点是否移动</a></li><li class="sidebar-sub-header"><a href="/react/react源码/5.diff算法.html#demo1" class="sidebar-link">[#](https://react.iamkasong.com/diff/multi.html#demo1)Demo1</a></li><li class="sidebar-sub-header"><a href="/react/react源码/5.diff算法.html#demo2" class="sidebar-link">[#](https://react.iamkasong.com/diff/multi.html#demo2)Demo2</a></li></ul></li><li><a href="/react/react源码/6.1.状态更新.html" class="sidebar-link">几个关键节点</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/react源码/6.1.状态更新.html#几个关键节点" class="sidebar-link">几个关键节点</a></li><li class="sidebar-sub-header"><a href="/react/react源码/6.1.状态更新.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/react/react源码/6.1.状态更新.html#" class="sidebar-link"></a></li><li class="sidebar-sub-header"><a href="/react/react源码/6.1.状态更新.html#同步更新的react" class="sidebar-link">同步更新的React</a></li><li class="sidebar-sub-header"><a href="/react/react源码/6.1.状态更新.html#并发更新的react" class="sidebar-link">[#](https://react.iamkasong.com/state/mental.html#并发更新的react)并发更新的React</a></li><li class="sidebar-sub-header"><a href="/react/react源码/6.1.状态更新.html#update的分类" class="sidebar-link">Update的分类</a></li><li class="sidebar-sub-header"><a href="/react/react源码/6.1.状态更新.html#update的结构" class="sidebar-link">Update的结构</a></li><li class="sidebar-sub-header"><a href="/react/react源码/6.1.状态更新.html#update与fiber的联系" class="sidebar-link">Update与Fiber的联系</a></li><li class="sidebar-sub-header"><a href="/react/react源码/6.1.状态更新.html#updatequeue" class="sidebar-link">updateQueue</a></li><li class="sidebar-sub-header"><a href="/react/react源码/6.1.状态更新.html#例子" class="sidebar-link">例子</a></li></ul></li><li><a href="/react/react源码/6.2.优先级.html" class="sidebar-link">什么是优先级</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/react源码/6.2.优先级.html#什么是优先级" class="sidebar-link">什么是优先级</a></li><li class="sidebar-sub-header"><a href="/react/react源码/6.2.优先级.html#如何调度优先级" class="sidebar-link">[#](https://react.iamkasong.com/state/priority.html#如何调度优先级)如何调度优先级</a></li><li class="sidebar-sub-header"><a href="/react/react源码/6.2.优先级.html#例子" class="sidebar-link">[#](https://react.iamkasong.com/state/priority.html#例子)例子</a></li><li class="sidebar-sub-header"><a href="/react/react源码/6.2.优先级.html#如何保证状态正确" class="sidebar-link">[#](https://react.iamkasong.com/state/priority.html#如何保证状态正确)如何保证状态正确</a></li><li class="sidebar-sub-header"><a href="/react/react源码/6.2.优先级.html#创建fiber" class="sidebar-link">[#](https://react.iamkasong.com/state/reactdom.html#创建fiber)创建fiber</a></li><li class="sidebar-sub-header"><a href="/react/react源码/6.2.优先级.html#创建update" class="sidebar-link">[#](https://react.iamkasong.com/state/reactdom.html#创建update)创建update</a></li><li class="sidebar-sub-header"><a href="/react/react源码/6.2.优先级.html#流程概览" class="sidebar-link">[#](https://react.iamkasong.com/state/reactdom.html#流程概览)流程概览</a></li><li class="sidebar-sub-header"><a href="/react/react源码/6.2.优先级.html#react的其他入口函数" class="sidebar-link">[#](https://react.iamkasong.com/state/reactdom.html#react的其他入口函数)React的其他入口函数</a></li><li class="sidebar-sub-header"><a href="/react/react源码/6.2.优先级.html#流程概览-2" class="sidebar-link">[#](https://react.iamkasong.com/state/setstate.html#流程概览)流程概览</a></li><li class="sidebar-sub-header"><a href="/react/react源码/6.2.优先级.html#this-forceupdate" class="sidebar-link">[#](https://react.iamkasong.com/state/setstate.html#this-forceupdate)this.forceUpdate</a></li><li class="sidebar-sub-header"><a href="/react/react源码/6.2.优先级.html#总结" class="sidebar-link">[#](https://react.iamkasong.com/state/setstate.html#总结)总结</a></li></ul></li><li><a href="/react/react源码/7.1.实现hooks.html" class="active sidebar-link">/react/react源码/7.1.实现hooks.html</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/react源码/7.1.实现hooks.html#从logo聊起" class="sidebar-link">[#](https://react.iamkasong.com/hooks/prepare.html#从logo聊起)从LOGO聊起</a></li><li class="sidebar-sub-header"><a href="/react/react源码/7.1.实现hooks.html#总结" class="sidebar-link">[#](https://react.iamkasong.com/hooks/prepare.html#总结)总结</a></li><li class="sidebar-sub-header"><a href="/react/react源码/7.1.实现hooks.html#工作原理" class="sidebar-link">工作原理</a></li><li class="sidebar-sub-header"><a href="/react/react源码/7.1.实现hooks.html#更新是什么" class="sidebar-link">更新是什么</a></li><li class="sidebar-sub-header"><a href="/react/react源码/7.1.实现hooks.html#update数据结构" class="sidebar-link">update数据结构</a></li><li class="sidebar-sub-header"><a href="/react/react源码/7.1.实现hooks.html#状态如何保存" class="sidebar-link">状态如何保存</a></li><li class="sidebar-sub-header"><a href="/react/react源码/7.1.实现hooks.html#hook数据结构" class="sidebar-link">Hook数据结构</a></li><li class="sidebar-sub-header"><a href="/react/react源码/7.1.实现hooks.html#模拟react调度更新流程" class="sidebar-link">模拟React调度更新流程</a></li><li class="sidebar-sub-header"><a href="/react/react源码/7.1.实现hooks.html#计算state" class="sidebar-link">计算state</a></li><li class="sidebar-sub-header"><a href="/react/react源码/7.1.实现hooks.html#对触发事件进行抽象" class="sidebar-link">对触发事件进行抽象</a></li><li class="sidebar-sub-header"><a href="/react/react源码/7.1.实现hooks.html#在线demo" class="sidebar-link">在线Demo</a></li><li class="sidebar-sub-header"><a href="/react/react源码/7.1.实现hooks.html#与react的区别" class="sidebar-link">与React的区别</a></li></ul></li><li><a href="/react/react源码/7.2.useState和useReducer.html" class="sidebar-link">dispatcher</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/react源码/7.2.useState和useReducer.html#dispatcher" class="sidebar-link">dispatcher</a></li><li class="sidebar-sub-header"><a href="/react/react源码/7.2.useState和useReducer.html#一个dispatcher使用场景" class="sidebar-link">[#](https://react.iamkasong.com/hooks/structure.html#一个dispatcher使用场景)一个dispatcher使用场景</a></li><li class="sidebar-sub-header"><a href="/react/react源码/7.2.useState和useReducer.html#hook的数据结构" class="sidebar-link">[#](https://react.iamkasong.com/hooks/structure.html#hook的数据结构)Hook的数据结构</a></li><li class="sidebar-sub-header"><a href="/react/react源码/7.2.useState和useReducer.html#memoizedstate" class="sidebar-link">[#](https://react.iamkasong.com/hooks/structure.html#memoizedstate)memoizedState</a></li><li class="sidebar-sub-header"><a href="/react/react源码/7.2.useState和useReducer.html#流程概览" class="sidebar-link">[#](https://react.iamkasong.com/hooks/usestate.html#流程概览)流程概览</a></li><li class="sidebar-sub-header"><a href="/react/react源码/7.2.useState和useReducer.html#声明阶段" class="sidebar-link">[#](https://react.iamkasong.com/hooks/usestate.html#声明阶段)声明阶段</a></li><li class="sidebar-sub-header"><a href="/react/react源码/7.2.useState和useReducer.html#调用阶段" class="sidebar-link">[#](https://react.iamkasong.com/hooks/usestate.html#调用阶段)调用阶段</a></li><li class="sidebar-sub-header"><a href="/react/react源码/7.2.useState和useReducer.html#小tip" class="sidebar-link">[#](https://react.iamkasong.com/hooks/usestate.html#小tip)小Tip</a></li></ul></li><li><a href="/react/react源码/7.3.useEffect.html" class="sidebar-link">/react/react源码/7.3.useEffect.html</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/react源码/7.3.useEffect.html#flushpassiveeffectsimpl" class="sidebar-link">[#](https://react.iamkasong.com/hooks/useeffect.html#flushpassiveeffectsimpl)flushPassiveEffectsImpl</a></li><li class="sidebar-sub-header"><a href="/react/react源码/7.3.useEffect.html#阶段一-销毁函数的执行" class="sidebar-link">[#](https://react.iamkasong.com/hooks/useeffect.html#阶段一-销毁函数的执行)阶段一：销毁函数的执行</a></li><li class="sidebar-sub-header"><a href="/react/react源码/7.3.useEffect.html#阶段二-回调函数的执行" class="sidebar-link">[#](https://react.iamkasong.com/hooks/useeffect.html#阶段二-回调函数的执行)阶段二：回调函数的执行</a></li></ul></li><li><a href="/react/react源码/7.4.useRef和useMemo.html" class="sidebar-link">/react/react源码/7.4.useRef和useMemo.html</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/react源码/7.4.useRef和useMemo.html#useref" class="sidebar-link">[#](https://react.iamkasong.com/hooks/useref.html#useref)useRef</a></li><li class="sidebar-sub-header"><a href="/react/react源码/7.4.useRef和useMemo.html#ref的工作流程" class="sidebar-link">[#](https://react.iamkasong.com/hooks/useref.html#ref的工作流程)ref的工作流程</a></li><li class="sidebar-sub-header"><a href="/react/react源码/7.4.useRef和useMemo.html#render阶段" class="sidebar-link">[#](https://react.iamkasong.com/hooks/useref.html#render阶段)render阶段</a></li><li class="sidebar-sub-header"><a href="/react/react源码/7.4.useRef和useMemo.html#commit阶段" class="sidebar-link">[#](https://react.iamkasong.com/hooks/useref.html#commit阶段)commit阶段</a></li><li class="sidebar-sub-header"><a href="/react/react源码/7.4.useRef和useMemo.html#总结" class="sidebar-link">[#](https://react.iamkasong.com/hooks/useref.html#总结)总结</a></li><li class="sidebar-sub-header"><a href="/react/react源码/7.4.useRef和useMemo.html#mount" class="sidebar-link">mount</a></li><li class="sidebar-sub-header"><a href="/react/react源码/7.4.useRef和useMemo.html#update" class="sidebar-link">[#](https://react.iamkasong.com/hooks/usememo.html#update)update</a></li></ul></li><li><a href="/react/react源码/源码.html" class="sidebar-link">1. 理念篇</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/react源码/源码.html#_1-1-react的设计理念" class="sidebar-link">1.1 React的设计理念</a></li><li class="sidebar-sub-header"><a href="/react/react源码/源码.html#_1-2-架构演进" class="sidebar-link">1.2 架构演进</a></li><li class="sidebar-sub-header"><a href="/react/react源码/源码.html#_1-3-fiber架构的工作原理" class="sidebar-link">1.3 Fiber架构的工作原理</a></li><li class="sidebar-sub-header"><a href="/react/react源码/源码.html#_1-4-文件目录" class="sidebar-link">1.4 文件目录</a></li><li class="sidebar-sub-header"><a href="/react/react源码/源码.html#render" class="sidebar-link">render</a></li><li class="sidebar-sub-header"><a href="/react/react源码/源码.html#commit" class="sidebar-link">commit</a></li><li class="sidebar-sub-header"><a href="/react/react源码/源码.html#diff算法" class="sidebar-link">Diff算法</a></li><li class="sidebar-sub-header"><a href="/react/react源码/源码.html#状态更新" class="sidebar-link">状态更新</a></li><li class="sidebar-sub-header"><a href="/react/react源码/源码.html#生命周期" class="sidebar-link">生命周期</a></li><li class="sidebar-sub-header"><a href="/react/react源码/源码.html#hooks" class="sidebar-link">Hooks</a></li><li class="sidebar-sub-header"><a href="/react/react源码/源码.html#异步调度" class="sidebar-link">异步调度</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>你可以从<a href="https://zh-hans.reactjs.org/docs/hooks-intro.html#motivation" target="_blank" rel="noopener noreferrer">这里 (opens new window)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>了解<code>Hooks</code>的设计动机。作为一名<code>框架使用者</code>，了解<code>设计动机</code>对于我们日常开发就足够了。</p> <p>但是，为了更好的理解<code>Hooks</code>的<code>源码架构</code>，我们需要转换身份，以<code>框架开发者</code>的角度来看待<code>Hooks</code>的<code>设计理念</code>。</p> <h2 id="从logo聊起"><a href="#从logo聊起" class="header-anchor">#</a> <a href="https://react.iamkasong.com/hooks/prepare.html#%E4%BB%8Elogo%E8%81%8A%E8%B5%B7" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>从LOGO聊起</h2> <p><img src="https://react.iamkasong.com/img/logo.png" alt="LOGO"></p> <p><code>React</code> <code>LOGO</code>的图案是代表<code>原子</code>（<code>atom</code>）的符号。世间万物由<code>原子</code>组成，<code>原子</code>的<code>类型</code>与<code>属性</code>决定了事物的外观与表现。</p> <p>同样，在<code>React</code>中，我们可以将<code>UI</code>拆分为很多独立的单元，每个单元被称为<code>Component</code>。这些<code>Component</code>的<code>属性</code>与<code>类型</code>决定了<code>UI</code>的外观与表现。</p> <p>讽刺的是，<code>原子</code>在希腊语中的意思为<code>不可分割的</code>（<code>indivisible</code>），但随后科学家在原子中发现了更小的粒子 —— 电子（<code>electron</code>）。电子可以很好的解释<code>原子</code>是如何工作的。</p> <p>在<code>React</code>中，我们可以说<code>ClassComponent</code>是一类<code>原子</code>。</p> <p>但对于<code>Hooks</code>来说，与其说是一类<code>原子</code>，不如说他是更贴近事物<code>运行规律</code>的<code>电子</code>。</p> <p>我们知道，<code>React</code>的架构遵循<code>schedule - render - commit</code>的运行流程，这个流程是<code>React</code>世界最底层的<code>运行规律</code>。</p> <p><code>ClassComponent</code>作为<code>React</code>世界的<code>原子</code>，他的<code>生命周期</code>（<code>componentWillXXX</code>/<code>componentDidXXX</code>）是为了介入<code>React</code>的运行流程而实现的更上层抽象，这么做是为了方便<code>框架使用者</code>更容易上手。</p> <p>相比于<code>ClassComponent</code>的更上层抽象，<code>Hooks</code>则更贴近<code>React</code>内部运行的各种概念（<code>state</code> | <code>context</code> | <code>life-cycle</code>）。</p> <p>作为使用<code>React</code>技术栈的开发者，当我们初次学习<code>Hooks</code>时，不管是官方文档还是身边有经验的同事，总会拿<code>ClassComponent</code>的生命周期来类比<code>Hooks API</code>的执行时机。</p> <p>这固然是很好的上手方式，但是当我们熟练运用<code>Hooks</code>时，就会发现，这两者的概念有很多割裂感，并不是同一抽象层次可以互相替代的概念。</p> <p>比如：替代<code>componentWillReceiveProps</code>的<code>Hooks</code>是什么呢？</p> <p>可能有些同学会回答，是<code>useEffect</code>：</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function">useEffect</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'something updated'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>props<span class="token punctuation">.</span>something<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>但是<code>componentWillReceiveProps</code>是在<code>render阶段</code>执行，而<code>useEffect</code>是在<code>commit阶段</code>完成渲染后异步执行。</p> <blockquote><p>这篇文章可以帮你更好理解<code>componentWillReceiveProps</code>：<a href="https://juejin.im/post/5f05a3e25188252e5c576cdb" target="_blank" rel="noopener noreferrer">深入源码剖析componentWillXXX为什么UNSAFE(opens new window)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>所以，从源码运行规律的角度看待<code>Hooks</code>，可能是更好的角度。这也是为什么上文说<code>Hooks</code>是<code>React</code>世界的<code>电子</code>而不是<code>原子</code>的原因。</p> <blockquote><p>以上见解参考自<a href="https://www.youtube.com/watch?v=dpw9EHDh2bM&amp;feature=youtu.be" target="_blank" rel="noopener noreferrer">React Core Team Dan在 React Conf2018的演讲(opens new window)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> <a href="https://react.iamkasong.com/hooks/prepare.html#%E6%80%BB%E7%BB%93" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>总结</h2> <p><code>Concurrent Mode</code>是<code>React</code>未来的发展方向，而<code>Hooks</code>是能够最大限度发挥<code>Concurrent Mode</code>潜力的<code>Component</code>构建方式。</p> <p>正如Dan在<code>React Conf 2018</code>演讲结尾所说：你可以从<code>React</code>的<code>LOGO</code>中看到这些围绕着<code>核心</code>的<code>电子飞行轨道</code>，<code>Hooks</code>可能一直就在其中。</p> <p>为了更好理解<code>Hooks</code>原理，这一节我们遵循<code>React</code>的运行流程，实现一个不到100行代码的极简<code>useState Hook</code>。建议对照着代码来看本节内容。</p> <h2 id="工作原理"><a href="#工作原理" class="header-anchor">#</a> 工作原理</h2> <p>对于<code>useState Hook</code>，考虑如下例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>num<span class="token punctuation">,</span> updateNum<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token operator">&lt;</span>p onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">updateNum</span><span class="token punctuation">(</span><span class="token parameter">num</span> <span class="token operator">=&gt;</span> num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>num<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以将工作分为两部分：</p> <ol><li><p>通过一些途径产生<code>更新</code>，<code>更新</code>会造成组件<code>render</code>。</p></li> <li><p>组件<code>render</code>时<code>useState</code>返回的<code>num</code>为更新后的结果。</p></li></ol> <p>其中<code>步骤1</code>的<code>更新</code>可以分为<code>mount</code>和<code>update</code>：</p> <ol><li><p>调用<code>ReactDOM.render</code>会产生<code>mount</code>的<code>更新</code>，<code>更新</code>内容为<code>useState</code>的<code>initialValue</code>（即<code>0</code>）。</p></li> <li><p>点击<code>p</code>标签触发<code>updateNum</code>会产生一次<code>update</code>的<code>更新</code>，<code>更新</code>内容为<code>num =&gt; num + 1</code>。</p></li></ol> <p>接下来讲解这两个步骤如何实现。</p> <h2 id="更新是什么"><a href="#更新是什么" class="header-anchor">#</a> 更新是什么</h2> <blockquote><ol><li>通过一些途径产生<code>更新</code>，<code>更新</code>会造成组件<code>render</code>。</li></ol></blockquote> <p>首先我们要明确<code>更新</code>是什么。</p> <p>在我们的极简例子中，<code>更新</code>就是如下数据结构：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> update <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 更新执行的函数</span>
  action<span class="token punctuation">,</span>
  <span class="token comment">// 与同一个Hook的其他更新形成链表</span>
  next<span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span>
</code></pre></div><p>对于<code>App</code>来说，点击<code>p</code>标签产生的<code>update</code>的<code>action</code>为<code>num =&gt; num + 1</code>。</p> <p>如果我们改写下<code>App</code>的<code>onClick</code>：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 之前</span>
<span class="token keyword">return</span> <span class="token operator">&lt;</span>p onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">updateNum</span><span class="token punctuation">(</span><span class="token parameter">num</span> <span class="token operator">=&gt;</span> num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>num<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token comment">// 之后</span>
<span class="token keyword">return</span> <span class="token operator">&lt;</span>p onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">updateNum</span><span class="token punctuation">(</span><span class="token parameter">num</span> <span class="token operator">=&gt;</span> num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">updateNum</span><span class="token punctuation">(</span><span class="token parameter">num</span> <span class="token operator">=&gt;</span> num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">updateNum</span><span class="token punctuation">(</span><span class="token parameter">num</span> <span class="token operator">=&gt;</span> num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>num<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre></div><p>那么点击<code>p</code>标签会产生三个<code>update</code>。</p> <h2 id="update数据结构"><a href="#update数据结构" class="header-anchor">#</a> update数据结构</h2> <p>这些<code>update</code>是如何组合在一起呢？</p> <p>答案是：他们会形成<code>环状单向链表</code>。</p> <p>调用<code>updateNum</code>实际调用的是<code>dispatchAction.bind(null, hook.queue)</code>，我们先来了解下这个函数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">dispatchAction</span><span class="token punctuation">(</span><span class="token parameter">queue<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 创建update</span>
  <span class="token keyword">const</span> update <span class="token operator">=</span> <span class="token punctuation">{</span>
    action<span class="token punctuation">,</span>
    next<span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 环状单向链表操作</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span>pending <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    update<span class="token punctuation">.</span>next <span class="token operator">=</span> update<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    update<span class="token punctuation">.</span>next <span class="token operator">=</span> queue<span class="token punctuation">.</span>pending<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
    queue<span class="token punctuation">.</span>pending<span class="token punctuation">.</span>next <span class="token operator">=</span> update<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  queue<span class="token punctuation">.</span>pending <span class="token operator">=</span> update<span class="token punctuation">;</span>

  <span class="token comment">// 模拟React开始调度更新</span>
  <span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>环状链表操作不太容易理解，这里我们详细讲解下。</p> <p>当产生第一个<code>update</code>（我们叫他<code>u0</code>），此时<code>queue.pending === null</code>。</p> <p><code>update.next = update;</code>即<code>u0.next = u0</code>，他会和自己首尾相连形成<code>单向环状链表</code>。</p> <p>然后<code>queue.pending = update;</code>即<code>queue.pending = u0</code></p> <div class="language-js extra-class"><pre class="language-js"><code>queue<span class="token punctuation">.</span>pending <span class="token operator">=</span> u0 <span class="token operator">--</span><span class="token operator">-</span><span class="token operator">&gt;</span> u0
                <span class="token operator">^</span>       <span class="token operator">|</span>
                <span class="token operator">|</span>       <span class="token operator">|</span>
                <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
</code></pre></div><p>当产生第二个<code>update</code>（我们叫他<code>u1</code>），<code>update.next = queue.pending.next;</code>，此时<code>queue.pending.next === u0</code>，
即<code>u1.next = u0</code>。</p> <p><code>queue.pending.next = update;</code>，即<code>u0.next = u1</code>。</p> <p>然后<code>queue.pending = update;</code>即<code>queue.pending = u1</code></p> <div class="language-js extra-class"><pre class="language-js"><code>queue<span class="token punctuation">.</span>pending <span class="token operator">=</span> u1 <span class="token operator">--</span><span class="token operator">-</span><span class="token operator">&gt;</span> u0   
                <span class="token operator">^</span>       <span class="token operator">|</span>
                <span class="token operator">|</span>       <span class="token operator">|</span>
                <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
</code></pre></div><p>你可以照着这个例子模拟插入多个<code>update</code>的情况，会发现<code>queue.pending</code>始终指向最后一个插入的<code>update</code>。</p> <p>这样做的好处是，当我们要遍历<code>update</code>时，<code>queue.pending.next</code>指向第一个插入的<code>update</code>。</p> <h2 id="状态如何保存"><a href="#状态如何保存" class="header-anchor">#</a> 状态如何保存</h2> <p>现在我们知道，<code>更新</code>产生的<code>update</code>对象会保存在<code>queue</code>中。</p> <p>不同于<code>ClassComponent</code>的实例可以存储数据，对于<code>FunctionComponent</code>，<code>queue</code>存储在哪里呢？</p> <p>答案是：<code>FunctionComponent</code>对应的<code>fiber</code>中。</p> <p>我们使用如下精简的<code>fiber</code>结构：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// App组件对应的fiber对象</span>
<span class="token keyword">const</span> fiber <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 保存该FunctionComponent对应的Hooks链表</span>
  memoizedState<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token comment">// 指向App函数</span>
  stateNode<span class="token operator">:</span> App
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="hook数据结构"><a href="#hook数据结构" class="header-anchor">#</a> Hook数据结构</h2> <p>接下来我们关注<code>fiber.memoizedState</code>中保存的<code>Hook</code>的数据结构。</p> <p>可以看到，<code>Hook</code>与<code>update</code>类似，都通过<code>链表</code>连接。不过<code>Hook</code>是<code>无环</code>的<code>单向链表</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code>hook <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 保存update的queue，即上文介绍的queue</span>
  queue<span class="token operator">:</span> <span class="token punctuation">{</span>
    pending<span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 保存hook对应的state</span>
  memoizedState<span class="token operator">:</span> initialState<span class="token punctuation">,</span>
  <span class="token comment">// 与下一个Hook连接形成单向无环链表</span>
  next<span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>注意区分<code>update</code>与<code>hook</code>的所属关系：</p> <p>每个<code>useState</code>对应一个<code>hook</code>对象。</p> <p>调用<code>const [num, updateNum] = useState(0);</code>时<code>updateNum</code>（即上文介绍的<code>dispatchAction</code>）产生的<code>update</code>保存在<code>useState</code>对应的<code>hook.queue</code>中。</p></div> <h2 id="模拟react调度更新流程"><a href="#模拟react调度更新流程" class="header-anchor">#</a> 模拟React调度更新流程</h2> <p>在上文<code>dispatchAction</code>末尾我们通过<code>schedule</code>方法模拟<code>React</code>调度更新流程。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">dispatchAction</span><span class="token punctuation">(</span><span class="token parameter">queue<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...创建update</span>
  
  <span class="token comment">// ...环状单向链表操作</span>

  <span class="token comment">// 模拟React开始调度更新</span>
  <span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>现在我们来实现他。</p> <p>我们用<code>isMount</code>变量指代是<code>mount</code>还是<code>update</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 首次render时是mount</span>
isMount <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 更新前将workInProgressHook重置为fiber保存的第一个Hook</span>
  workInProgressHook <span class="token operator">=</span> fiber<span class="token punctuation">.</span>memoizedState<span class="token punctuation">;</span>
  <span class="token comment">// 触发组件render</span>
  fiber<span class="token punctuation">.</span><span class="token function">stateNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 组件首次render为mount，以后再触发的更新为update</span>
  isMount <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>通过<code>workInProgressHook</code>变量指向当前正在工作的<code>hook</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code>workInProgressHook <span class="token operator">=</span> fiber<span class="token punctuation">.</span>memoizedState<span class="token punctuation">;</span>
</code></pre></div><p>在组件<code>render</code>时，每当遇到下一个<code>useState</code>，我们移动<code>workInProgressHook</code>的指针。</p> <div class="language-js extra-class"><pre class="language-js"><code>workInProgressHook <span class="token operator">=</span> workInProgressHook<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
</code></pre></div><p>这样，只要每次组件<code>render</code>时<code>useState</code>的调用顺序及数量保持一致，那么始终可以通过<code>workInProgressHook</code>找到当前<code>useState</code>对应的<code>hook</code>对象。</p> <p>到此为止，我们已经完成第一步。</p> <blockquote><ol><li>通过一些途径产生<code>更新</code>，<code>更新</code>会造成组件<code>render</code>。</li></ol></blockquote> <p>接下来实现第二步。</p> <blockquote><ol start="2"><li>组件<code>render</code>时<code>useState</code>返回的<code>num</code>为更新后的结果。</li></ol></blockquote> <h2 id="计算state"><a href="#计算state" class="header-anchor">#</a> 计算state</h2> <p>组件<code>render</code>时会调用<code>useState</code>，他的大体逻辑如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token parameter">initialState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 当前useState使用的hook会被赋值该该变量</span>
  <span class="token keyword">let</span> hook<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>isMount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...mount时需要生成hook对象</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...update时从workInProgressHook中取出该useState对应的hook</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">let</span> baseState <span class="token operator">=</span> hook<span class="token punctuation">.</span>memoizedState<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hook<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>pending<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...根据queue.pending中保存的update更新state</span>
  <span class="token punctuation">}</span>
  hook<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> baseState<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span>baseState<span class="token punctuation">,</span> <span class="token function">dispatchAction</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> hook<span class="token punctuation">.</span>queue<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们首先关注如何获取<code>hook</code>对象：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>isMount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// mount时为该useState生成hook</span>
  hook <span class="token operator">=</span> <span class="token punctuation">{</span>
    queue<span class="token operator">:</span> <span class="token punctuation">{</span>
      pending<span class="token operator">:</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    memoizedState<span class="token operator">:</span> initialState<span class="token punctuation">,</span>
    next<span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 将hook插入fiber.memoizedState链表末尾</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fiber<span class="token punctuation">.</span>memoizedState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fiber<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> hook<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    workInProgressHook<span class="token punctuation">.</span>next <span class="token operator">=</span> hook<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 移动workInProgressHook指针</span>
  workInProgressHook <span class="token operator">=</span> hook<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// update时找到对应hook</span>
  hook <span class="token operator">=</span> workInProgressHook<span class="token punctuation">;</span>
  <span class="token comment">// 移动workInProgressHook指针</span>
  workInProgressHook <span class="token operator">=</span> workInProgressHook<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>当找到该<code>useState</code>对应的<code>hook</code>后，如果该<code>hook.queue.pending</code>不为空（即存在<code>update</code>），则更新其<code>state</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// update执行前的初始state</span>
<span class="token keyword">let</span> baseState <span class="token operator">=</span> hook<span class="token punctuation">.</span>memoizedState<span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>hook<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>pending<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取update环状单向链表中第一个update</span>
  <span class="token keyword">let</span> firstUpdate <span class="token operator">=</span> hook<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>pending<span class="token punctuation">.</span>next<span class="token punctuation">;</span>

  <span class="token keyword">do</span> <span class="token punctuation">{</span>
    <span class="token comment">// 执行update action</span>
    <span class="token keyword">const</span> action <span class="token operator">=</span> firstUpdate<span class="token punctuation">.</span>action<span class="token punctuation">;</span>
    baseState <span class="token operator">=</span> <span class="token function">action</span><span class="token punctuation">(</span>baseState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    firstUpdate <span class="token operator">=</span> firstUpdate<span class="token punctuation">.</span>next<span class="token punctuation">;</span>

    <span class="token comment">// 最后一个update执行完后跳出循环</span>
  <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>firstUpdate <span class="token operator">!==</span> hook<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>pending<span class="token punctuation">.</span>next<span class="token punctuation">)</span>

  <span class="token comment">// 清空queue.pending</span>
  hook<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>pending <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 将update action执行完后的state作为memoizedState</span>
hook<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> baseState<span class="token punctuation">;</span>
</code></pre></div><p>完整代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token parameter">initialState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> hook<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>isMount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    hook <span class="token operator">=</span> <span class="token punctuation">{</span>
      queue<span class="token operator">:</span> <span class="token punctuation">{</span>
        pending<span class="token operator">:</span> <span class="token keyword">null</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      memoizedState<span class="token operator">:</span> initialState<span class="token punctuation">,</span>
      next<span class="token operator">:</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fiber<span class="token punctuation">.</span>memoizedState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      fiber<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> hook<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      workInProgressHook<span class="token punctuation">.</span>next <span class="token operator">=</span> hook<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    workInProgressHook <span class="token operator">=</span> hook<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    hook <span class="token operator">=</span> workInProgressHook<span class="token punctuation">;</span>
    workInProgressHook <span class="token operator">=</span> workInProgressHook<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">let</span> baseState <span class="token operator">=</span> hook<span class="token punctuation">.</span>memoizedState<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hook<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>pending<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> firstUpdate <span class="token operator">=</span> hook<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>pending<span class="token punctuation">.</span>next<span class="token punctuation">;</span>

    <span class="token keyword">do</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> action <span class="token operator">=</span> firstUpdate<span class="token punctuation">.</span>action<span class="token punctuation">;</span>
      baseState <span class="token operator">=</span> <span class="token function">action</span><span class="token punctuation">(</span>baseState<span class="token punctuation">)</span><span class="token punctuation">;</span>
      firstUpdate <span class="token operator">=</span> firstUpdate<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>firstUpdate <span class="token operator">!==</span> hook<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>pending<span class="token punctuation">.</span>next<span class="token punctuation">)</span>

    hook<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>pending <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  hook<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> baseState<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span>baseState<span class="token punctuation">,</span> <span class="token function">dispatchAction</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> hook<span class="token punctuation">.</span>queue<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="对触发事件进行抽象"><a href="#对触发事件进行抽象" class="header-anchor">#</a> 对触发事件进行抽象</h2> <p>最后，让我们抽象一下<code>React</code>的事件触发方式。</p> <p>通过调用<code>App</code>返回的<code>click</code>方法模拟组件<code>click</code>的行为。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>num<span class="token punctuation">,</span> updateNum<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>isMount <span class="token operator">?</span> <span class="token string">'mount'</span> <span class="token operator">:</span> <span class="token string">'update'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> num: </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">updateNum</span><span class="token punctuation">(</span><span class="token parameter">num</span> <span class="token operator">=&gt;</span> num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="在线demo"><a href="#在线demo" class="header-anchor">#</a> 在线Demo</h2> <p>至此，我们完成了一个不到100行代码的<code>Hooks</code>。重要的是，他与<code>React</code>的运行逻辑相同。</p> <details class="custom-block details"><summary>精简Hooks的在线Demo</summary> <p>调用<code>window.app.click()</code>模拟组件点击事件。</p> <p>你也可以使用多个<code>useState</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>num<span class="token punctuation">,</span> updateNum<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>num1<span class="token punctuation">,</span> updateNum1<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>isMount <span class="token operator">?</span> <span class="token string">'mount'</span> <span class="token operator">:</span> <span class="token string">'update'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> num: </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>isMount <span class="token operator">?</span> <span class="token string">'mount'</span> <span class="token operator">:</span> <span class="token string">'update'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> num1: </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> num1<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">updateNum</span><span class="token punctuation">(</span><span class="token parameter">num</span> <span class="token operator">=&gt;</span> num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">updateNum1</span><span class="token punctuation">(</span><span class="token parameter">num</span> <span class="token operator">=&gt;</span> num <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="与react的区别"><a href="#与react的区别" class="header-anchor">#</a> 与React的区别</h2> <p>我们用尽可能少的代码模拟了<code>Hooks</code>的运行，但是相比<code>React Hooks</code>，他还有很多不足。以下是他与<code>React Hooks</code>的区别：</p> <ol><li><p><code>React Hooks</code>没有使用<code>isMount</code>变量，而是在不同时机使用不同的<code>dispatcher</code>。换言之，<code>mount</code>时的<code>useState</code>与<code>update</code>时的<code>useState</code>不是同一个函数。</p></li> <li><p><code>React Hooks</code>有中途跳过<code>更新</code>的优化手段。</p></li> <li><p><code>React Hooks</code>有<code>batchedUpdates</code>，当在<code>click</code>中触发三次<code>updateNum</code>，<code>精简React</code>会触发三次更新，而<code>React</code>只会触发一次。</p></li> <li><p><code>React Hooks</code>的<code>update</code>有<code>优先级</code>概念，可以跳过不高优先的<code>update</code>。</p></li></ol> <p>更多的细节，我们会在本章后续小节讲解。</p></details></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/react/react源码/6.2.优先级.html" class="prev">
        什么是优先级
      </a></span> <span class="next"><a href="/react/react源码/7.2.useState和useReducer.html">
        dispatcher
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b51e4ccd.js" defer></script><script src="/assets/js/2.7229199a.js" defer></script><script src="/assets/js/47.eb0ac18a.js" defer></script>
  </body>
</html>
