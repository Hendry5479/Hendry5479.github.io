<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>jsx | 英俊的大亨亨</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="heng.png">
    <meta name="description" content="记录下有趣岁月的点点滴滴">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.b51e4ccd.js" as="script"><link rel="preload" href="/assets/js/2.7229199a.js" as="script"><link rel="preload" href="/assets/js/58.acb475d1.js" as="script"><link rel="prefetch" href="/assets/js/10.00f8a9d8.js"><link rel="prefetch" href="/assets/js/100.78dfd44a.js"><link rel="prefetch" href="/assets/js/101.cdae98a0.js"><link rel="prefetch" href="/assets/js/102.6a3dd9e0.js"><link rel="prefetch" href="/assets/js/103.cfed07a2.js"><link rel="prefetch" href="/assets/js/104.a16a4843.js"><link rel="prefetch" href="/assets/js/105.9cd1add0.js"><link rel="prefetch" href="/assets/js/106.546c1ad8.js"><link rel="prefetch" href="/assets/js/107.04b38bf9.js"><link rel="prefetch" href="/assets/js/108.31a22b61.js"><link rel="prefetch" href="/assets/js/109.1f2a1840.js"><link rel="prefetch" href="/assets/js/11.e2689dc6.js"><link rel="prefetch" href="/assets/js/110.9dc2f13b.js"><link rel="prefetch" href="/assets/js/111.35cf70f8.js"><link rel="prefetch" href="/assets/js/112.39a6579b.js"><link rel="prefetch" href="/assets/js/113.cbfc279d.js"><link rel="prefetch" href="/assets/js/114.878470a2.js"><link rel="prefetch" href="/assets/js/115.86dc4d8e.js"><link rel="prefetch" href="/assets/js/116.d2e05b2c.js"><link rel="prefetch" href="/assets/js/117.7525671d.js"><link rel="prefetch" href="/assets/js/118.a5c04c6d.js"><link rel="prefetch" href="/assets/js/119.613a81e1.js"><link rel="prefetch" href="/assets/js/12.0b7aaea4.js"><link rel="prefetch" href="/assets/js/120.ec6d3159.js"><link rel="prefetch" href="/assets/js/121.6705f783.js"><link rel="prefetch" href="/assets/js/122.7b3fe034.js"><link rel="prefetch" href="/assets/js/123.9336f454.js"><link rel="prefetch" href="/assets/js/124.dca9fc87.js"><link rel="prefetch" href="/assets/js/125.338aa4d8.js"><link rel="prefetch" href="/assets/js/126.a731a9eb.js"><link rel="prefetch" href="/assets/js/127.da74dd90.js"><link rel="prefetch" href="/assets/js/128.3d5e86f2.js"><link rel="prefetch" href="/assets/js/129.ee43b65c.js"><link rel="prefetch" href="/assets/js/13.31064a46.js"><link rel="prefetch" href="/assets/js/130.8a273d75.js"><link rel="prefetch" href="/assets/js/131.a89df4ac.js"><link rel="prefetch" href="/assets/js/132.0daac28c.js"><link rel="prefetch" href="/assets/js/133.b1f23c92.js"><link rel="prefetch" href="/assets/js/134.78621a9c.js"><link rel="prefetch" href="/assets/js/135.f0884a8b.js"><link rel="prefetch" href="/assets/js/136.45114430.js"><link rel="prefetch" href="/assets/js/137.eb295fce.js"><link rel="prefetch" href="/assets/js/138.cc7dc8d3.js"><link rel="prefetch" href="/assets/js/139.c9b1aad6.js"><link rel="prefetch" href="/assets/js/14.0be4ee49.js"><link rel="prefetch" href="/assets/js/15.685fab30.js"><link rel="prefetch" href="/assets/js/16.97f8b16a.js"><link rel="prefetch" href="/assets/js/17.9c7bebeb.js"><link rel="prefetch" href="/assets/js/18.965d9e47.js"><link rel="prefetch" href="/assets/js/19.3d59a8e1.js"><link rel="prefetch" href="/assets/js/20.1573d510.js"><link rel="prefetch" href="/assets/js/21.f46234dd.js"><link rel="prefetch" href="/assets/js/22.6c16fd38.js"><link rel="prefetch" href="/assets/js/23.50a2a38a.js"><link rel="prefetch" href="/assets/js/24.8aff8273.js"><link rel="prefetch" href="/assets/js/25.35a7c496.js"><link rel="prefetch" href="/assets/js/26.af233874.js"><link rel="prefetch" href="/assets/js/27.a3a96a5a.js"><link rel="prefetch" href="/assets/js/28.a1d49602.js"><link rel="prefetch" href="/assets/js/29.174b7d7d.js"><link rel="prefetch" href="/assets/js/3.6038f64c.js"><link rel="prefetch" href="/assets/js/30.a4115d32.js"><link rel="prefetch" href="/assets/js/31.1522875a.js"><link rel="prefetch" href="/assets/js/32.35da527d.js"><link rel="prefetch" href="/assets/js/33.814d63e8.js"><link rel="prefetch" href="/assets/js/34.615b49c1.js"><link rel="prefetch" href="/assets/js/35.856ab789.js"><link rel="prefetch" href="/assets/js/36.2987bc62.js"><link rel="prefetch" href="/assets/js/37.084d12aa.js"><link rel="prefetch" href="/assets/js/38.088f3091.js"><link rel="prefetch" href="/assets/js/39.4ea066d5.js"><link rel="prefetch" href="/assets/js/4.c610d016.js"><link rel="prefetch" href="/assets/js/40.97850ba9.js"><link rel="prefetch" href="/assets/js/41.8b8ae086.js"><link rel="prefetch" href="/assets/js/42.8ae2cac3.js"><link rel="prefetch" href="/assets/js/43.f8a28187.js"><link rel="prefetch" href="/assets/js/44.5160f68a.js"><link rel="prefetch" href="/assets/js/45.6d4b7130.js"><link rel="prefetch" href="/assets/js/46.44693348.js"><link rel="prefetch" href="/assets/js/47.eb0ac18a.js"><link rel="prefetch" href="/assets/js/48.ce1c6335.js"><link rel="prefetch" href="/assets/js/49.7ec1b16a.js"><link rel="prefetch" href="/assets/js/5.216dfe20.js"><link rel="prefetch" href="/assets/js/50.1f503aa4.js"><link rel="prefetch" href="/assets/js/51.47971163.js"><link rel="prefetch" href="/assets/js/52.e5f681d7.js"><link rel="prefetch" href="/assets/js/53.df89fbb7.js"><link rel="prefetch" href="/assets/js/54.a140a8dd.js"><link rel="prefetch" href="/assets/js/55.5809711e.js"><link rel="prefetch" href="/assets/js/56.3a62759d.js"><link rel="prefetch" href="/assets/js/57.c9bd4339.js"><link rel="prefetch" href="/assets/js/59.61cf3322.js"><link rel="prefetch" href="/assets/js/6.73a8f323.js"><link rel="prefetch" href="/assets/js/60.aa39146e.js"><link rel="prefetch" href="/assets/js/61.f62972b8.js"><link rel="prefetch" href="/assets/js/62.79fc1ddc.js"><link rel="prefetch" href="/assets/js/63.808c750c.js"><link rel="prefetch" href="/assets/js/64.4e99e2e1.js"><link rel="prefetch" href="/assets/js/65.f112caec.js"><link rel="prefetch" href="/assets/js/66.422cc6c9.js"><link rel="prefetch" href="/assets/js/67.f504a803.js"><link rel="prefetch" href="/assets/js/68.f8e84a65.js"><link rel="prefetch" href="/assets/js/69.af07ae00.js"><link rel="prefetch" href="/assets/js/7.a6e60d89.js"><link rel="prefetch" href="/assets/js/70.9b212396.js"><link rel="prefetch" href="/assets/js/71.049b7d3e.js"><link rel="prefetch" href="/assets/js/72.b508f834.js"><link rel="prefetch" href="/assets/js/73.52a25a21.js"><link rel="prefetch" href="/assets/js/74.68de4c01.js"><link rel="prefetch" href="/assets/js/75.c0d8e99a.js"><link rel="prefetch" href="/assets/js/76.672b246e.js"><link rel="prefetch" href="/assets/js/77.36d886e3.js"><link rel="prefetch" href="/assets/js/78.079ebfd8.js"><link rel="prefetch" href="/assets/js/79.d3d3e8ea.js"><link rel="prefetch" href="/assets/js/8.a72c567f.js"><link rel="prefetch" href="/assets/js/80.c690c3d9.js"><link rel="prefetch" href="/assets/js/81.c012b7d5.js"><link rel="prefetch" href="/assets/js/82.47ffa460.js"><link rel="prefetch" href="/assets/js/83.2ba84114.js"><link rel="prefetch" href="/assets/js/84.dc0bf5a8.js"><link rel="prefetch" href="/assets/js/85.d968ae8b.js"><link rel="prefetch" href="/assets/js/86.91000a3b.js"><link rel="prefetch" href="/assets/js/87.6e885c71.js"><link rel="prefetch" href="/assets/js/88.99dd2b79.js"><link rel="prefetch" href="/assets/js/89.601c57ea.js"><link rel="prefetch" href="/assets/js/9.c59ba06b.js"><link rel="prefetch" href="/assets/js/90.89ee0da5.js"><link rel="prefetch" href="/assets/js/91.854de449.js"><link rel="prefetch" href="/assets/js/92.7a25d006.js"><link rel="prefetch" href="/assets/js/93.17f89281.js"><link rel="prefetch" href="/assets/js/94.0f6749b9.js"><link rel="prefetch" href="/assets/js/95.41ef6f4a.js"><link rel="prefetch" href="/assets/js/96.12427920.js"><link rel="prefetch" href="/assets/js/97.53036963.js"><link rel="prefetch" href="/assets/js/98.43d8f870.js"><link rel="prefetch" href="/assets/js/99.4ab32fce.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/heng.png" alt="英俊的大亨亨" class="logo"> <span class="site-name can-hide">英俊的大亨亨</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">js</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">js</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/js/js-基础.html" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/js/js-数组.html" class="nav-link">
  数组
</a></li><li class="dropdown-item"><!----> <a href="/js/js-异步.html" class="nav-link">
  异步
</a></li><li class="dropdown-item"><!----> <a href="/js/js-es6.html" class="nav-link">
  es6
</a></li><li class="dropdown-item"><!----> <a href="/js/js-v8引擎.html" class="nav-link">
  v8
</a></li><li class="dropdown-item"><!----> <a href="/手写代码/1.js基础.html" class="nav-link">
  手写
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/react/process.html" class="nav-link">
  
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/html.html" class="nav-link">
  html
</a></li><li class="dropdown-item"><!----> <a href="/css.html" class="nav-link">
  css
</a></li><li class="dropdown-item"><!----> <a href="/node.html" class="nav-link">
  node
</a></li><li class="dropdown-item"><!----> <a href="/webpack.html" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/webpack.html" class="nav-link">
  小程序
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="leetcode" class="dropdown-title"><span class="title">leetcode</span> <span class="arrow down"></span></button> <button type="button" aria-label="leetcode" class="mobile-dropdown-title"><span class="title">leetcode</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/代码随想录/1.数组.html" class="nav-link">
  1.数组
</a></li><li class="dropdown-item"><!----> <a href="/代码随想录/10.动态规划/1.基础.html" class="nav-link">
  10.动态规划
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">react源码</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">react源码</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react源码/理念.html" class="nav-link">
  1.理念
</a></li><li class="dropdown-item"><!----> <a href="/react源码/3.render.html" class="nav-link">
  3.render
</a></li><li class="dropdown-item"><!----> <a href="/react源码/4.commit.html" class="nav-link">
  4.commit
</a></li><li class="dropdown-item"><!----> <a href="/react源码/5.状态更新.html" class="nav-link">
  5.状态更新
</a></li><li class="dropdown-item"><!----> <a href="/react源码/6.diff.html" class="nav-link">
  6.diff
</a></li><li class="dropdown-item"><!----> <a href="/react/7.实现hooks.html" class="nav-link">
  7.实现hooks
</a></li><li class="dropdown-item"><!----> <a href="/react/8.concurrentMode.html" class="nav-link">
  8.concurrentMode
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">webpack</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">webpack</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/webpack/1.配置.html" class="nav-link">
  1.配置
</a></li><li class="dropdown-item"><!----> <a href="/webpack/2.loader.html" class="nav-link">
  2.loader
</a></li><li class="dropdown-item"><!----> <a href="/webpack/3.plugin.html" class="nav-link">
  3.plugin
</a></li><li class="dropdown-item"><!----> <a href="/webpack/4.模块化原理.html" class="nav-link">
  4.模块化原理
</a></li><li class="dropdown-item"><!----> <a href="/webpack/5.babel.html" class="nav-link">
  5.babel
</a></li><li class="dropdown-item"><!----> <a href="/webpack/6.HMR.html" class="nav-link">
  6.HMR
</a></li><li class="dropdown-item"><!----> <a href="/webpack/7.环境分离.html" class="nav-link">
  7.环境分离
</a></li><li class="dropdown-item"><!----> <a href="/webpack/8.tree_shaking.html" class="nav-link">
  8.tree_shaking
</a></li><li class="dropdown-item"><!----> <a href="/webpack/9,源码.html" class="nav-link">
  9.源码
</a></li><li class="dropdown-item"><!----> <a href="/webpack/11.自定义loader.html" class="nav-link">
  11.自定义loader
</a></li><li class="dropdown-item"><!----> <a href="/webpack/12.自定义plugin.html" class="nav-link">
  12.自定义plugin
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">前端设计模式</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">前端设计模式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/设计模式/创建型.html" class="nav-link">
  创建型
</a></li><li class="dropdown-item"><!----> <a href="/设计模式/结构型.html" class="nav-link">
  结构型
</a></li><li class="dropdown-item"><!----> <a href="/设计模式/行为型.html" class="nav-link">
  行为型
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">angular</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">angular</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react/react%E8%BF%9B%E9%98%B6%E5%AE%9E%E8%B7%B5%E6%8C%87%E5%8D%97/.html" class="nav-link">
  angular性能调优
</a></li><li class="dropdown-item"><!----> <a href="/设计模式/结构型.html" class="nav-link">
  angular源码理解
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">健身</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">健身</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react/react%E8%BF%9B%E9%98%B6%E5%AE%9E%E8%B7%B5%E6%8C%87%E5%8D%97/.html" class="nav-link">
  angular性能调优
</a></li><li class="dropdown-item"><!----> <a href="/设计模式/结构型.html" class="nav-link">
  angular源码理解
</a></li></ul></div></div><div class="nav-item"><a href="/me.html" class="nav-link">
  关于我
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">js</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">js</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/js/js-基础.html" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/js/js-数组.html" class="nav-link">
  数组
</a></li><li class="dropdown-item"><!----> <a href="/js/js-异步.html" class="nav-link">
  异步
</a></li><li class="dropdown-item"><!----> <a href="/js/js-es6.html" class="nav-link">
  es6
</a></li><li class="dropdown-item"><!----> <a href="/js/js-v8引擎.html" class="nav-link">
  v8
</a></li><li class="dropdown-item"><!----> <a href="/手写代码/1.js基础.html" class="nav-link">
  手写
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/react/process.html" class="nav-link">
  
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/html.html" class="nav-link">
  html
</a></li><li class="dropdown-item"><!----> <a href="/css.html" class="nav-link">
  css
</a></li><li class="dropdown-item"><!----> <a href="/node.html" class="nav-link">
  node
</a></li><li class="dropdown-item"><!----> <a href="/webpack.html" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/webpack.html" class="nav-link">
  小程序
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="leetcode" class="dropdown-title"><span class="title">leetcode</span> <span class="arrow down"></span></button> <button type="button" aria-label="leetcode" class="mobile-dropdown-title"><span class="title">leetcode</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/代码随想录/1.数组.html" class="nav-link">
  1.数组
</a></li><li class="dropdown-item"><!----> <a href="/代码随想录/10.动态规划/1.基础.html" class="nav-link">
  10.动态规划
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">react源码</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">react源码</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react源码/理念.html" class="nav-link">
  1.理念
</a></li><li class="dropdown-item"><!----> <a href="/react源码/3.render.html" class="nav-link">
  3.render
</a></li><li class="dropdown-item"><!----> <a href="/react源码/4.commit.html" class="nav-link">
  4.commit
</a></li><li class="dropdown-item"><!----> <a href="/react源码/5.状态更新.html" class="nav-link">
  5.状态更新
</a></li><li class="dropdown-item"><!----> <a href="/react源码/6.diff.html" class="nav-link">
  6.diff
</a></li><li class="dropdown-item"><!----> <a href="/react/7.实现hooks.html" class="nav-link">
  7.实现hooks
</a></li><li class="dropdown-item"><!----> <a href="/react/8.concurrentMode.html" class="nav-link">
  8.concurrentMode
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">webpack</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">webpack</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/webpack/1.配置.html" class="nav-link">
  1.配置
</a></li><li class="dropdown-item"><!----> <a href="/webpack/2.loader.html" class="nav-link">
  2.loader
</a></li><li class="dropdown-item"><!----> <a href="/webpack/3.plugin.html" class="nav-link">
  3.plugin
</a></li><li class="dropdown-item"><!----> <a href="/webpack/4.模块化原理.html" class="nav-link">
  4.模块化原理
</a></li><li class="dropdown-item"><!----> <a href="/webpack/5.babel.html" class="nav-link">
  5.babel
</a></li><li class="dropdown-item"><!----> <a href="/webpack/6.HMR.html" class="nav-link">
  6.HMR
</a></li><li class="dropdown-item"><!----> <a href="/webpack/7.环境分离.html" class="nav-link">
  7.环境分离
</a></li><li class="dropdown-item"><!----> <a href="/webpack/8.tree_shaking.html" class="nav-link">
  8.tree_shaking
</a></li><li class="dropdown-item"><!----> <a href="/webpack/9,源码.html" class="nav-link">
  9.源码
</a></li><li class="dropdown-item"><!----> <a href="/webpack/11.自定义loader.html" class="nav-link">
  11.自定义loader
</a></li><li class="dropdown-item"><!----> <a href="/webpack/12.自定义plugin.html" class="nav-link">
  12.自定义plugin
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">前端设计模式</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">前端设计模式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/设计模式/创建型.html" class="nav-link">
  创建型
</a></li><li class="dropdown-item"><!----> <a href="/设计模式/结构型.html" class="nav-link">
  结构型
</a></li><li class="dropdown-item"><!----> <a href="/设计模式/行为型.html" class="nav-link">
  行为型
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">angular</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">angular</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react/react%E8%BF%9B%E9%98%B6%E5%AE%9E%E8%B7%B5%E6%8C%87%E5%8D%97/.html" class="nav-link">
  angular性能调优
</a></li><li class="dropdown-item"><!----> <a href="/设计模式/结构型.html" class="nav-link">
  angular源码理解
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">健身</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">健身</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react/react%E8%BF%9B%E9%98%B6%E5%AE%9E%E8%B7%B5%E6%8C%87%E5%8D%97/.html" class="nav-link">
  angular性能调优
</a></li><li class="dropdown-item"><!----> <a href="/设计模式/结构型.html" class="nav-link">
  angular源码理解
</a></li></ul></div></div><div class="nav-item"><a href="/me.html" class="nav-link">
  关于我
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>react进阶实践指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/react/react进阶实践指南/fiber.html" class="sidebar-link">fiber保存的信息</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/react/react进阶实践指南/v18.html" class="sidebar-link">transition</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/v18.html#意义" class="sidebar-link">意义</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/v18.html#starttransition" class="sidebar-link">startTransition</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/v18.html#usetransition" class="sidebar-link">useTransition</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/v18.html#usedeferredvalue" class="sidebar-link">useDeferredValue</a></li></ul></li><li><a href="/react/react进阶实践指南/优化篇.html" class="sidebar-link">渲染控制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/优化篇.html#渲染的理解" class="sidebar-link">渲染的理解</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/优化篇.html#控制render" class="sidebar-link">控制render</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/优化篇.html#对render的思考" class="sidebar-link">对render的思考</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/优化篇.html#二-懒加载和异步渲染" class="sidebar-link">二 懒加载和异步渲染</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/优化篇.html#三-渲染错误边界" class="sidebar-link">三 渲染错误边界</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/优化篇.html#四-从diff-children看key的合理使用" class="sidebar-link">四 从diff children看key的合理使用</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/优化篇.html#时间分片" class="sidebar-link">时间分片</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/优化篇.html#虚拟列表" class="sidebar-link">虚拟列表</a></li></ul></li><li><a href="/react/react进阶实践指南/原理篇.html" class="sidebar-link">事件原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#独特的事件处理" class="sidebar-link">独特的事件处理</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#事件合成" class="sidebar-link">事件合成</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#事件绑定" class="sidebar-link">事件绑定</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#事件触发" class="sidebar-link">事件触发</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#异步调度" class="sidebar-link">异步调度</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#异步调度原理" class="sidebar-link">异步调度原理</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#背景" class="sidebar-link">背景</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#二-fiber认识" class="sidebar-link">二 fiber认识</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#三-fiber更新机制" class="sidebar-link">三 fiber更新机制</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#四-两大阶段-render和commit" class="sidebar-link">四 两大阶段：render和commit</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#二-hooks与fiber-workinprogress" class="sidebar-link">二 hooks与fiber（workInProgress）</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#三-状态派发" class="sidebar-link">三 状态派发</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#四-处理副作用" class="sidebar-link">四 处理副作用</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#五-状态获取与状态缓存" class="sidebar-link">五 状态获取与状态缓存</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#六-总结" class="sidebar-link">六 总结</a></li></ul></li><li><a href="/react/react进阶实践指南/原理篇2.html" class="sidebar-link">context原理</a></li><li><a href="/react/react进阶实践指南/基础篇.html" class="active sidebar-link">jsx</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#一、常用元素被react处理成什么" class="sidebar-link">一、常用元素被React处理成什么</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#二、可控性render" class="sidebar-link">二、可控性render</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#三、babel解析jsx" class="sidebar-link">三、Babel解析JSX</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#二、函数组件" class="sidebar-link">二、函数组件</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#三、5种组件通信方式" class="sidebar-link">三、5种组件通信方式</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#四、组件强化" class="sidebar-link">四、组件强化</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#一、类组件setstate" class="sidebar-link">一、类组件setState</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#二、函数组件的usestate" class="sidebar-link">二、函数组件的useState</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#一、监听props" class="sidebar-link">一、监听props</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#二、props-children模式" class="sidebar-link">二、props + children模式</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#三、操作props" class="sidebar-link">三、操作props</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#类组件生命周期" class="sidebar-link">类组件生命周期</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#各个生命周期能做些什么" class="sidebar-link">各个生命周期能做些什么</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#函数组件生命周期替代方案" class="sidebar-link">函数组件生命周期替代方案</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#ref的基本概念和使用" class="sidebar-link">ref的基本概念和使用</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#ref原理" class="sidebar-link">ref原理</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#基本使用" class="sidebar-link">基本使用</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#高阶组件类型" class="sidebar-link">高阶组件类型</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#高阶组件如何编写" class="sidebar-link">高阶组件如何编写</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#高阶组件注意事项" class="sidebar-link">高阶组件注意事项</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#进阶实践-权限拦截" class="sidebar-link">进阶实践 权限拦截</a></li></ul></li><li><a href="/react/react进阶实践指南/实践篇.html" class="sidebar-link">实现mini-router</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/实践篇.html#二-设计思路" class="sidebar-link">二 设计思路</a></li></ul></li><li><a href="/react/react进阶实践指南/源码目录.html" class="sidebar-link">/react/react进阶实践指南/源码目录.html</a></li><li><a href="/react/react进阶实践指南/生态篇.html" class="sidebar-link">react-router</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/生态篇.html#一-前言" class="sidebar-link">一 前言</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/生态篇.html#二-路由原理" class="sidebar-link">二 路由原理</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/生态篇.html#三-react-router-基本构成" class="sidebar-link">三 React-Router 基本构成</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/生态篇.html#四-路由使用指南" class="sidebar-link">四 路由使用指南</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/生态篇.html#五-实践一权限路由封装" class="sidebar-link">五 实践一权限路由封装</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/生态篇.html#一-前言-2" class="sidebar-link">一 前言</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/生态篇.html#二-react-redux用法" class="sidebar-link">二 React-Redux用法</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/生态篇.html#三-react-redux原理" class="sidebar-link">三 React-Redux原理</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/生态篇.html#四-实现异步" class="sidebar-link">四 实现异步</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="jsx"><a href="#jsx" class="header-anchor">#</a> jsx</h1> <h2 id="一、常用元素被react处理成什么"><a href="#一、常用元素被react处理成什么" class="header-anchor">#</a> 一、常用元素被React处理成什么</h2> <h3 id="_1-babel处理"><a href="#_1-babel处理" class="header-anchor">#</a> 1.babel处理</h3> <p>JSX变成React.createElement( )</p> <p>React.createElement( type，props，[children])</p> <h3 id="_2-createelement处理"><a href="#_2-createelement处理" class="header-anchor">#</a> 2.createElement处理</h3> <p>返回一个element对象，子元素转换成children列表</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;type&quot;: &quot;div&quot;,
    &quot;key&quot;: null,
    &quot;ref&quot;: null,
    &quot;props&quot;: {
        &quot;style&quot;: {},
        &quot;children&quot;: []
    },
}
</code></pre></div><h3 id="_3-reconcile处理"><a href="#_3-reconcile处理" class="header-anchor">#</a> 3.reconcile处理</h3> <p>element的每个子节点形成fiber对象，并关联起来形成fiber树</p> <p>fiber对象的重要属性：fiber tag，sibling、children、return</p> <p>map构建的数组子节点外层会加上fragment</p> <h2 id="二、可控性render"><a href="#二、可控性render" class="header-anchor">#</a> 二、可控性render</h2> <p>React.Children.toArray：深层次扁平化数组，规范react element</p> <p>React.isValidElement：验证element节点</p> <p>React.createElement：创建节点</p> <p>React.cloneElement：复制一份，可以指定，浅层合并props，配置config，替换children</p> <h2 id="三、babel解析jsx"><a href="#三、babel解析jsx" class="header-anchor">#</a> 三、Babel解析JSX</h2> <p>1、syntax和transform插件，转换JSX为createElement</p> <p>新版本不需要引入createElement，因为syntax插件配置了jsxRuntime api，可以运行时解析jsx</p> <p><strong>jsx 转化成 element 的处理逻辑：babel、createElement</strong></p> <h1 id="component"><a href="#component" class="header-anchor">#</a> component</h1> <p><strong><strong>React组件是什么</strong>：承载了UI和update的类和函数</strong></p> <blockquote><p>react-reconciler/src/ReactFiberClassComponent.js中：</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">constructClassInstance</span><span class="token punctuation">(</span>
    workInProgress<span class="token punctuation">,</span> <span class="token comment">// 当前正在工作的 fiber 对象</span>
    ctor<span class="token punctuation">,</span>           <span class="token comment">// 我们的类组件</span>
    props           <span class="token comment">// props </span>
<span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token comment">/* 实例化组件，得到组件实例 instance */</span>
     <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ctor</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> context<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>react-reconciler/src/ReactFiberHooks.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">renderWithHooks</span><span class="token punctuation">(</span>
  current<span class="token punctuation">,</span>          <span class="token comment">// 当前函数组件对应的 `fiber`， 初始化</span>
  workInProgress<span class="token punctuation">,</span>   <span class="token comment">// 当前正在工作的 fiber 对象</span>
  Component<span class="token punctuation">,</span>        <span class="token comment">// 我们函数组件</span>
  props<span class="token punctuation">,</span>            <span class="token comment">// 函数组件第一个参数 props</span>
  secondArg<span class="token punctuation">,</span>        <span class="token comment">// 函数组件其他参数</span>
  nextRenderExpirationTime<span class="token punctuation">,</span> <span class="token comment">//下次渲染过期时间</span>
<span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token comment">/* 执行我们的函数组件，得到 return 返回的 React.element对象 */</span>
     <span class="token keyword">let</span> children <span class="token operator">=</span> <span class="token function">Component</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> secondArg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="一、类组件"><a href="#一、类组件" class="header-anchor">#</a> 一、类组件</h3> <p>继承了React.Component，加入updater对象</p> <p>setState本质调用updater的enqueueSetState</p> <p>react底层定义类组件：绑定props和context，置空refs，绑定setState、forceUpdate方法，绑定updater</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Component</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> context<span class="token punctuation">,</span> updater</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>props <span class="token operator">=</span> props<span class="token punctuation">;</span>      <span class="token comment">//绑定props</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> context<span class="token punctuation">;</span>  <span class="token comment">//绑定context</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>refs <span class="token operator">=</span> emptyObject<span class="token punctuation">;</span> <span class="token comment">//绑定ref</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>updater <span class="token operator">=</span> updater <span class="token operator">||</span> ReactNoopUpdateQueue<span class="token punctuation">;</span> <span class="token comment">//上面所属的updater 对象</span>
<span class="token punctuation">}</span>
<span class="token comment">/* 绑定setState 方法 */</span>
<span class="token class-name">Component</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">setState</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">partialState<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>updater<span class="token punctuation">.</span><span class="token function">enqueueSetState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> partialState<span class="token punctuation">,</span> callback<span class="token punctuation">,</span> <span class="token string">'setState'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* 绑定forceupdate 方法 */</span>
<span class="token class-name">Component</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">forceUpdate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>updater<span class="token punctuation">.</span><span class="token function">enqueueForceUpdate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> callback<span class="token punctuation">,</span> <span class="token string">'forceUpdate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="二、函数组件"><a href="#二、函数组件" class="header-anchor">#</a> 二、函数组件</h2> <p>不要给prototype绑定属性或方法，没有作用。因为react对函数组件的调用是直接执行函数，而不是new的方式</p> <p><strong>函数组件和类组件的区别：</strong></p> <p>类组件实例化一次即可，实例保存了状态，但是函数每次更新都是新的函数执行，变量会重新声明。</p> <p>为了保存状态、执行副作用钩子而产生hooks</p> <h2 id="三、5种组件通信方式"><a href="#三、5种组件通信方式" class="header-anchor">#</a> 三、5种组件通信方式</h2> <ol><li>props和callback：父传子用props，子传父可以用props中的回调函数callback触发父的方法</li> <li>ref</li> <li>redux或mobx</li> <li>context</li> <li>event bus：busService.on, emit，违背了数据流向原则，不提倡</li></ol> <h2 id="四、组件强化"><a href="#四、组件强化" class="header-anchor">#</a> 四、组件强化</h2> <p>1.继承：state和生命周期钩子会被override</p> <p>2.自定义hooks</p> <p>3.HOC高阶组件</p> <h1 id="state"><a href="#state" class="header-anchor">#</a> state</h1> <p><strong>state 到底是同步还是异步的？</strong></p> <p>回答出 batchUpdate 批量更新概念，以及批量更新被打破的条件</p> <p>平时用的是legacy react，此外还有blocking 和 concurrent</p> <ul><li>legacy是18之前的基本使用模式</li> <li>blocking是concurrent的降级过渡版本</li> <li>concurrent作为react18的默认版本</li></ul> <h2 id="一、类组件setstate"><a href="#一、类组件setstate" class="header-anchor">#</a> 一、类组件setState</h2> <h3 id="_1-用法"><a href="#_1-用法" class="header-anchor">#</a> 1.用法</h3> <p>setState(obj, callback)</p> <p>obj若为函数，则会将当前的state和props作为参数，返回值用于合并新的state</p> <p><code>this.setState((state, props) =&gt; return { nubmer: 1 })</code></p> <p>callback能获取最新的state，可以做一些基于DOM的操作</p> <h3 id="_2-setstate触发后的底层过程"><a href="#_2-setstate触发后的底层过程" class="header-anchor">#</a> 2.setState触发后的底层过程</h3> <ol><li>产生更新优先级</li> <li>fiber root开始diff，合并state，触发render得到新的UI层</li> <li>commit 完成真实 DOM 替换</li> <li>setState 的 callback 执行</li></ol> <h3 id="_3-类组件限制state更新视图"><a href="#_3-类组件限制state更新视图" class="header-anchor">#</a> 3.类组件限制state更新视图</h3> <ul><li>pureComponent，对state和props浅比较</li> <li>shouldComponentUpdate，通过比较前后state决定是否更新</li></ul> <h3 id="_4-setstate的原理探究"><a href="#_4-setstate的原理探究" class="header-anchor">#</a> 4.setState的原理探究</h3> <p>类组件初始化绑定了负责更新的updater</p> <p>调用setState，底层调用了Updater的enqueueSetState</p> <p><strong>enqueueSetState的作用</strong>：创建一个update，push到当前fiber的待更新队列，开启调度更新</p> <blockquote><p>react-reconciler/src/ReactFiberClassComponent.js</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">enqueueSetState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> update <span class="token operator">=</span> <span class="token function">createUpdate</span><span class="token punctuation">(</span>expirationTime<span class="token punctuation">,</span> suspenceConfig<span class="token punctuation">)</span>
  callback <span class="token operator">&amp;&amp;</span> update<span class="token punctuation">.</span>callback <span class="token operator">=</span> callback
  <span class="token function">enqueueUpdate</span><span class="token punctuation">(</span>fiber<span class="token punctuation">,</span> update<span class="token punctuation">)</span>
  <span class="token function">scheduleUpdateOnFiber</span><span class="token punctuation">(</span>fiber<span class="token punctuation">,</span> expirationTime<span class="token punctuation">)</span> 
<span class="token punctuation">}</span>
</code></pre></div><h4 id="batchupdate"><a href="#batchupdate" class="header-anchor">#</a> batchUpdate</h4> <p>state批量更新离不开合成事件，所有事件都通过dispatch统一处理</p> <p><code>react-dom/src/events/DOMPluginEventSystem.js</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">dispatchEventForPluginEventSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">batchedEventUpdates</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>react-dom/src/events/ReactDOMUpdateBatching.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">batchEventUpdates</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  isBatchingEventUpdates <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">batchedEventUpdatesImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    isBatchingEventUpdates <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在scheduleUpdateOnFiber中根据开关 <code>isBatchingEventUpdates</code>确定是否批更新</p> <div class="language- extra-class"><pre><code>onClick事件中的多次setState都在批更新的条件下执行

而promise和setTimeout的setState则是在**批更新的上下文环境之外去执行**，因此批更新规则被打破
</code></pre></div><p>如何在异步环境开启批更新：react-dom的<strong>unstable_batchUpdates</strong>，实际工作中也会使用得上</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">unstable_batchedUpdates</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="提升更新优先级"><a href="#提升更新优先级" class="header-anchor">#</a> 提升更新优先级</h4> <p>flushSync提升更新的优先级，并且会合并之前的setState</p> <div class="language-ts extra-class"><pre class="language-ts"><code>ReactDOM<span class="token punctuation">.</span><span class="token function">flushSync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token builtin">number</span><span class="token operator">:</span> <span class="token number">3</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="二、函数组件的usestate"><a href="#二、函数组件的usestate" class="header-anchor">#</a> 二、函数组件的useState</h2> <p>dispatch的参数若为函数，可以称为reducer，其参数是上一次返回的state，返回作为新state</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">[</span> number <span class="token punctuation">,</span> setNumber <span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">handleClick</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
   <span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> state <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">// state - &gt; 0 + 1 = 1</span>
   <span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>  <span class="token comment">// state - &gt; 8</span>
   <span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> state <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">// state - &gt; 8 + 1 = 9</span>
<span class="token punctuation">}</span>
</code></pre></div><p>优先级与setState类似，都是flushSync &gt; normal &gt; setTimeout</p> <p><strong>useState注意事项：</strong></p> <p>1、dispatch不要传入相同的 state，否则视图不更新；dispatch会浅比较两次state，想要state相同时触发更新，需要写成<strong>dispatch({...state})</strong></p> <p>2、dispatch在本次函数执行上下文中，获取不到最新的 state 值</p> <p><strong>与setState的相同点：</strong></p> <ul><li>底层都调用了scheduleUpdateOnFiber</li> <li>且事件驱动情况下都有批量更新规则</li></ul> <p>不同点：</p> <ul><li>setState在非pure情况下不会shallowEqual props&amp;state，而useState的dispatch默认会shallow equal state</li> <li>useState只能通过useEffect执行state变化的副作用；而setState有callback获取最新的state</li></ul> <ul><li>setState 在底层处理逻辑上主要是和老 state 进行合并处理，而 useState 更倾向于重新赋值</li></ul> <h1 id="props"><a href="#props" class="header-anchor">#</a> props</h1> <p>父组件绑定在子组件标签的属性/方法，最终会变成 props 传递给它们，除了特殊的属性，比如说 ref 或者 key</p> <p>组件的插槽会被绑定在props的<strong>children</strong>属性</p> <p>props的作用：父子组件通信，插槽render props，render component，更新机制</p> <h2 id="一、监听props"><a href="#一、监听props" class="header-anchor">#</a> 一、监听props</h2> <p>类组件：componentWillReceiveProps不推荐使用，因为其超越了react的可控范围，可能会多次执行。替代方案是getDerivedStateFromProps</p> <p>函数组件：useEffect，useEffect初始化默认会执行一次</p> <h2 id="二、props-children模式"><a href="#二、props-children模式" class="header-anchor">#</a> 二、props + children模式</h2> <p>react常用的模式，如开源组件库react-router的Switch和Route，antd的Form和FormItem</p> <h3 id="_1-render-component"><a href="#_1-render-component" class="header-anchor">#</a> 1.render component</h3> <p>控制children渲染</p> <p>增强children，通过cloneElement强化props，修改children子元素等等</p> <h3 id="_2-render-props"><a href="#_2-render-props" class="header-anchor">#</a> 2.render props</h3> <p>控制children渲染</p> <p>增强children，通过cloneElement强化props，修改children子元素等等</p> <h3 id="_3-混合模式"><a href="#_3-混合模式" class="header-anchor">#</a> 3.混合模式</h3> <p>判断类型，再处理</p> <h2 id="三、操作props"><a href="#三、操作props" class="header-anchor">#</a> 三、操作props</h2> <p>抽象props</p> <p>抽离props</p> <p>注入props：cloneElement隐式注入props</p> <h1 id="lifecycle"><a href="#lifecycle" class="header-anchor">#</a> lifeCycle</h1> <h2 id="类组件生命周期"><a href="#类组件生命周期" class="header-anchor">#</a> 类组件生命周期</h2> <p><strong>render：深度优先遍历workInProgress树，并与current fiber树进行diff，对于变化的组件执行render，得到新的UI视图层</strong></p> <p><strong>commit：创建修改真实DOM节点</strong></p> <h3 id="类组件的reconcile处理逻辑"><a href="#类组件的reconcile处理逻辑" class="header-anchor">#</a> 类组件的reconcile处理逻辑：</h3> <blockquote><p>react-reconciler/src/ReactFiberBeginWork.js</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token comment">/* workloop React 处理类组件的主要功能方法 */</span>
<span class="token keyword">function</span> <span class="token function">updateClassComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> shouldUpdate
    <span class="token keyword">const</span> instance <span class="token operator">=</span> workInProgress<span class="token punctuation">.</span>stateNode <span class="token comment">// stateNode 是 fiber 指向 类组件实例的指针。</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// instance 为组件实例,如果组件实例不存在，证明该类组件没有被挂载过，那么会走初始化流程</span>
        <span class="token function">constructClassInstance</span><span class="token punctuation">(</span>workInProgress<span class="token punctuation">,</span> Component<span class="token punctuation">,</span> nextProps<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 组件实例将在这个方法中被new。</span>
        <span class="token function">mountClassInstance</span><span class="token punctuation">(</span>  workInProgress<span class="token punctuation">,</span>Component<span class="token punctuation">,</span> nextProps<span class="token punctuation">,</span>renderExpirationTime <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//初始化挂载组件流程</span>
        shouldUpdate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// shouldUpdate 标识用来证明 组件是否需要更新。</span>
     <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>  
        shouldUpdate <span class="token operator">=</span> <span class="token function">updateClassInstance</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> workInProgress<span class="token punctuation">,</span> Component<span class="token punctuation">,</span> nextProps<span class="token punctuation">,</span> renderExpirationTime<span class="token punctuation">)</span> <span class="token comment">// 更新组件流程</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>shouldUpdate<span class="token punctuation">)</span><span class="token punctuation">{</span>
         nextChildren <span class="token operator">=</span> instance<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* 执行render函数 ，得到子节点 */</span>
         <span class="token function">reconcileChildren</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span>workInProgress<span class="token punctuation">,</span>nextChildren<span class="token punctuation">,</span>renderExpirationTime<span class="token punctuation">)</span> <span class="token comment">/* 继续调和子节点 */</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>nextProps：更新中新的props</li> <li>renderExpirationTime：下一次渲染的过期时间</li></ul> <p><img src="image/%E5%9F%BA%E7%A1%80%E7%AF%87/1650442300171.png" alt=""></p> <h3 id="初始化阶段"><a href="#初始化阶段" class="header-anchor">#</a> 初始化阶段</h3> <p>render阶段</p> <h4 id="constructclassinstance"><a href="#constructclassinstance" class="header-anchor">#</a> constructClassInstance</h4> <p>new ctor 创建instance，adoptClassInstance，绑定updater，设置stateNode</p> <h4 id="mountclassinstance"><a href="#mountclassinstance" class="header-anchor">#</a> mountClassInstance</h4> <p>getDerivedStateFromProps返回的partitalState和prevState结合，赋值给workInProgress的memoizedState和instance的state</p> <div class="language- extra-class"><pre><code>getDerivedStateFromProps：ctor绑定的静态方法，传入新的props和旧的state，返回合并后的state，供实例使用
</code></pre></div><p>可能执行willMount</p> <h4 id="render"><a href="#render" class="header-anchor">#</a> render</h4> <p>形成children，然后调用reconcileChildren深度reconcile</p> <h4 id="componentdidmount"><a href="#componentdidmount" class="header-anchor">#</a> componentDidMount</h4> <p>commiLifeCycles中的调用instance.componentDidMount</p> <p>commit阶段初始化调用DidMount</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">commitLifeCycles</span><span class="token punctuation">(</span><span class="token parameter">finishedRoot<span class="token punctuation">,</span>current<span class="token punctuation">,</span>finishedWork</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token keyword">switch</span> <span class="token punctuation">(</span>finishedWork<span class="token punctuation">.</span>tag<span class="token punctuation">)</span><span class="token punctuation">{</span>                             <span class="token comment">/* fiber tag 在第一节讲了不同fiber类型 */</span>
        <span class="token keyword">case</span> ClassComponent<span class="token operator">:</span> <span class="token punctuation">{</span>                              <span class="token comment">/* 如果是 类组件 类型 */</span>
             <span class="token keyword">const</span> instance <span class="token operator">=</span> finishedWork<span class="token punctuation">.</span>stateNode        <span class="token comment">/* 类实例 */</span>
             <span class="token keyword">if</span><span class="token punctuation">(</span>current <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                          <span class="token comment">/* 类组件第一次调和渲染 */</span>
                instance<span class="token punctuation">.</span><span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
             <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                                         <span class="token comment">/* 类组件更新 */</span>
                instance<span class="token punctuation">.</span><span class="token function">componentDidUpdate</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">,</span>prevState，instance<span class="token punctuation">.</span>__reactInternalSnapshotBeforeUpdate<span class="token punctuation">)</span><span class="token punctuation">;</span> 
             <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>componentDidMount</code> 执行时机 和 <code>componentDidUpdate</code> 执行时机是相同的</p> <p>执行顺序：constructor -&gt; getDerivedStateFromProps / componentWillMount -&gt; render -&gt; componentDidMount</p> <h3 id="更新阶段"><a href="#更新阶段" class="header-anchor">#</a> 更新阶段</h3> <p><img src="image/%E5%9F%BA%E7%A1%80%E7%AF%87/1650451382275.png" alt=""></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">updateClassInstance</span><span class="token punctuation">(</span><span class="token parameter">current<span class="token punctuation">,</span>workInProgress<span class="token punctuation">,</span>ctor<span class="token punctuation">,</span>newProps<span class="token punctuation">,</span>renderExpirationTime</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> instance <span class="token operator">=</span> workInProgress<span class="token punctuation">.</span>stateNode<span class="token punctuation">;</span> <span class="token comment">// 类组件实例</span>
    <span class="token keyword">const</span> hasNewLifecycles <span class="token operator">=</span>  <span class="token keyword">typeof</span> ctor<span class="token punctuation">.</span>getDerivedStateFromProps <span class="token operator">===</span> <span class="token string">'function'</span>  <span class="token comment">// 判断是否具有 getDerivedStateFromProps 生命周期</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>hasNewLifecycles <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> instance<span class="token punctuation">.</span>componentWillReceiveProps <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>oldProps <span class="token operator">!==</span> newProps <span class="token operator">||</span> oldContext <span class="token operator">!==</span> nextContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token comment">// 浅比较 props 不相等</span>
            instance<span class="token punctuation">.</span><span class="token function">componentWillReceiveProps</span><span class="token punctuation">(</span>newProps<span class="token punctuation">,</span> nextContext<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 执行生命周期 componentWillReceiveProps </span>
         <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> newState <span class="token operator">=</span> <span class="token punctuation">(</span>instance<span class="token punctuation">.</span>state <span class="token operator">=</span> oldState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> getDerivedStateFromProps <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ctor<span class="token punctuation">.</span><span class="token function">getDerivedStateFromProps</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">,</span>prevState<span class="token punctuation">)</span>  <span class="token comment">/* 执行生命周期getDerivedStateFromProps  ，逻辑和mounted类似 ，合并state  */</span>
        newState <span class="token operator">=</span> workInProgress<span class="token punctuation">.</span>memoizedState<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>   
    <span class="token keyword">let</span> shouldUpdate <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> instance<span class="token punctuation">.</span>shouldComponentUpdate <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">/* 执行生命周期 shouldComponentUpdate 返回值决定是否执行render ，调和子节点 */</span>
        shouldUpdate <span class="token operator">=</span> instance<span class="token punctuation">.</span><span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span>newProps<span class="token punctuation">,</span>newState<span class="token punctuation">,</span>nextContext<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>shouldUpdate<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> instance<span class="token punctuation">.</span>componentWillUpdate <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            instance<span class="token punctuation">.</span><span class="token function">componentWillUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* 执行生命周期 componentWillUpdate  */</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> shouldUpdate
<span class="token punctuation">}</span>
</code></pre></div><h4 id="componentwillreceiveprops"><a href="#componentwillreceiveprops" class="header-anchor">#</a> componentWillReceiveProps</h4> <p>判断是否存在getDerivedStateFromProps，不存在就执行componentWillReceiveProps</p> <h4 id="getderivedstatefromprops"><a href="#getderivedstatefromprops" class="header-anchor">#</a> getDerivedStateFromProps</h4> <p>返回值合并形成新的state</p> <h4 id="shouldcomponentupdate"><a href="#shouldcomponentupdate" class="header-anchor">#</a> shouldComponentUpdate</h4> <p>传入新的 props ，新的 state ，和新的 context ，返回值决定是否继续执行 render 函数</p> <h4 id="componentwillupdate"><a href="#componentwillupdate" class="header-anchor">#</a> componentWillUpdate</h4> <p>updateClassInstance 方法到此执行完毕</p> <h4 id="render-2"><a href="#render-2" class="header-anchor">#</a> render</h4> <p>执行render获得新的element，继续reconcile子节点</p> <h4 id="getsnapshotbeforeupdate"><a href="#getsnapshotbeforeupdate" class="header-anchor">#</a> getSnapshotBeforeUpdate</h4> <p>commit阶段的beforeMutation时期执行，返回值作为componentDidUpdate的第三个参数__reactInternalSnapshotBeforeUpdate</p> <h4 id="componentdidupdate"><a href="#componentdidupdate" class="header-anchor">#</a> componentDidUpdate</h4> <p>DOM修改完成，更新的生命周期执行完成</p> <p>更新阶段对应的生命周期的执行顺序：</p> <p>componentWillReceiveProps( props 改变) / getDerivedStateFromProp -&gt; shouldComponentUpdate -&gt; componentWillUpdate -&gt; render -&gt; getSnapshotBeforeUpdate -&gt; componentDidUpdate</p> <h3 id="销毁阶段"><a href="#销毁阶段" class="header-anchor">#</a> 销毁阶段</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">callComponentWillUnmountWithTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    instance<span class="token punctuation">.</span><span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="componentwillunmount"><a href="#componentwillunmount" class="header-anchor">#</a> <strong>componentWillUnmount</strong></h4> <p>reconcile时如果元素被移除，则打上deletion标签，commit阶段调用componentWillUnmount，统一写在组件和DOM元素</p> <h2 id="各个生命周期能做些什么"><a href="#各个生命周期能做些什么" class="header-anchor">#</a> 各个生命周期能做些什么</h2> <h3 id="constructor"><a href="#constructor" class="header-anchor">#</a> constructor</h3> <ul><li>初始化 state ，比如可以用来截取路由中的参数，赋值给 state 。</li> <li>对类组件的事件做一些处理，比如绑定 this ， 节流，防抖等。</li> <li>对类组件进行一些必要生命周期的劫持，渲染劫持，这个功能更适合反向继承的HOC ，在 HOC 环节，会详细讲解反向继承这种模式</li></ul> <h3 id="getderivedstatefromprops-2"><a href="#getderivedstatefromprops-2" class="header-anchor">#</a> getDerivedStateFromProps</h3> <ul><li>代替 componentWillMount 和 componentWillReceiveProps</li> <li>组件初始化或者更新时，将 props 映射到 state。</li> <li>返回值与 state 合并完，可以作为 shouldComponentUpdate 第二个参数 newState ，可以判断是否渲染组件</li></ul> <h3 id="componentwillmount-和-unsafe-componentwillmount"><a href="#componentwillmount-和-unsafe-componentwillmount" class="header-anchor">#</a> componentWillMount 和 UNSAFE_componentWillMount</h3> <p>在render之前执行，react对于render之前的生命周期函数没有限制，有可能会被执行多次，所以是UNSAFE的</p> <h3 id="componentwillreceiveprops-和-unsafe-componentwillreceiveprops"><a href="#componentwillreceiveprops-和-unsafe-componentwillreceiveprops" class="header-anchor">#</a> componentWillReceiveProps 和 UNSAFE_componentWillReceiveProps</h3> <p>没看懂</p> <ul><li>用来监听父组件是否执行 render 。</li> <li>用来接受 props 改变，组件可以根据props改变，来决定是否更新 state ，
<ul><li>因为可以访问到 this ， 所以可以在异步成功回调(接口请求数据)改变 state 。这个是 getDerivedStateFromProps 不能实现的。</li></ul></li></ul> <p>但是笔者不建议用这种方式，props 改变，再触发 componentWillReceiveProps 异步请求数据渲染</p> <p>首先在没做优化前提下会带来两次子组件的更新，第一次 props 改变，第二次 props 改变，异步改变state</p> <p>其次该生命周期的不安全性。再者需要在该生命周期内部，设置大量的条件判断语句，通过 this.props ， nextProps 判断 props 到底改变与否。</p> <p>所以完全可以换一种思路，那就是 <strong>状态提升</strong>，把数据层完全托管父组件，子组件没有副作用，只负责渲染父组件传递的 props 即可。</p> <h3 id="unsafe-componentwillupdate"><a href="#unsafe-componentwillupdate" class="header-anchor">#</a> UNSAFE_componentWillUpdate</h3> <p>新的生命周期 getSnapshotBeforeUpdate 来代替</p> <h3 id="render-3"><a href="#render-3" class="header-anchor">#</a> render</h3> <p><strong>createElement创建元素</strong> , <strong>cloneElement 克隆元素</strong> ，<strong>React.children 遍历 children</strong> 的操作</p> <h3 id="getsnapshotbeforeupdate-2"><a href="#getsnapshotbeforeupdate-2" class="header-anchor">#</a> getSnapshotBeforeUpdate</h3> <p>保存一次更新前的信息</p> <p>触发时机：在 commit 阶段的<strong>before Mutation</strong> 获取更新前的快照</p> <p>这个生命周期意义就是配合componentDidUpdate 一起使用，计算形成一个 snapShot 传递给componentDidUpdate 。</p> <h3 id="componentdidupdate-2"><a href="#componentdidupdate-2" class="header-anchor">#</a> componentDidUpdate</h3> <p><code>componentDidUpdate(prevProps, prevState, snapshot){}</code></p> <ul><li>此时 DOM 已经更新，可以直接获取 DOM 最新状态</li> <li>这个函数里面如果想要使用 setState ，一定要加以限制，否则会引起无限循环</li> <li>接受 getSnapshotBeforeUpdate 保存的快照信息</li></ul> <h3 id="componentdidmount-2"><a href="#componentdidmount-2" class="header-anchor">#</a> componentDidMount</h3> <p>可以做一些基于 DOM 操作，DOM 事件监听器。</p> <h3 id="shouldcomponentupdate-2"><a href="#shouldcomponentupdate-2" class="header-anchor">#</a> shouldComponentUpdate</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token parameter">newProps<span class="token punctuation">,</span>newState<span class="token punctuation">,</span>nextContext</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>关注第二个参数 newState ，如果有 getDerivedStateFromProps 生命周期 ，它的返回值将合并到 newState ，供 shouldComponentUpdate 使用</p> <h3 id="componentwillunmount-2"><a href="#componentwillunmount-2" class="header-anchor">#</a> componentWillUnmount</h3> <p>清除一些可能造成内存泄漏的定时器，延时器，或者是一些事件监听器</p> <h2 id="函数组件生命周期替代方案"><a href="#函数组件生命周期替代方案" class="header-anchor">#</a> 函数组件生命周期替代方案</h2> <h3 id="useeffect-和-uselayouteffect"><a href="#useeffect-和-uselayouteffect" class="header-anchor">#</a> useEffect 和 useLayoutEffect</h3> <h4 id="useeffect"><a href="#useeffect" class="header-anchor">#</a> <strong>useEffect</strong></h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> destory
<span class="token punctuation">}</span><span class="token punctuation">,</span>dep<span class="token punctuation">)</span>
</code></pre></div><p>dep改变时，执行上一次callback的destroy，并执行新的effect参数</p> <p>若dep为[]，则<strong>只有初始化执行一次</strong></p> <p>react对useEffect是<strong>异步调用的逻辑</strong>，放入setTimeout，不阻塞视图绘制</p> <p>而 componentDidMount / componentDidUpdate 是同步执行的，与useLayoutEffect相似</p> <h4 id="uselayouteffect"><a href="#uselayouteffect" class="header-anchor">#</a> useLayoutEffect</h4> <p>采用了同步执行</p> <p>与useEffect的区别</p> <p>useLayoutEffect 是在DOM 绘制之前，可以方便修改 DOM；因此涉及DOM修改的就用useLayoutEffect</p> <h3 id="componentdidmount-unmount-替代方案"><a href="#componentdidmount-unmount-替代方案" class="header-anchor">#</a> componentDidMount /  Unmount 替代方案</h3> <div class="language-js extra-class"><pre class="language-js"><code>React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">/* 请求数据 ， 事件监听 ， 操纵dom */</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="componentwillreceiveprops-代替方案"><a href="#componentwillreceiveprops-代替方案" class="header-anchor">#</a> componentWillReceiveProps 代替方案</h3> <div class="language-js extra-class"><pre class="language-js"><code>React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'props变化：componentWillReceiveProps'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span> props <span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="componentdidupdate-替代方案"><a href="#componentdidupdate-替代方案" class="header-anchor">#</a> componentDidUpdate 替代方案</h3> <p>useEffect 是异步执行，componentDidUpdate 是同步执行 ，但都是在 commit 阶段</p> <p>没有第二个参数，那么每一次执行函数组件，都会执行该 effect</p> <div class="language-js extra-class"><pre class="language-js"><code>React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'组件更新完成：componentDidUpdate '</span><span class="token punctuation">)</span>   
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">/* 没有 dep 依赖项 */</span>
</code></pre></div><h1 id="多功能ref"><a href="#多功能ref" class="header-anchor">#</a> 多功能Ref</h1> <h2 id="ref的基本概念和使用"><a href="#ref的基本概念和使用" class="header-anchor">#</a> ref的基本概念和使用</h2> <h3 id="ref对象创建"><a href="#ref对象创建" class="header-anchor">#</a> ref对象创建</h3> <h4 id="createref"><a href="#createref" class="header-anchor">#</a> createRef</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>dom <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dom <span class="token punctuation">}</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dom<span class="token punctuation">)</span> <span class="token comment">// { current: div }</span>
</code></pre></div><p>函数组件不能使用createRef，因为每次更新函数组件都会重新执行，不会保存内部状态，因此ref信息会丢失</p> <h4 id="useref"><a href="#useref" class="header-anchor">#</a> useRef</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> currentDom <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>currentDom<span class="token punctuation">.</span>current<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dom <span class="token punctuation">}</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre></div><p>hooks和函数组件对应fiber关联，ref挂到fiber上，函数每次执行，只要不被销毁，fiber就会一直存在</p> <h3 id="处理ref的逻辑"><a href="#处理ref的逻辑" class="header-anchor">#</a> 处理ref的逻辑</h3> <h4 id="类组件获取ref的三种方式"><a href="#类组件获取ref的三种方式" class="header-anchor">#</a> 类组件获取ref的三种方式</h4> <ul><li>字符串，直接写标签的ref属性，通过this.props获取</li> <li>函数：<code>ref={ (node) =&gt; this.currentDom = node; }</code></li> <li>对象：createRef() 或者 useRef()</li></ul> <h3 id="ref高阶用法"><a href="#ref高阶用法" class="header-anchor">#</a> ref高阶用法</h3> <h4 id="一。forwardref-转发-ref"><a href="#一。forwardref-转发-ref" class="header-anchor">#</a> 一。forwardRef 转发 ref</h4> <p>传入函数，返回一个组件；让 ref 可以通过 props 传递</p> <p>含义：allows us to forward a component's ref to another one</p> <h5 id="_1-跨层级获取"><a href="#_1-跨层级获取" class="header-anchor">#</a> 1.跨层级获取</h5> <p>ref 变成 props</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>grandRef<span class="token punctuation">}</span> <span class="token operator">=</span> props
  <span class="token keyword">return</span> div ref<span class="token operator">=</span><span class="token punctuation">{</span>grandRef<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Son grandRef<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>grandRef<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

NewFather <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Father grandRef<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">GrandFather</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> NewFather ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>node <span class="token operator">=</span> node<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="_2-合并转发ref"><a href="#_2-合并转发ref" class="header-anchor">#</a> 2.合并转发ref</h5> <p>forewardRef转发的ref也可以传递自定义ref</p> <p>将子从props获取的ref添加属性，传给父组件</p> <h5 id="_3-高阶组件转发"><a href="#_3-高阶组件转发" class="header-anchor">#</a> 3.高阶组件转发</h5> <p>解决高阶组件的ref指向返回的组件而非原始类的问题</p> <h4 id="二。ref-实现-组件通信"><a href="#二。ref-实现-组件通信" class="header-anchor">#</a> 二。ref 实现 组件通信</h4> <p><strong>特殊的组件通信场景</strong>：不想通过父组件改变props触发子组件更新，而是通过ref标记子组件实例</p> <p>例如：比如Form表单 的resetfields和setFieldsValue</p> <h5 id="类组件ref"><a href="#类组件ref" class="header-anchor">#</a> 类组件ref</h5> <h5 id="函数组件-forwardref-useimperativehandle"><a href="#函数组件-forwardref-useimperativehandle" class="header-anchor">#</a> 函数组件 forwardRef + useImperativeHandle</h5> <p>这种方式让函数组件也能流畅使用 ref 通信</p> <p>函数组件本身没有实例ref，但是hooks提供了forwardRef作为中间层</p> <p>useImperativeHandle（ref，createHandle，deps）</p> <h4 id="函数组件缓存数据"><a href="#函数组件缓存数据" class="header-anchor">#</a> 函数组件缓存数据</h4> <p>对于一些不需要引起更新的数据，可以放到ref中，避免冗余的更新。</p> <p>同时不需要将ref设置为dep，因为useRef始终指向同一个内存空间，因此可以确保拿到最新的ref值</p> <h2 id="ref原理"><a href="#ref原理" class="header-anchor">#</a> ref原理</h2> <p>回调函数的方式处理ref，会执行两次</p> <p>ref的处理都在commit阶段</p> <p>React 底层用两个方法处理：<strong>commitDetachRef</strong> 和 <strong>commitAttachRef</strong></p> <p>一次在 DOM 更新之前，一次在 DOM 更新之后</p> <p><strong>mutation 阶段</strong>, 执行commitDetachRef，清空之前ref值，重置为 null</p> <p><strong>DOM 更新阶段</strong>，根据不同的 effect 标签，DOM</p> <p><strong>layout 阶段</strong>，更新完dom之后更新 ref</p> <ul><li>如果是字符串 ref=&quot;node&quot; 或是 函数式 <code>ref={(node)=&gt; this.node = node }</code> 会执行 ref 函数，重置新的 ref
<ul><li>当 ref 属性是字符串的时候，React 会自动绑定一个函数，用来处理 ref 逻辑</li></ul></li> <li>如果是 ref 对象方式，会更新 ref 对象的 current 属性从而更新 ref</li></ul> <h3 id="ref的处理特性"><a href="#ref的处理特性" class="header-anchor">#</a> ref的处理特性</h3> <p>React 被 ref 标记的 fiber，<strong>只有在 ref 更新的时候，才会调用如上方法更新 ref</strong></p> <p><strong><code>commitAttachRef</code> 调用时机</strong></p> <h3 id="卸载ref"><a href="#卸载ref" class="header-anchor">#</a> 卸载ref</h3> <p>被卸载的 fiber 会被打成 <code>Deletion</code> effect tag</p> <p>在 commit 阶段会进行 commitDeletion 流程</p> <p>对于有 ref 标记的 ClassComponent （类组件） 和 HostComponent （元素），会统一走 <code>safelyDetachRef</code> 流程卸载 ref</p> <h1 id="提供者context"><a href="#提供者context" class="header-anchor">#</a> 提供者context</h1> <h2 id="基本使用"><a href="#基本使用" class="header-anchor">#</a> 基本使用</h2> <p>createContext, context.Provider, context.Consumer</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> context <span class="token operator">=</span> React<span class="token punctuation">.</span>createContext<span class="token punctuation">;</span>
<span class="token keyword">const</span> Provider <span class="token operator">=</span> context<span class="token punctuation">.</span>Provider<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">ProviderDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>contextValue<span class="token punctuation">,</span> setContextValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span> contextValue <span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Son <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> consumer <span class="token operator">=</span> context<span class="token punctuation">.</span>Consumer<span class="token punctuation">;</span>
</code></pre></div><h3 id="消费者"><a href="#消费者" class="header-anchor">#</a> 消费者</h3> <h4 id="_1。类组件contexttype"><a href="#_1。类组件contexttype" class="header-anchor">#</a> 1。类组件contextType</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">ConsumerDemo</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> a<span class="token punctuation">,</span> b <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

ConsumerDemo<span class="token punctuation">.</span>contextType <span class="token operator">=</span> context<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">Son</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>ConsumerDemo<span class="token operator">/</span><span class="token operator">&gt;</span>

</code></pre></div><h4 id="_2。函数组件usecontext"><a href="#_2。函数组件usecontext" class="header-anchor">#</a> 2。函数组件useContext</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">ConsumerDemo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> a<span class="token punctuation">,</span> b <span class="token punctuation">}</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useContext</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">Son</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>ConsumerDemo<span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><h4 id="_3。订阅者consumer"><a href="#_3。订阅者consumer" class="header-anchor">#</a> 3。订阅者Consumer</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">ConsumerDemo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>a<span class="token punctuation">,</span> b<span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">Son</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token comment">// 将context 转换为 props</span>
  <span class="token operator">&lt;</span>Consumer<span class="token operator">&gt;</span>
    <span class="token punctuation">{</span>
      <span class="token punctuation">(</span><span class="token parameter">contextValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>ConsumerDemo <span class="token punctuation">{</span><span class="token operator">...</span>contextValue<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Consumer<span class="token operator">&gt;</span>
<span class="token punctuation">)</span>
</code></pre></div><p>采用 render props的方式接收value</p> <h3 id="动态context"><a href="#动态context" class="header-anchor">#</a> 动态context</h3> <p>Provider的value改变</p> <ul><li>contextType和useContext重新render</li> <li>而Consumer方式的children函数重新执行，但是Consumer的父组件不会重新更新</li></ul> <p>memo的应用场景</p> <p>如果son没有使用memo，当Provider因为useState而重新render时，son组件会跟随一起render</p> <p>如果son有大量子组件，会造成性能损耗</p> <p>解决方式：</p> <ul><li><strong>对子组件的props浅比较</strong>：React.memo、pureComponent</li> <li>React对React element的缓存，下次reconcile时跳过对应fiber的更新</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span> contextValue <span class="token punctuation">}</span><span class="token operator">&gt;</span>
  <span class="token punctuation">{</span> React<span class="token punctuation">.</span><span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>Son<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span>
</code></pre></div><p>嵌套Provider</p> <p>逐层传递Provider</p> <h1 id="模块化css"><a href="#模块化css" class="header-anchor">#</a> 模块化css</h1> <h1 id="高阶组件"><a href="#高阶组件" class="header-anchor">#</a> 高阶组件</h1> <p>HOC的作用就是解决代码复用问题</p> <h2 id="高阶组件类型"><a href="#高阶组件类型" class="header-anchor">#</a> 高阶组件类型</h2> <h3 id="属性代理"><a href="#属性代理" class="header-anchor">#</a> 属性代理</h3> <p>用代理组件包裹原始组件，在里面做一些强化组件的操作</p> <p>返回一个新组件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token constant">HOC</span><span class="token punctuation">(</span><span class="token parameter">WrapComponent</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">Advance</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
       state<span class="token operator">=</span><span class="token punctuation">{</span>
           name<span class="token operator">:</span><span class="token string">'alien'</span>
       <span class="token punctuation">}</span>
       <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrapComponent  <span class="token punctuation">{</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props <span class="token punctuation">}</span> <span class="token punctuation">{</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token punctuation">}</span>  <span class="token operator">/</span><span class="token operator">&gt;</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>优点：低耦合、类和函数通用、完全隔离业务组件、可嵌套</p> <p>缺点：无法获取原始组件的状态，需要通过ref；无法直接继承静态属性，需要配合forwardRef转发ref</p> <h3 id="反向继承"><a href="#反向继承" class="header-anchor">#</a> 反向继承</h3> <p>包装的组件继承了原始组件</p> <p>优点：方便获取内部状态、继承静态属性</p> <p>缺点：函数组件不能使用、耦合度高</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> div<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token constant">HOC</span><span class="token punctuation">(</span><span class="token parameter">component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">wrapperComponent</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token constant">HOC</span><span class="token punctuation">(</span>Index<span class="token punctuation">)</span>
</code></pre></div><h2 id="高阶组件如何编写"><a href="#高阶组件如何编写" class="header-anchor">#</a> 高阶组件如何编写</h2> <h3 id="_1-强化props"><a href="#_1-强化props" class="header-anchor">#</a> 1.强化props</h3> <p>例如react router提供的withRouter的HOC</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">withRouter</span><span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> displayName <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">withRouter(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Component<span class="token punctuation">.</span>displayName <span class="token operator">||</span> Component<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">C</span> <span class="token operator">=</span> <span class="token parameter">props</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> wrappedComponentRef<span class="token punctuation">,</span> <span class="token operator">...</span>remainingProps <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>RouterContext<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token parameter">context</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">(</span>
           <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span>remainingProps<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>context<span class="token punctuation">}</span> ref<span class="token operator">=</span><span class="token punctuation">{</span>wrappedComponentRef<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
         <span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>RouterContext<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span> 
  <span class="token punctuation">}</span>

  <span class="token constant">C</span><span class="token punctuation">.</span>displayName <span class="token operator">=</span> displayName<span class="token punctuation">;</span>
  <span class="token constant">C</span><span class="token punctuation">.</span>wrapperdComponent <span class="token operator">=</span> Component<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">hoistStatics</span><span class="token punctuation">(</span><span class="token constant">C</span><span class="token punctuation">,</span> Component<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_2-控制渲染"><a href="#_2-控制渲染" class="header-anchor">#</a> 2.控制渲染</h3> <p>HOC反向继承，强化组件继承原始组件，通过super.render获取render内容，做渲染劫持</p> <h4 id="渲染劫持"><a href="#渲染劫持" class="header-anchor">#</a> 渲染劫持</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">HOC</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">WrapComponent</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">WrapComponent</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>visible<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> div <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="修改渲染树"><a href="#修改渲染树" class="header-anchor">#</a> 修改渲染树</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
       <span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>react<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>vue<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>Angular<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
       <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token constant">HOC</span> <span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">Advance</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 获取render内容</span>

      <span class="token keyword">const</span> otherProps <span class="token operator">=</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span><span class="token string">'alien'</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> appendElement <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span> <span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">hello ,world , my name  is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> otherProps<span class="token punctuation">.</span>name <span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">)</span>

      <span class="token comment">/* 替换 Angular 元素节点 */</span>
      <span class="token keyword">const</span> newchild <span class="token operator">=</span> React<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">child<span class="token punctuation">,</span>index</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
           <span class="token keyword">if</span><span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">return</span> appendElement
           <span class="token keyword">return</span>  child
      <span class="token punctuation">}</span><span class="token punctuation">)</span> 

      <span class="token keyword">return</span>  React<span class="token punctuation">.</span><span class="token function">cloneElement</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> element<span class="token punctuation">.</span>props<span class="token punctuation">,</span> newchild<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span>  <span class="token keyword">default</span> <span class="token constant">HOC</span><span class="token punctuation">(</span>Index<span class="token punctuation">)</span>
</code></pre></div><h3 id="动态加载"><a href="#动态加载" class="header-anchor">#</a> 动态加载</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">AsyncRouter</span><span class="token punctuation">(</span><span class="token parameter">loadRouter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">Content</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    state <span class="token operator">=</span> <span class="token punctuation">{</span>Component<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span>
    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>Component<span class="token punctuation">)</span> <span class="token keyword">return</span>
      <span class="token function">loadRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">module</span> <span class="token operator">=&gt;</span> module<span class="token punctuation">.</span>default<span class="token punctuation">)</span> <span class="token comment">// 动态加载 component 组件</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">Component</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>Component<span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span>Component<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
      <span class="token keyword">return</span> Component <span class="token operator">?</span> <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span>
      <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props
      <span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token operator">:</span> <span class="token operator">&lt;</span>Loading <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> Index <span class="token operator">=</span> <span class="token function">AsyncRouter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../pages/index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><p>实现思路：</p> <ul><li>Index 组件中，在 componentDidMount 生命周期，动态加载上述的路由组件Component</li> <li>如果在切换路由或者没有加载完毕时，显示的是 Loading 效果</li></ul> <h3 id="_3-组件赋能"><a href="#_3-组件赋能" class="header-anchor">#</a> 3.组件赋能</h3> <h4 id="ref获取实例"><a href="#ref获取实例" class="header-anchor">#</a> ref获取实例</h4> <p>属性代理不能直接获取原始组件的状态，可以通过 ref 获取组件实例。但是注意的是：类组件才存在实例，函数组件不存在实例。</p> <h4 id="事件监控"><a href="#事件监控" class="header-anchor">#</a> 事件监控</h4> <p>HOC 不一定非要对组件本身做些什么，也可以单纯增加一些事件监听，错误监控</p> <h3 id="_4-总结"><a href="#_4-总结" class="header-anchor">#</a> 4 总结</h3> <ul><li>1 强化 props ，通过 HOC 向原始组件混入新props</li> <li>2 渲染劫持，利用 HOC 动态挂载原始组件，还可以先获取原始组件的渲染树，进行可控性修改。</li> <li>3 可以配合 import 等 api ，实现动态加载组件，实现代码分割，加入 loading 效果。</li> <li>4 可以通过 ref 来获取原始组件实例，操作实例下的属性和方法。</li> <li>5 可以对原始组件做一些事件监听，错误监控等</li></ul> <h2 id="高阶组件注意事项"><a href="#高阶组件注意事项" class="header-anchor">#</a> 高阶组件注意事项</h2> <h3 id="谨慎修改原型链"><a href="#谨慎修改原型链" class="header-anchor">#</a> 谨慎修改原型链</h3> <h3 id="不要在函数组件内部或类组件render中使用hoc"><a href="#不要在函数组件内部或类组件render中使用hoc" class="header-anchor">#</a> 不要在函数组件内部或类组件render中使用hoc</h3> <p>每一次类组件触发 render 都会产生一个新的WrapHome，<code>react diff</code> 会判定两次不是同一个组件，那么就会卸载老组件，重新挂载新组件</p> <p>老组件内部的真实 DOM 节点都不会合理的复用，从而造成了性能的浪费，而且原始组件会被初始化多次。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token keyword">const</span> WrapHome <span class="token operator">=</span> <span class="token constant">HOC</span><span class="token punctuation">(</span>Home<span class="token punctuation">)</span>
     <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrapHome <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="ref的处理"><a href="#ref的处理" class="header-anchor">#</a> ref的处理</h3> <p>高阶组件的约定是将所有 props 传递给被包装组件，但这对于 ref 并不适用。那是因为 ref 实际上并不是一个 prop ， 就像 key 一样，对于 ref 属性它是由 React 专门处理的</p> <p>可以用 <code>forwardRef</code>做 ref 的转发处理</p> <h3 id="hoc嵌套问题"><a href="#hoc嵌套问题" class="header-anchor">#</a> hoc嵌套问题</h3> <p><strong>要注意一下包装顺序，越靠近 <code>Index</code> 组件的，就是越内层的 HOC ,离组件 <code>Index</code> 也就越近。</strong></p> <h3 id="继承静态属性"><a href="#继承静态属性" class="header-anchor">#</a> 继承静态属性</h3> <p>在属性代理 HOC 本质返回新的 component ，会丢失静态属性方法</p> <p><strong>引入第三方库</strong>解决</p> <h2 id="进阶实践-权限拦截"><a href="#进阶实践-权限拦截" class="header-anchor">#</a> 进阶实践 权限拦截</h2> <p>思路：</p> <ul><li>1 需要权限的页面或者组件，用 HOC 包裹，并输入唯一的权限签名。</li> <li>2 用 Context 上下文保存全局的权限菜单列表，用 Provider 注入异步获取到的权限菜单。</li> <li>3 HOC 中用 Consumer 获取权限列表，并且和签名做匹配，如果有权限，就展示，如果没有权限，展示默认没有权限组件。</li></ul> <h3 id="根部注入权限"><a href="#根部注入权限" class="header-anchor">#</a> 根部注入权限</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> Permission <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>rootPermission<span class="token punctuation">,</span> setRootPermission<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">getRootPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      cosnt <span class="token punctuation">{</span> code<span class="token punctuation">,</span> data<span class="token punctuation">}</span> <span class="token operator">=</span> res <span class="token keyword">as</span> any
      code <span class="token operator">===</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> <span class="token function">setRootPermission</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token operator">&lt;</span>Permission<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span>rootPermission<span class="token punctuation">}</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>RootRouter<span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Permission<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="hoc"><a href="#hoc" class="header-anchor">#</a> HOC</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">NoPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">PermissionHoc</span><span class="token punctuation">(</span><span class="token parameter">authorization</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">Home</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token function-variable function">matchPermission</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> list</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> list<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>permisison<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>
        <span class="token punctuation">(</span><span class="token parameter">permissionList</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">matchPermission</span><span class="token punctuation">(</span>authorization<span class="token punctuation">,</span> permissionList<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token operator">:</span> <span class="token operator">&lt;</span>NoPermission <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>permisison<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="绑定权限"><a href="#绑定权限" class="header-anchor">#</a> 绑定权限</h3> <div class="language-js extra-class"><pre class="language-js"><code>@<span class="token function">PermissionHoc</span><span class="token punctuation">(</span><span class="token string">'writeDoc'</span><span class="token punctuation">)</span>  <span class="token comment">// 绑定文档录入页面</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">PermissionHoc</span><span class="token punctuation">(</span><span class="token string">'writeTag'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token comment">//绑定标签录入页面</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">PermissionHoc</span><span class="token punctuation">(</span><span class="token string">'tagList'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token comment">//绑定标签列表页面</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">PermissionHoc</span><span class="token punctuation">(</span><span class="token string">'docList'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Index<span class="token punctuation">)</span> <span class="token comment">// 绑定文档列表页面</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/react/react进阶实践指南/原理篇2.html" class="prev">
        context原理
      </a></span> <span class="next"><a href="/react/react进阶实践指南/实践篇.html">
        实现mini-router
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b51e4ccd.js" defer></script><script src="/assets/js/2.7229199a.js" defer></script><script src="/assets/js/58.acb475d1.js" defer></script>
  </body>
</html>
