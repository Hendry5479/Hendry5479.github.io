<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>渲染控制 | 英俊的大亨亨</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="heng.png">
    <meta name="description" content="记录下有趣岁月的点点滴滴">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.b51e4ccd.js" as="script"><link rel="preload" href="/assets/js/2.7229199a.js" as="script"><link rel="preload" href="/assets/js/55.5809711e.js" as="script"><link rel="prefetch" href="/assets/js/10.00f8a9d8.js"><link rel="prefetch" href="/assets/js/100.78dfd44a.js"><link rel="prefetch" href="/assets/js/101.cdae98a0.js"><link rel="prefetch" href="/assets/js/102.6a3dd9e0.js"><link rel="prefetch" href="/assets/js/103.cfed07a2.js"><link rel="prefetch" href="/assets/js/104.a16a4843.js"><link rel="prefetch" href="/assets/js/105.9cd1add0.js"><link rel="prefetch" href="/assets/js/106.546c1ad8.js"><link rel="prefetch" href="/assets/js/107.04b38bf9.js"><link rel="prefetch" href="/assets/js/108.31a22b61.js"><link rel="prefetch" href="/assets/js/109.1f2a1840.js"><link rel="prefetch" href="/assets/js/11.e2689dc6.js"><link rel="prefetch" href="/assets/js/110.9dc2f13b.js"><link rel="prefetch" href="/assets/js/111.35cf70f8.js"><link rel="prefetch" href="/assets/js/112.39a6579b.js"><link rel="prefetch" href="/assets/js/113.cbfc279d.js"><link rel="prefetch" href="/assets/js/114.878470a2.js"><link rel="prefetch" href="/assets/js/115.86dc4d8e.js"><link rel="prefetch" href="/assets/js/116.d2e05b2c.js"><link rel="prefetch" href="/assets/js/117.7525671d.js"><link rel="prefetch" href="/assets/js/118.a5c04c6d.js"><link rel="prefetch" href="/assets/js/119.613a81e1.js"><link rel="prefetch" href="/assets/js/12.0b7aaea4.js"><link rel="prefetch" href="/assets/js/120.ec6d3159.js"><link rel="prefetch" href="/assets/js/121.6705f783.js"><link rel="prefetch" href="/assets/js/122.7b3fe034.js"><link rel="prefetch" href="/assets/js/123.9336f454.js"><link rel="prefetch" href="/assets/js/124.dca9fc87.js"><link rel="prefetch" href="/assets/js/125.338aa4d8.js"><link rel="prefetch" href="/assets/js/126.a731a9eb.js"><link rel="prefetch" href="/assets/js/127.da74dd90.js"><link rel="prefetch" href="/assets/js/128.3d5e86f2.js"><link rel="prefetch" href="/assets/js/129.ee43b65c.js"><link rel="prefetch" href="/assets/js/13.31064a46.js"><link rel="prefetch" href="/assets/js/130.8a273d75.js"><link rel="prefetch" href="/assets/js/131.a89df4ac.js"><link rel="prefetch" href="/assets/js/132.0daac28c.js"><link rel="prefetch" href="/assets/js/133.b1f23c92.js"><link rel="prefetch" href="/assets/js/134.78621a9c.js"><link rel="prefetch" href="/assets/js/135.f0884a8b.js"><link rel="prefetch" href="/assets/js/136.45114430.js"><link rel="prefetch" href="/assets/js/137.eb295fce.js"><link rel="prefetch" href="/assets/js/138.cc7dc8d3.js"><link rel="prefetch" href="/assets/js/139.c9b1aad6.js"><link rel="prefetch" href="/assets/js/14.0be4ee49.js"><link rel="prefetch" href="/assets/js/15.685fab30.js"><link rel="prefetch" href="/assets/js/16.97f8b16a.js"><link rel="prefetch" href="/assets/js/17.9c7bebeb.js"><link rel="prefetch" href="/assets/js/18.965d9e47.js"><link rel="prefetch" href="/assets/js/19.3d59a8e1.js"><link rel="prefetch" href="/assets/js/20.1573d510.js"><link rel="prefetch" href="/assets/js/21.f46234dd.js"><link rel="prefetch" href="/assets/js/22.6c16fd38.js"><link rel="prefetch" href="/assets/js/23.50a2a38a.js"><link rel="prefetch" href="/assets/js/24.8aff8273.js"><link rel="prefetch" href="/assets/js/25.35a7c496.js"><link rel="prefetch" href="/assets/js/26.af233874.js"><link rel="prefetch" href="/assets/js/27.a3a96a5a.js"><link rel="prefetch" href="/assets/js/28.a1d49602.js"><link rel="prefetch" href="/assets/js/29.174b7d7d.js"><link rel="prefetch" href="/assets/js/3.6038f64c.js"><link rel="prefetch" href="/assets/js/30.a4115d32.js"><link rel="prefetch" href="/assets/js/31.1522875a.js"><link rel="prefetch" href="/assets/js/32.35da527d.js"><link rel="prefetch" href="/assets/js/33.814d63e8.js"><link rel="prefetch" href="/assets/js/34.615b49c1.js"><link rel="prefetch" href="/assets/js/35.856ab789.js"><link rel="prefetch" href="/assets/js/36.2987bc62.js"><link rel="prefetch" href="/assets/js/37.084d12aa.js"><link rel="prefetch" href="/assets/js/38.088f3091.js"><link rel="prefetch" href="/assets/js/39.4ea066d5.js"><link rel="prefetch" href="/assets/js/4.c610d016.js"><link rel="prefetch" href="/assets/js/40.97850ba9.js"><link rel="prefetch" href="/assets/js/41.8b8ae086.js"><link rel="prefetch" href="/assets/js/42.8ae2cac3.js"><link rel="prefetch" href="/assets/js/43.f8a28187.js"><link rel="prefetch" href="/assets/js/44.5160f68a.js"><link rel="prefetch" href="/assets/js/45.6d4b7130.js"><link rel="prefetch" href="/assets/js/46.44693348.js"><link rel="prefetch" href="/assets/js/47.eb0ac18a.js"><link rel="prefetch" href="/assets/js/48.ce1c6335.js"><link rel="prefetch" href="/assets/js/49.7ec1b16a.js"><link rel="prefetch" href="/assets/js/5.216dfe20.js"><link rel="prefetch" href="/assets/js/50.1f503aa4.js"><link rel="prefetch" href="/assets/js/51.47971163.js"><link rel="prefetch" href="/assets/js/52.e5f681d7.js"><link rel="prefetch" href="/assets/js/53.df89fbb7.js"><link rel="prefetch" href="/assets/js/54.a140a8dd.js"><link rel="prefetch" href="/assets/js/56.3a62759d.js"><link rel="prefetch" href="/assets/js/57.c9bd4339.js"><link rel="prefetch" href="/assets/js/58.acb475d1.js"><link rel="prefetch" href="/assets/js/59.61cf3322.js"><link rel="prefetch" href="/assets/js/6.73a8f323.js"><link rel="prefetch" href="/assets/js/60.aa39146e.js"><link rel="prefetch" href="/assets/js/61.f62972b8.js"><link rel="prefetch" href="/assets/js/62.79fc1ddc.js"><link rel="prefetch" href="/assets/js/63.808c750c.js"><link rel="prefetch" href="/assets/js/64.4e99e2e1.js"><link rel="prefetch" href="/assets/js/65.f112caec.js"><link rel="prefetch" href="/assets/js/66.422cc6c9.js"><link rel="prefetch" href="/assets/js/67.f504a803.js"><link rel="prefetch" href="/assets/js/68.f8e84a65.js"><link rel="prefetch" href="/assets/js/69.af07ae00.js"><link rel="prefetch" href="/assets/js/7.a6e60d89.js"><link rel="prefetch" href="/assets/js/70.9b212396.js"><link rel="prefetch" href="/assets/js/71.049b7d3e.js"><link rel="prefetch" href="/assets/js/72.b508f834.js"><link rel="prefetch" href="/assets/js/73.52a25a21.js"><link rel="prefetch" href="/assets/js/74.68de4c01.js"><link rel="prefetch" href="/assets/js/75.c0d8e99a.js"><link rel="prefetch" href="/assets/js/76.672b246e.js"><link rel="prefetch" href="/assets/js/77.36d886e3.js"><link rel="prefetch" href="/assets/js/78.079ebfd8.js"><link rel="prefetch" href="/assets/js/79.d3d3e8ea.js"><link rel="prefetch" href="/assets/js/8.a72c567f.js"><link rel="prefetch" href="/assets/js/80.c690c3d9.js"><link rel="prefetch" href="/assets/js/81.c012b7d5.js"><link rel="prefetch" href="/assets/js/82.47ffa460.js"><link rel="prefetch" href="/assets/js/83.2ba84114.js"><link rel="prefetch" href="/assets/js/84.dc0bf5a8.js"><link rel="prefetch" href="/assets/js/85.d968ae8b.js"><link rel="prefetch" href="/assets/js/86.91000a3b.js"><link rel="prefetch" href="/assets/js/87.6e885c71.js"><link rel="prefetch" href="/assets/js/88.99dd2b79.js"><link rel="prefetch" href="/assets/js/89.601c57ea.js"><link rel="prefetch" href="/assets/js/9.c59ba06b.js"><link rel="prefetch" href="/assets/js/90.89ee0da5.js"><link rel="prefetch" href="/assets/js/91.854de449.js"><link rel="prefetch" href="/assets/js/92.7a25d006.js"><link rel="prefetch" href="/assets/js/93.17f89281.js"><link rel="prefetch" href="/assets/js/94.0f6749b9.js"><link rel="prefetch" href="/assets/js/95.41ef6f4a.js"><link rel="prefetch" href="/assets/js/96.12427920.js"><link rel="prefetch" href="/assets/js/97.53036963.js"><link rel="prefetch" href="/assets/js/98.43d8f870.js"><link rel="prefetch" href="/assets/js/99.4ab32fce.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/heng.png" alt="英俊的大亨亨" class="logo"> <span class="site-name can-hide">英俊的大亨亨</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">js</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">js</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/js/js-基础.html" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/js/js-数组.html" class="nav-link">
  数组
</a></li><li class="dropdown-item"><!----> <a href="/js/js-异步.html" class="nav-link">
  异步
</a></li><li class="dropdown-item"><!----> <a href="/js/js-es6.html" class="nav-link">
  es6
</a></li><li class="dropdown-item"><!----> <a href="/js/js-v8引擎.html" class="nav-link">
  v8
</a></li><li class="dropdown-item"><!----> <a href="/手写代码/1.js基础.html" class="nav-link">
  手写
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/react/process.html" class="nav-link">
  
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/html.html" class="nav-link">
  html
</a></li><li class="dropdown-item"><!----> <a href="/css.html" class="nav-link">
  css
</a></li><li class="dropdown-item"><!----> <a href="/node.html" class="nav-link">
  node
</a></li><li class="dropdown-item"><!----> <a href="/webpack.html" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/webpack.html" class="nav-link">
  小程序
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="leetcode" class="dropdown-title"><span class="title">leetcode</span> <span class="arrow down"></span></button> <button type="button" aria-label="leetcode" class="mobile-dropdown-title"><span class="title">leetcode</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/代码随想录/1.数组.html" class="nav-link">
  1.数组
</a></li><li class="dropdown-item"><!----> <a href="/代码随想录/10.动态规划/1.基础.html" class="nav-link">
  10.动态规划
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">react源码</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">react源码</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react源码/理念.html" class="nav-link">
  1.理念
</a></li><li class="dropdown-item"><!----> <a href="/react源码/3.render.html" class="nav-link">
  3.render
</a></li><li class="dropdown-item"><!----> <a href="/react源码/4.commit.html" class="nav-link">
  4.commit
</a></li><li class="dropdown-item"><!----> <a href="/react源码/5.状态更新.html" class="nav-link">
  5.状态更新
</a></li><li class="dropdown-item"><!----> <a href="/react源码/6.diff.html" class="nav-link">
  6.diff
</a></li><li class="dropdown-item"><!----> <a href="/react/7.实现hooks.html" class="nav-link">
  7.实现hooks
</a></li><li class="dropdown-item"><!----> <a href="/react/8.concurrentMode.html" class="nav-link">
  8.concurrentMode
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">webpack</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">webpack</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/webpack/1.配置.html" class="nav-link">
  1.配置
</a></li><li class="dropdown-item"><!----> <a href="/webpack/2.loader.html" class="nav-link">
  2.loader
</a></li><li class="dropdown-item"><!----> <a href="/webpack/3.plugin.html" class="nav-link">
  3.plugin
</a></li><li class="dropdown-item"><!----> <a href="/webpack/4.模块化原理.html" class="nav-link">
  4.模块化原理
</a></li><li class="dropdown-item"><!----> <a href="/webpack/5.babel.html" class="nav-link">
  5.babel
</a></li><li class="dropdown-item"><!----> <a href="/webpack/6.HMR.html" class="nav-link">
  6.HMR
</a></li><li class="dropdown-item"><!----> <a href="/webpack/7.环境分离.html" class="nav-link">
  7.环境分离
</a></li><li class="dropdown-item"><!----> <a href="/webpack/8.tree_shaking.html" class="nav-link">
  8.tree_shaking
</a></li><li class="dropdown-item"><!----> <a href="/webpack/9,源码.html" class="nav-link">
  9.源码
</a></li><li class="dropdown-item"><!----> <a href="/webpack/11.自定义loader.html" class="nav-link">
  11.自定义loader
</a></li><li class="dropdown-item"><!----> <a href="/webpack/12.自定义plugin.html" class="nav-link">
  12.自定义plugin
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">前端设计模式</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">前端设计模式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/设计模式/创建型.html" class="nav-link">
  创建型
</a></li><li class="dropdown-item"><!----> <a href="/设计模式/结构型.html" class="nav-link">
  结构型
</a></li><li class="dropdown-item"><!----> <a href="/设计模式/行为型.html" class="nav-link">
  行为型
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">angular</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">angular</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react/react%E8%BF%9B%E9%98%B6%E5%AE%9E%E8%B7%B5%E6%8C%87%E5%8D%97/.html" class="nav-link">
  angular性能调优
</a></li><li class="dropdown-item"><!----> <a href="/设计模式/结构型.html" class="nav-link">
  angular源码理解
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">健身</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">健身</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react/react%E8%BF%9B%E9%98%B6%E5%AE%9E%E8%B7%B5%E6%8C%87%E5%8D%97/.html" class="nav-link">
  angular性能调优
</a></li><li class="dropdown-item"><!----> <a href="/设计模式/结构型.html" class="nav-link">
  angular源码理解
</a></li></ul></div></div><div class="nav-item"><a href="/me.html" class="nav-link">
  关于我
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">js</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">js</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/js/js-基础.html" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/js/js-数组.html" class="nav-link">
  数组
</a></li><li class="dropdown-item"><!----> <a href="/js/js-异步.html" class="nav-link">
  异步
</a></li><li class="dropdown-item"><!----> <a href="/js/js-es6.html" class="nav-link">
  es6
</a></li><li class="dropdown-item"><!----> <a href="/js/js-v8引擎.html" class="nav-link">
  v8
</a></li><li class="dropdown-item"><!----> <a href="/手写代码/1.js基础.html" class="nav-link">
  手写
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/react/process.html" class="nav-link">
  
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/html.html" class="nav-link">
  html
</a></li><li class="dropdown-item"><!----> <a href="/css.html" class="nav-link">
  css
</a></li><li class="dropdown-item"><!----> <a href="/node.html" class="nav-link">
  node
</a></li><li class="dropdown-item"><!----> <a href="/webpack.html" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/webpack.html" class="nav-link">
  小程序
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="leetcode" class="dropdown-title"><span class="title">leetcode</span> <span class="arrow down"></span></button> <button type="button" aria-label="leetcode" class="mobile-dropdown-title"><span class="title">leetcode</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/代码随想录/1.数组.html" class="nav-link">
  1.数组
</a></li><li class="dropdown-item"><!----> <a href="/代码随想录/10.动态规划/1.基础.html" class="nav-link">
  10.动态规划
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">react源码</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">react源码</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react源码/理念.html" class="nav-link">
  1.理念
</a></li><li class="dropdown-item"><!----> <a href="/react源码/3.render.html" class="nav-link">
  3.render
</a></li><li class="dropdown-item"><!----> <a href="/react源码/4.commit.html" class="nav-link">
  4.commit
</a></li><li class="dropdown-item"><!----> <a href="/react源码/5.状态更新.html" class="nav-link">
  5.状态更新
</a></li><li class="dropdown-item"><!----> <a href="/react源码/6.diff.html" class="nav-link">
  6.diff
</a></li><li class="dropdown-item"><!----> <a href="/react/7.实现hooks.html" class="nav-link">
  7.实现hooks
</a></li><li class="dropdown-item"><!----> <a href="/react/8.concurrentMode.html" class="nav-link">
  8.concurrentMode
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">webpack</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">webpack</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/webpack/1.配置.html" class="nav-link">
  1.配置
</a></li><li class="dropdown-item"><!----> <a href="/webpack/2.loader.html" class="nav-link">
  2.loader
</a></li><li class="dropdown-item"><!----> <a href="/webpack/3.plugin.html" class="nav-link">
  3.plugin
</a></li><li class="dropdown-item"><!----> <a href="/webpack/4.模块化原理.html" class="nav-link">
  4.模块化原理
</a></li><li class="dropdown-item"><!----> <a href="/webpack/5.babel.html" class="nav-link">
  5.babel
</a></li><li class="dropdown-item"><!----> <a href="/webpack/6.HMR.html" class="nav-link">
  6.HMR
</a></li><li class="dropdown-item"><!----> <a href="/webpack/7.环境分离.html" class="nav-link">
  7.环境分离
</a></li><li class="dropdown-item"><!----> <a href="/webpack/8.tree_shaking.html" class="nav-link">
  8.tree_shaking
</a></li><li class="dropdown-item"><!----> <a href="/webpack/9,源码.html" class="nav-link">
  9.源码
</a></li><li class="dropdown-item"><!----> <a href="/webpack/11.自定义loader.html" class="nav-link">
  11.自定义loader
</a></li><li class="dropdown-item"><!----> <a href="/webpack/12.自定义plugin.html" class="nav-link">
  12.自定义plugin
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">前端设计模式</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">前端设计模式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/设计模式/创建型.html" class="nav-link">
  创建型
</a></li><li class="dropdown-item"><!----> <a href="/设计模式/结构型.html" class="nav-link">
  结构型
</a></li><li class="dropdown-item"><!----> <a href="/设计模式/行为型.html" class="nav-link">
  行为型
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">angular</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">angular</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react/react%E8%BF%9B%E9%98%B6%E5%AE%9E%E8%B7%B5%E6%8C%87%E5%8D%97/.html" class="nav-link">
  angular性能调优
</a></li><li class="dropdown-item"><!----> <a href="/设计模式/结构型.html" class="nav-link">
  angular源码理解
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">健身</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">健身</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react/react%E8%BF%9B%E9%98%B6%E5%AE%9E%E8%B7%B5%E6%8C%87%E5%8D%97/.html" class="nav-link">
  angular性能调优
</a></li><li class="dropdown-item"><!----> <a href="/设计模式/结构型.html" class="nav-link">
  angular源码理解
</a></li></ul></div></div><div class="nav-item"><a href="/me.html" class="nav-link">
  关于我
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>react进阶实践指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/react/react进阶实践指南/fiber.html" class="sidebar-link">fiber保存的信息</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/react/react进阶实践指南/v18.html" class="sidebar-link">transition</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/v18.html#意义" class="sidebar-link">意义</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/v18.html#starttransition" class="sidebar-link">startTransition</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/v18.html#usetransition" class="sidebar-link">useTransition</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/v18.html#usedeferredvalue" class="sidebar-link">useDeferredValue</a></li></ul></li><li><a href="/react/react进阶实践指南/优化篇.html" class="active sidebar-link">渲染控制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/优化篇.html#渲染的理解" class="sidebar-link">渲染的理解</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/优化篇.html#控制render" class="sidebar-link">控制render</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/优化篇.html#对render的思考" class="sidebar-link">对render的思考</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/优化篇.html#二-懒加载和异步渲染" class="sidebar-link">二 懒加载和异步渲染</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/优化篇.html#三-渲染错误边界" class="sidebar-link">三 渲染错误边界</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/优化篇.html#四-从diff-children看key的合理使用" class="sidebar-link">四 从diff children看key的合理使用</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/优化篇.html#时间分片" class="sidebar-link">时间分片</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/优化篇.html#虚拟列表" class="sidebar-link">虚拟列表</a></li></ul></li><li><a href="/react/react进阶实践指南/原理篇.html" class="sidebar-link">事件原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#独特的事件处理" class="sidebar-link">独特的事件处理</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#事件合成" class="sidebar-link">事件合成</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#事件绑定" class="sidebar-link">事件绑定</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#事件触发" class="sidebar-link">事件触发</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#异步调度" class="sidebar-link">异步调度</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#异步调度原理" class="sidebar-link">异步调度原理</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#背景" class="sidebar-link">背景</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#二-fiber认识" class="sidebar-link">二 fiber认识</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#三-fiber更新机制" class="sidebar-link">三 fiber更新机制</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#四-两大阶段-render和commit" class="sidebar-link">四 两大阶段：render和commit</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#二-hooks与fiber-workinprogress" class="sidebar-link">二 hooks与fiber（workInProgress）</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#三-状态派发" class="sidebar-link">三 状态派发</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#四-处理副作用" class="sidebar-link">四 处理副作用</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#五-状态获取与状态缓存" class="sidebar-link">五 状态获取与状态缓存</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/原理篇.html#六-总结" class="sidebar-link">六 总结</a></li></ul></li><li><a href="/react/react进阶实践指南/原理篇2.html" class="sidebar-link">context原理</a></li><li><a href="/react/react进阶实践指南/基础篇.html" class="sidebar-link">jsx</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#一、常用元素被react处理成什么" class="sidebar-link">一、常用元素被React处理成什么</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#二、可控性render" class="sidebar-link">二、可控性render</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#三、babel解析jsx" class="sidebar-link">三、Babel解析JSX</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#二、函数组件" class="sidebar-link">二、函数组件</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#三、5种组件通信方式" class="sidebar-link">三、5种组件通信方式</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#四、组件强化" class="sidebar-link">四、组件强化</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#一、类组件setstate" class="sidebar-link">一、类组件setState</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#二、函数组件的usestate" class="sidebar-link">二、函数组件的useState</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#一、监听props" class="sidebar-link">一、监听props</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#二、props-children模式" class="sidebar-link">二、props + children模式</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#三、操作props" class="sidebar-link">三、操作props</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#类组件生命周期" class="sidebar-link">类组件生命周期</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#各个生命周期能做些什么" class="sidebar-link">各个生命周期能做些什么</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#函数组件生命周期替代方案" class="sidebar-link">函数组件生命周期替代方案</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#ref的基本概念和使用" class="sidebar-link">ref的基本概念和使用</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#ref原理" class="sidebar-link">ref原理</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#基本使用" class="sidebar-link">基本使用</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#高阶组件类型" class="sidebar-link">高阶组件类型</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#高阶组件如何编写" class="sidebar-link">高阶组件如何编写</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#高阶组件注意事项" class="sidebar-link">高阶组件注意事项</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/基础篇.html#进阶实践-权限拦截" class="sidebar-link">进阶实践 权限拦截</a></li></ul></li><li><a href="/react/react进阶实践指南/实践篇.html" class="sidebar-link">实现mini-router</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/实践篇.html#二-设计思路" class="sidebar-link">二 设计思路</a></li></ul></li><li><a href="/react/react进阶实践指南/源码目录.html" class="sidebar-link">/react/react进阶实践指南/源码目录.html</a></li><li><a href="/react/react进阶实践指南/生态篇.html" class="sidebar-link">react-router</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/生态篇.html#一-前言" class="sidebar-link">一 前言</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/生态篇.html#二-路由原理" class="sidebar-link">二 路由原理</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/生态篇.html#三-react-router-基本构成" class="sidebar-link">三 React-Router 基本构成</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/生态篇.html#四-路由使用指南" class="sidebar-link">四 路由使用指南</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/生态篇.html#五-实践一权限路由封装" class="sidebar-link">五 实践一权限路由封装</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/生态篇.html#一-前言-2" class="sidebar-link">一 前言</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/生态篇.html#二-react-redux用法" class="sidebar-link">二 React-Redux用法</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/生态篇.html#三-react-redux原理" class="sidebar-link">三 React-Redux原理</a></li><li class="sidebar-sub-header"><a href="/react/react进阶实践指南/生态篇.html#四-实现异步" class="sidebar-link">四 实现异步</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="渲染控制"><a href="#渲染控制" class="header-anchor">#</a> 渲染控制</h1> <h2 id="渲染的理解"><a href="#渲染的理解" class="header-anchor">#</a> 渲染的理解</h2> <p>事实上，从调度更新任务到调和 fiber，再到浏览器渲染真实 DOM，每一个环节都是渲染的一部分</p> <p>React 在底层已经处理了大部分优化细节，包括设立任务优先级、异步调度、diff算法、时间分片</p> <h3 id="render阶段的作用"><a href="#render阶段的作用" class="header-anchor">#</a> render阶段的作用</h3> <p>render函数：根据更新产生的新状态，生成新element，并替换。element产生新的props</p> <p>调和：react调和产生children，将子代element变成fiber；将props变成pendingProps，更新完毕。</p> <p>children是组件的话将重复操作</p> <h2 id="控制render"><a href="#控制render" class="header-anchor">#</a> 控制render</h2> <ul><li>父组件隔断子组件渲染，如 <strong>memo</strong>，<strong>缓存 element 对象</strong></li> <li>组件自身控制render ，比如：<strong>PureComponent</strong> ，<strong>shouldComponentUpdate</strong></li></ul> <h3 id="_1-usememo缓存react-element"><a href="#_1-usememo缓存react-element" class="header-anchor">#</a> 1.useMemo缓存React.element</h3> <p>使用场景：父组件 render ，子组件没有必要跟着父组件一起 render</p> <p>用 React.useMemo 缓存element</p> <p><strong>useMemo 用法：</strong></p> <p><code>const cacheSomething = useMemo(create,deps)</code></p> <p><code>{ useMemo(()=&gt; &lt;Children number={numberA} /&gt;, [ numberA ]) }</code></p> <p><strong>useMemo原理：</strong></p> <p>useMemo 会记录上一次执行 create 的返回值，保存在函数组件的 <strong>fiber</strong> 对象上</p> <p>只要组件不销毁，缓存值就一直存在，deps 改变就会重新执行 create</p> <p><strong>原理揭秘</strong></p> <p>render时createElement产生pendingProps，reconcile时对比pending props和old props，相同则不更新</p> <p>将element缓存了，props指向相同的内存空间，跳过更新</p> <h3 id="_2-purecomponent"><a href="#_2-purecomponent" class="header-anchor">#</a> 2.PureComponent</h3> <p>纯组件是一种发自组件本身的渲染优化策略，其渲染规则就是<strong>浅比较 state 和 props 是否相等</strong></p> <h4 id="purecomponent-原理及其浅比较原则"><a href="#purecomponent-原理及其浅比较原则" class="header-anchor">#</a> PureComponent 原理及其浅比较原则</h4> <p>PureComponent 继承的组件，原型链上会有 isPureReactComponent 属性</p> <p><code>react/src/ReactBaseClasses.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* pureComponentPrototype 纯组件构造函数的 prototype 对象，绑定isPureReactComponent 属性。 */</span>
pureComponentPrototype<span class="token punctuation">.</span>isPureReactComponent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre></div><p>这个属性在更新组件 <code>updateClassInstance</code> 方法中使用的</p> <p>在 <code>updateClassInstance</code> 有一个负责检查是否更新的函数 <code>checkShouldComponentUpdate</code></p> <blockquote><p>react/react-reconciler/ReactFiberClassComponent.js</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">checkShouldComponentUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> instance<span class="token punctuation">.</span>shouldComponentUpdate <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> instance<span class="token punctuation">.</span><span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span>newProps<span class="token punctuation">,</span>newState<span class="token punctuation">,</span>nextContext<span class="token punctuation">)</span>  <span class="token comment">/* shouldComponentUpdate 逻辑 */</span>
     <span class="token punctuation">}</span> 
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ctor<span class="token punctuation">.</span>prototype <span class="token operator">&amp;&amp;</span> ctor<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>isPureReactComponent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 若是纯函数，则浅比较props和state</span>
        <span class="token keyword">return</span>  <span class="token operator">!</span><span class="token function">shallowEqual</span><span class="token punctuation">(</span>oldProps<span class="token punctuation">,</span> newProps<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">shallowEqual</span><span class="token punctuation">(</span>oldState<span class="token punctuation">,</span> newState<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>shouldComponentUpdate 的权重，会大于 PureComponent</p> <p>shallowEqual：</p> <p>比较两个值是否相等</p> <p>如果有非obj或为null，返回false，更新</p> <p>通过Object.keys将key变成数组，判断长度，长度不相等，返回false，更新</p> <p>遍历，发现item不相等，返回false，更新</p> <h4 id="purecomponent注意事项"><a href="#purecomponent注意事项" class="header-anchor">#</a> PureComponent注意事项</h4> <h5 id="禁用箭头函数-否则纯组件失效。"><a href="#禁用箭头函数-否则纯组件失效。" class="header-anchor">#</a> 禁用箭头函数，否则纯组件失效。</h5> <p>因为父组件render时，箭头函数会重新定义。PureComponent会始终判断props不相等</p> <h5 id="父组件是函数组件时-绑定函数要用usecallback或者usememo"><a href="#父组件是函数组件时-绑定函数要用usecallback或者usememo" class="header-anchor">#</a> 父组件是函数组件时，绑定函数要用useCallback或者useMemo</h5> <p>函数组件每次执行都会声明新函数，纯组件会失效</p> <p>useCallback 首选，这个 hooks 初衷就是为了解决这种情况的</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> div
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> func <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>Child func<span class="token operator">=</span><span class="token punctuation">{</span>func<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>useCallback</code> 和 <code>useMemo</code> 有什么区别？</p> <p>useCallback的第一个参数是缓存的内容</p> <p>useMemo需要执行第一个函数，返回值才是缓存的内容。更像是缓存了一段逻辑的执行结果</p> <h3 id="_3-shouldcomponentupdate"><a href="#_3-shouldcomponentupdate" class="header-anchor">#</a> 3.shouldComponentUpdate</h3> <p>React提供的一种更灵活的自定义渲染方案</p> <p>shouldComponentUpdate 可以根据传入的新的 props 和 state ，或者 newContext 来确定是否更新组件</p> <h4 id="immutable-js"><a href="#immutable-js" class="header-anchor">#</a> immutable.js</h4> <p>但是如果有子组件的props是引用数据类型，且结构未知，如何解决新老属性对比问题？使用 <code>immutable.js</code></p> <p>对 Immutable 对象的任何修改或添加删除操作都会返回一个新的 Immutable 对象。通过对比Immutable证明状态是否改变</p> <h3 id="_4-react-memo"><a href="#_4-react-memo" class="header-anchor">#</a> 4.React.memo</h3> <p><code>React.memo(Component,compare)</code></p> <p>作为一种容器化的控制渲染方案，可以对比 props 变化来决定是否渲染组件</p> <p>memo特点</p> <ul><li>第一个参数 Component 原始组件本身，第二个参数 compare 是一个函数，返回 true 组件不渲染。</li> <li>当compare 不存在时，会用<strong>浅比较原则</strong>处理 props ，相当于仅比较 props 版本的 pureComponent</li> <li>memo 同样适合类组件和函数组件。</li></ul> <p>被 memo 包裹的组件，element 会被打成 <code>REACT_MEMO_TYPE</code> 类型的 element 标签</p> <p>在 element 变成 fiber 的时候， fiber 会被标记成 <strong>MemoComponent</strong> 的类型</p> <blockquote><p>react/src/ReactMemo.js</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span>compare</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> elementType <span class="token operator">=</span> <span class="token punctuation">{</span>
    $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token constant">REACT_MEMO_TYPE</span><span class="token punctuation">,</span> 
    type<span class="token punctuation">,</span>  <span class="token comment">// 我们的组件</span>
    compare<span class="token operator">:</span> compare <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> compare<span class="token punctuation">,</span>  <span class="token comment">//第二个参数，一个函数用于判断prop，控制更新方向。</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> elementType
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>react-reconciler/src/ReactFiber.js</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">case</span> <span class="token constant">REACT_MEMO_TYPE</span><span class="token operator">:</span>
  fiberTag <span class="token operator">=</span> MemoComponent<span class="token punctuation">;</span>
</code></pre></div><p>React 对 MemoComponent 类型的 fiber 有单独的更新处理逻辑 updateMemoComponent</p> <blockquote><p>react-reconciler/src/ReactFiberBeginWork.js</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">updateMemoComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>updateExpirationTime <span class="token operator">&lt;</span> renderExpirationTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">let</span> compare <span class="token operator">=</span> Component<span class="token punctuation">.</span>compare<span class="token punctuation">;</span>
         compare <span class="token operator">=</span> compare <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">?</span> compare <span class="token operator">:</span> shallowEqual <span class="token comment">//如果 memo 有第二个参数，则用二个参数判定，没有则浅比较props是否相等。</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compare</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">,</span> nextProps<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> current<span class="token punctuation">.</span>ref <span class="token operator">===</span> workInProgress<span class="token punctuation">.</span>ref<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">bailoutOnAlreadyFinishedWork</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span>workInProgress<span class="token punctuation">,</span>renderExpirationTime<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//已经完成工作，停止向下调和节点。</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 返回将要更新组件,memo包装的组件对应的fiber，继续向下调和更新。</span>
<span class="token punctuation">}</span>
</code></pre></div><p>memo 主要逻辑是</p> <ul><li>通过 memo 第二个参数，判断是否更新，如果没有第二个参数，以浅比较 props 为 diff 规则。如果相等，当前 fiber 完成工作，停止向下调和节点，被包裹的组件不更新。</li> <li>memo 可以理解为包了一层的高阶组件，它的阻断更新机制，是通过控制下一级 children ，也就是 memo 包装的组件，是否继续调和渲染，来达到目的</li> <li></li></ul> <h3 id="_5-打破渲染限制"><a href="#_5-打破渲染限制" class="header-anchor">#</a> 5.打破渲染限制</h3> <h4 id="_1-forceupdate"><a href="#_1-forceupdate" class="header-anchor">#</a> 1. forceupdate</h4> <p>类组件调用forceUpdate会跳过PureComponent和shouldComponentUpdate</p> <p>因为调用时会开启一个hasForceUpdate开关</p> <h4 id="_2-context穿透"><a href="#_2-context穿透" class="header-anchor">#</a> 2.context穿透</h4> <p>上述的方式都不能改变context改变带来的渲染穿透</p> <p>选择了消费context，就要承受context的改变带来的更新</p> <h3 id="_6-渲染控制流程图"><a href="#_6-渲染控制流程图" class="header-anchor">#</a> 6.渲染控制流程图</h3> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3df03000a39549bead3c84750c62576c~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp" alt="5.jpg"></p> <h2 id="对render的思考"><a href="#对render的思考" class="header-anchor">#</a> 对render的思考</h2> <h3 id="_1-无须过分在乎-react-没有必要的渲染"><a href="#_1-无须过分在乎-react-没有必要的渲染" class="header-anchor">#</a> 1.无须过分在乎 React 没有必要的渲染</h3> <p>js 代码远快于浏览器的 Rendering 和 Painting，更何况 React 还提供了 diff 算法等手段</p> <h3 id="_2-什么时候需要注意渲染节流"><a href="#_2-什么时候需要注意渲染节流" class="header-anchor">#</a> 2.什么时候需要注意渲染节流</h3> <ul><li>数据可视化的模块组件，更新伴随大量diff ，有必要采取 memo ，shouldComponentUpdate 等</li> <li>React 一般采用受控组件去管理表单数据层，表单数据层托管于 props 或是 state ，用户操作频繁，页面高频率 render</li> <li>越是靠近 app root 根组件越值得注意，根组件渲染会波及到整个组件树重新 render ，子组件 render ，一是浪费性能，二是可能执行 useEffect ，componentWillReceiveProps 等钩子，造成意想不到的情况发生</li></ul> <h3 id="_3-一些开发中的细节"><a href="#_3-一些开发中的细节" class="header-anchor">#</a> 3.一些开发中的细节</h3> <p>表单控件最好单独抽离，独自管理自己的数据层，这样可以让 state 改变，波及的范围更小</p> <p>更精致化渲染可以配合 immutable.js</p> <p>组件颗粒化，配合 memo 等 api ，可以制定私有化的渲染空间</p> <h1 id="渲染调优"><a href="#渲染调优" class="header-anchor">#</a> 渲染调优</h1> <h2 id="二-懒加载和异步渲染"><a href="#二-懒加载和异步渲染" class="header-anchor">#</a> 二 懒加载和异步渲染</h2> <h3 id="异步渲染"><a href="#异步渲染" class="header-anchor">#</a> 异步渲染</h3> <p>Suspense实现了异步请求结束后再进行组件的渲染，也就是所谓的异步渲染</p> <h4 id="suspense用法"><a href="#suspense用法" class="header-anchor">#</a> Suspense用法</h4> <p>Suspense 是组件，有一个 fallback 属性，用来代替当 Suspense 处于 loading 状态下渲染的内容</p> <p>Suspense 的 children 就是<strong>异步组件</strong>。多个异步组件可以用 Suspense 嵌套使用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">return</span> <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">{</span>loading div<span class="token punctuation">}</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>UserInfo<span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">&gt;</span>
</code></pre></div><p>当 UserInfo 处于数据加载状态下，展示 Suspense 中 fallback 的内容</p> <p>传统模式：挂载组件-&gt; 请求数据 -&gt; 再渲染组件
异步模式：请求数据-&gt; 渲染组件</p> <p>不需要在mount完成后再请求数据，也不会因为数据交互后改变state产生的二次更新作用</p> <h3 id="动态加载-懒加载"><a href="#动态加载-懒加载" class="header-anchor">#</a> 动态加载（懒加载）</h3> <p>Suspense 配合 React.lazy 可以实现动态加载功能</p> <p><strong>React.lazy</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> LazyComponent  <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./text'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>Suspence falback<span class="token operator">=</span><span class="token punctuation">{</span>div<span class="token punctuation">}</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>LazyComponent<span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Suspencse<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>函数需要调用import，必须返回一个Promise，且resolve一个default export 的组件</p> <p><strong>利于代码分割，不会让初始化的时候加载大量的文件</strong></p> <h4 id="react-lazy和suspense实现动态加载的原理"><a href="#react-lazy和suspense实现动态加载的原理" class="header-anchor">#</a> React.lazy和Suspense实现动态加载的原理</h4> <p>render 过程是同步执行的</p> <p>Suspense 下允许 <strong>render =&gt; 发现异步请求 =&gt; 悬停，等待异步请求完毕 =&gt; 再次渲染展示数据</strong></p> <h5 id="suspense"><a href="#suspense" class="header-anchor">#</a> Suspense</h5> <p>内部通过try catch捕捉异常，异常通常是一个promise，Suspense内部处理完promise之后会重新render，达到异步渲染效果</p> <h2 id="三-渲染错误边界"><a href="#三-渲染错误边界" class="header-anchor">#</a> 三 渲染错误边界</h2> <p>如果越靠近 APP 应用的根组件，渲染过程中出现问题造成的影响就越大，有可能直接造成白屏的情况</p> <p>为了防止渲染异常情况 React 增加了 <code>componentDidCatch</code> 和 <code>static getDerivedStateFromError()</code> 两个额外的生命周期，去挽救由于渲染阶段出现问题造成 UI 界面无法显示的情况</p> <h3 id="componentdidcatch"><a href="#componentdidcatch" class="header-anchor">#</a> componentDidCatch</h3> <p>componentDidCatch() 会在commit阶段被调用，因此允许执行副作用</p> <p>componentDidCatch 作用：</p> <ul><li>可以调用 setState 促使组件渲染，并做一些错误拦截功能。</li> <li>监控组件，发生错误，上报错误日志。</li></ul> <h3 id="static-getderivedstatefromerror"><a href="#static-getderivedstatefromerror" class="header-anchor">#</a> static getDerivedStateFromError</h3> <p>React更期望用 getDerivedStateFromError 代替 componentDidCatch 用于处理渲染异常</p> <h2 id="四-从diff-children看key的合理使用"><a href="#四-从diff-children看key的合理使用" class="header-anchor">#</a> 四 从diff children看key的合理使用</h2> <p>React 在一次更新中当发现通过 render 得到的 children 如果是一个数组的话。就会调用 reconcileChildrenArray 来调和子代 fiber ，整个对比的流程就是在这个函数中进行的</p> <h3 id="diff-children流程"><a href="#diff-children流程" class="header-anchor">#</a> diff children流程</h3> <p><strong>第一步：遍历新 children ，复用 oldFiber</strong></p> <blockquote><p>react-reconciler/src/ReactChildFiber.js</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">reconcileChildrenArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">/* 第一步  */</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> oldFiber <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> newIdx <span class="token operator">&lt;</span> newChildren<span class="token punctuation">.</span>length<span class="token punctuation">;</span> newIdx<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldFiber<span class="token punctuation">.</span>index <span class="token operator">&gt;</span> newIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            nextOldFiber <span class="token operator">=</span> oldFiber<span class="token punctuation">;</span>
            oldFiber <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            nextOldFiber <span class="token operator">=</span> oldFiber<span class="token punctuation">.</span>sibling<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">const</span> newFiber <span class="token operator">=</span> <span class="token function">updateSlot</span><span class="token punctuation">(</span>returnFiber<span class="token punctuation">,</span>oldFiber<span class="token punctuation">,</span>newChildren<span class="token punctuation">[</span>newIdx<span class="token punctuation">]</span><span class="token punctuation">,</span>expirationTime<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newFiber <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">break</span> <span class="token punctuation">}</span>
        <span class="token comment">// ..一些其他逻辑</span>
        <span class="token punctuation">}</span>  
        <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldTrackSideEffects<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// shouldTrackSideEffects 为更新流程。</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>oldFiber <span class="token operator">&amp;&amp;</span> newFiber<span class="token punctuation">.</span>alternate <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* 找到了与新节点对应的fiber，但是不能复用，那么直接删除老节点 */</span>
                <span class="token function">deleteChild</span><span class="token punctuation">(</span>returnFiber<span class="token punctuation">,</span> oldFiber<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>第二步：统一删除oldfiber</strong></p> <p><strong>第三步：统一创建newFiber</strong></p> <p><strong>第四步：针对发生移动和更复杂的情况</strong></p> <p><strong>第五步：删除剩余没有复用的oldFiber</strong></p> <h1 id="处理海量数据"><a href="#处理海量数据" class="header-anchor">#</a> 处理海量数据</h1> <h2 id="时间分片"><a href="#时间分片" class="header-anchor">#</a> 时间分片</h2> <p>时间分片主要解决，初次加载，一次性渲染大量数据造成的卡顿现象</p> <p>时间分片，并没有本质减少浏览器的工作量，而是把一次性任务分割开来，给用户一种流畅的体验效果</p> <h2 id="虚拟列表"><a href="#虚拟列表" class="header-anchor">#</a> 虚拟列表</h2> <h1 id="细节处理"><a href="#细节处理" class="header-anchor">#</a> 细节处理</h1> <h3 id="_1-react中防抖和节流"><a href="#_1-react中防抖和节流" class="header-anchor">#</a> 1 React中防抖和节流</h3> <h4 id="防抖d"><a href="#防抖d" class="header-anchor">#</a> 防抖d</h4> <h4 id="节流"><a href="#节流" class="header-anchor">#</a> 节流</h4> <h3 id="_2-按需引入"><a href="#_2-按需引入" class="header-anchor">#</a> 2 按需引入</h3> <h3 id="_3-react动画"><a href="#_3-react动画" class="header-anchor">#</a> 3 React动画</h3> <h4 id="_1-首选-动态添加类名"><a href="#_1-首选-动态添加类名" class="header-anchor">#</a> ① 首选：动态添加类名</h4> <p>通过 transition，animation 实现动画然后写在 class 类名里面，通过动态切换类名，达到动画的目的</p> <h4 id="_2-其次-操纵原生-dom"><a href="#_2-其次-操纵原生-dom" class="header-anchor">#</a> ② 其次：操纵原生 DOM</h4> <h4 id="_3-再者-setstate-css3"><a href="#_3-再者-setstate-css3" class="header-anchor">#</a> ③ 再者：setState + css3</h4> <h3 id="_4-及时清除定时器-延时器-监听器"><a href="#_4-及时清除定时器-延时器-监听器" class="header-anchor">#</a> 4 及时清除定时器/延时器/监听器</h3> <h3 id="_5-合理使用state"><a href="#_5-合理使用state" class="header-anchor">#</a> 5 合理使用state</h3> <h3 id="_6-建议不要在-hooks-的参数中执行函数或者-new-实例"><a href="#_6-建议不要在-hooks-的参数中执行函数或者-new-实例" class="header-anchor">#</a> 6 建议不要在 hooks 的参数中执行函数或者 new 实例</h3></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/react/react进阶实践指南/v18.html" class="prev">
        transition
      </a></span> <span class="next"><a href="/react/react进阶实践指南/原理篇.html">
        事件原理
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b51e4ccd.js" defer></script><script src="/assets/js/2.7229199a.js" defer></script><script src="/assets/js/55.5809711e.js" defer></script>
  </body>
</html>
